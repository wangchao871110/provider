<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sps_task">
    <!-- Result Map-->
    <resultMap id="result_map_sps_task" type="com.xfs.employeeside.model.SpsTask">
        <result column="task_id" property="taskId"/>
        <result column="cp_id" property="cpId"/>
        <result column="sp_id" property="spId"/>
        <result column="bstype_id" property="bstypeId"/>
        <result column="json" property="json"/>
        <result column="type" property="type"/>
        <result column="state_filed_id" property="stateFiledId"/>
        <result column="state_filed_name" property="stateFiledName"/>
        <result column="errmsg" property="errmsg"/>
        <result column="pic_id" property="picId"/>
        <result column="create_by" property="createBy"/>
        <result column="create_dt" property="createDt"/>
        <result column="modify_by" property="modifyBy"/>
        <result column="modify_dt" property="modifyDt"/>
        <result column="area_id" property="areaId"/>
        <result column="name" property="name"/>
        <result column="mobile" property="mobile"/>
        <result column="identity_code" property="identityCode"/>
        <result column="dr" property="dr"/>
        <result column="emp_id" property="empId"/>
        <result column="task_no" property="taskNo"/>
        <result column="begin_date" property="beginDate"/>
        <result column="online_status" property="onlineStatus"/>
        <result column="parter_sp_id" property="parterSpId"/>
        <result column="scheme_id" property="schemeId"/>
        <result column="execute_date" property="executeDate"/>
    </resultMap>


    <resultMap id="result_map_sps_task_state" type="com.xfs.employeeside.dto.SpsStateDto">
        <result column="id" property="id"/>
        <result column="bd_bsareatype_id" property="bdBsareatypeId"/>
        <result column="sys_dictitem_id" property="sysDicitemId"/>
        <result column="step" property="step"/>
        <result column="coee" property="code"/>
        <result column="name" property="name"/>
        <result column="time" property="time"/>
        <result column="location" property="location"/>
        <result column="state" property="state"/>
    </resultMap>

    <!-- sps_task table all fields -->
    <sql id="Base_Column_List">
	 task_id,cp_id,sp_id,bstype_id,json,type,state_filed_id,state_filed_name,errmsg,pic_id,create_by,create_dt,modify_by,modify_dt,area_id,name,mobile,identity_code,dr,emp_id,task_no,begin_date,online_status,parter_sp_id,scheme_id,execute_date
</sql>

    <!-- 查询条件 -->
    <sql id="Example_Where_Clause">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="taskId != null">and task_id = #{taskId}</if>
            <if test="cpId != null">and cp_id = #{cpId}</if>
            <if test="spId != null">and sp_id = #{spId}</if>
            <if test="bstypeId != null">and bstype_id = #{bstypeId}</if>
            <if test="json != null">and json = #{json}</if>
            <if test="type != null">and type = #{type}</if>
            <if test="stateFiledId != null">and state_filed_id = #{stateFiledId}</if>
            <if test="stateFiledName != null">and state_filed_name = #{stateFiledName}</if>
            <if test="errmsg != null">and errmsg = #{errmsg}</if>
            <if test="picId != null">and pic_id = #{picId}</if>
            <if test="createBy != null">and create_by = #{createBy}</if>
            <if test="createDt != null">and create_dt = #{createDt}</if>
            <if test="modifyBy != null">and modify_by = #{modifyBy}</if>
            <if test="modifyDt != null">and modify_dt = #{modifyDt}</if>
            <if test="areaId != null">and area_id = #{areaId}</if>
            <if test="name != null">and name = #{name}</if>
            <if test="mobile != null">and mobile = #{mobile}</if>
            <if test="identityCode != null">and identity_code = #{identityCode}</if>
            <if test="dr != null">and dr = #{dr}</if>
            <if test="empId != null">and emp_id = #{empId}</if>
            <if test="taskNo != null">and task_no = #{taskNo}</if>
            <if test="beginDate != null">and begin_date = #{beginDate}</if>
            <if test="onlineStatus != null">and online_status = #{onlineStatus}</if>
            <if test="parterSpId != null">and parter_sp_id = #{parterSpId}</if>
            <if test="schemeId != null">and scheme_id = #{schemeId}</if>
            <if test="executeDate != null">and execute_date = #{executeDate}</if>
        </trim>
    </sql>

    <!-- 调度任务表 列表总数-->
    <select id="countFindAll" resultType="java.lang.Integer">SELECT count(1) as value FROM sps_task</select>

    <!-- 根据各字段条件查询  调度任务表 -->
    <select id="freeFind" resultMap="result_map_sps_task" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sps_task
        <include refid="Example_Where_Clause"/>
    </select>

    <!-- 根据各字段条件查询  调度任务表 记录数 -->
    <select id="countFreeFind" resultType="java.lang.Integer">
        SELECT count(1) as value FROM sps_task
        <include refid="Example_Where_Clause"/>
    </select>

    <!-- 根据id查询 调度任务表 -->
    <select id="findByPK" resultMap="result_map_sps_task" parameterType="Object">SELECT
        <include refid="Base_Column_List"/>
        FROM sps_task WHERE TASK_ID=#{taskId}
    </select>


    <!-- 根据id查询 调度任务表 -->
    <select id="getAllStateBy" resultMap="result_map_sps_task_state" parameterType="Object">
      SELECT bb.*,dic.code ,dic.name  FROM bd_bsareatype_process  bb
       LEFT JOIN sys_dictitem dic on bb.sys_dictitem_id = dic.id
        WHERE bd_bsareatype_id=
        (SELECT id FROM bd_bsareatype WHERE bstype_id= #{bsTypeId}  and area_id=#{areaId})

    </select>


    <!-- 插入记录 -->
    <insert id="insert" parameterType="Object">
        INSERT INTO sps_task (
        <trim prefix=" " prefixOverrides=",">
            <if test="taskId != null ">,task_id</if>
            <if test="cpId != null ">,cp_id</if>
            <if test="spId != null ">,sp_id</if>
            <if test="bstypeId != null ">,bstype_id</if>
            <if test="json != null ">,json</if>
            <if test="type != null ">,type</if>
            <if test="stateFiledId != null ">,state_filed_id</if>
            <if test="stateFiledName != null ">,state_filed_name</if>
            <if test="errmsg != null ">,errmsg</if>
            <if test="picId != null ">,pic_id</if>
            <if test="createBy != null ">,create_by</if>
            <if test="createDt != null ">,create_dt</if>
            <if test="modifyBy != null ">,modify_by</if>
            <if test="modifyDt != null ">,modify_dt</if>
            <if test="areaId != null ">,area_id</if>
            <if test="name != null ">,name</if>
            <if test="mobile != null ">,mobile</if>
            <if test="identityCode != null ">,identity_code</if>
            <if test="dr != null ">,dr</if>
            <if test="empId != null ">,emp_id</if>
            <if test="taskNo != null ">,task_no</if>
            <if test="beginDate != null ">,begin_date</if>
            <if test="onlineStatus != null ">,online_status</if>
            <if test="parterSpId != null ">,parter_sp_id</if>
            <if test="schemeId != null ">,scheme_id</if>
            <if test="executeDate != null ">,execute_date</if>
        </trim>
        ) VALUES (
        <trim prefix=" " prefixOverrides=",">
            <if test="taskId != null ">,#{taskId}</if>
            <if test="cpId != null ">,#{cpId}</if>
            <if test="spId != null ">,#{spId}</if>
            <if test="bstypeId != null ">,#{bstypeId}</if>
            <if test="json != null ">,#{json}</if>
            <if test="type != null ">,#{type}</if>
            <if test="stateFiledId != null ">,#{stateFiledId}</if>
            <if test="stateFiledName != null ">,#{stateFiledName}</if>
            <if test="errmsg != null ">,#{errmsg}</if>
            <if test="picId != null ">,#{picId}</if>
            <if test="createBy != null ">,#{createBy}</if>
            <if test="createDt != null ">,#{createDt}</if>
            <if test="modifyBy != null ">,#{modifyBy}</if>
            <if test="modifyDt != null ">,#{modifyDt}</if>
            <if test="areaId != null ">,#{areaId}</if>
            <if test="name != null ">,#{name}</if>
            <if test="mobile != null ">,#{mobile}</if>
            <if test="identityCode != null ">,#{identityCode}</if>
            <if test="dr != null ">,#{dr}</if>
            <if test="empId != null ">,#{empId}</if>
            <if test="taskNo != null ">,#{taskNo}</if>
            <if test="beginDate != null ">,#{beginDate}</if>
            <if test="onlineStatus != null ">,#{onlineStatus}</if>
            <if test="parterSpId != null ">,#{parterSpId}</if>
            <if test="schemeId != null ">,#{schemeId}</if>
            <if test="executeDate != null ">,#{executeDate}</if>
        </trim>
        )
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="taskId">
            SELECT LAST_INSERT_ID() AS TASK_ID
        </selectKey>
    </insert>

    <!-- 根据id，修改记录-->
    <update id="update" parameterType="Object">
        UPDATE sps_task
        <trim prefix=" SET " prefixOverrides=",">
            <if test="taskId != null ">,task_id=#{taskId}</if>
            <if test="cpId != null ">,cp_id=#{cpId}</if>
            <if test="spId != null ">,sp_id=#{spId}</if>
            <if test="bstypeId != null ">,bstype_id=#{bstypeId}</if>
            <if test="json != null ">,json=#{json}</if>
            <if test="type != null ">,type=#{type}</if>
            <if test="stateFiledId != null ">,state_filed_id=#{stateFiledId}</if>
            <if test="stateFiledName != null ">,state_filed_name=#{stateFiledName}</if>
            <if test="errmsg != null ">,errmsg=#{errmsg}</if>
            <if test="picId != null ">,pic_id=#{picId}</if>
            <if test="createBy != null ">,create_by=#{createBy}</if>
            <if test="createDt != null ">,create_dt=#{createDt}</if>
            <if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
            <if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
            <if test="areaId != null ">,area_id=#{areaId}</if>
            <if test="name != null ">,name=#{name}</if>
            <if test="mobile != null ">,mobile=#{mobile}</if>
            <if test="identityCode != null ">,identity_code=#{identityCode}</if>
            <if test="dr != null ">,dr=#{dr}</if>
            <if test="empId != null ">,emp_id=#{empId}</if>
            <if test="taskNo != null ">,task_no=#{taskNo}</if>
            <if test="beginDate != null ">,begin_date=#{beginDate}</if>
            <if test="onlineStatus != null ">,online_status=#{onlineStatus}</if>
            <if test="parterSpId != null ">,parter_sp_id=#{parterSpId}</if>
            <if test="schemeId != null ">,scheme_id=#{schemeId}</if>
            <if test="executeDate != null ">,execute_date=#{executeDate}</if>
        </trim>
        WHERE TASK_ID=#{taskId}
    </update>

    <!-- 删除记录 -->
    <delete id="remove">DELETE FROM sps_task WHERE TASK_ID=#{taskId}</delete>

</mapper>   
