<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cm_employee_audit">
    <!-- Result Map-->
    <resultMap id="result_map_cm_employee_audit" type="com.xfs.employeeside.model.CmEmployeeAudit">
        <result column="emp_id" property="empId"/>
        <result column="cp_id" property="cpId"/>
        <result column="name" property="name"/>
        <result column="identity_type" property="identityType"/>
        <result column="identity_code" property="identityCode"/>
        <result column="mobile" property="mobile"/>
        <result column="create_by" property="createBy"/>
        <result column="create_dt" property="createDt"/>
        <result column="modify_by" property="modifyBy"/>
        <result column="modify_dt" property="modifyDt"/>
        <result column="dr" property="dr"/>
        <result column="open_id" property="openId"/>
        <result column="entry_time" property="entryTime"/>
        <result column="head_photo" property="headPhoto"/>
        <result column="json" property="json"/>
        <result column="state" property="state"/>
        <result column="area_id" property="areaId"/>
        <result column="is_worked" property="isWorked"/>
        <result column="insurance_living_type" property="insuranceLivingType"/>
        <result column="insurance_salary" property="insuranceSalary"/>
        <result column="fund_salary" property="fundSalary"/>
        <result column="insurance_fund_date" property="insuranceFundDate"/>
        <result column="user_id" property="userId"/>
    </resultMap>

    <!-- cm_employee_audit table all fields -->
    <sql id="Base_Column_List">
	 emp_id,cp_id,name,identity_type,identity_code,mobile,create_by,create_dt,modify_by,modify_dt,dr
	 ,open_id,entry_time,head_photo,json,state,area_id,is_worked,insurance_living_type,insurance_salary,fund_salary,insurance_fund_date,user_id
</sql>

    <!-- 查询条件 -->
    <sql id="Example_Where_Clause">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="empId != null">and emp_id = #{empId}</if>
            <if test="cpId != null">and cp_id = #{cpId}</if>
            <if test="name != null">and name = #{name}</if>
            <if test="identityType != null">and identity_type = #{identityType}</if>
            <if test="identityCode != null">and identity_code = #{identityCode}</if>
            <if test="mobile != null">and mobile = #{mobile}</if>
            <if test="createBy != null">and create_by = #{createBy}</if>
            <if test="createDt != null">and create_dt = #{createDt}</if>
            <if test="modifyBy != null">and modify_by = #{modifyBy}</if>
            <if test="modifyDt != null">and modify_dt = #{modifyDt}</if>
            <if test="dr != null">and dr = #{dr}</if>
            <if test="openId != null">and open_id = #{openId}</if>
            <if test="entryTime != null">and entry_time = #{entryTime}</if>
            <if test="headPhoto != null">and head_photo = #{headPhoto}</if>
            <if test="json != null">and json = #{json}</if>
            <if test="state != null">and state = #{state}</if>
            <if test="areaId != null">and area_id = #{areaId}</if>
            <if test="isWorked != null">and is_worked = #{isWorked}</if>
            <if test="insuranceLivingType != null">and insurance_living_type = #{insuranceLivingType}</if>
            <if test="insuranceSalary != null">and insurance_salary = #{insuranceSalary}</if>
            <if test="fundSalary != null">and fund_salary = #{fundSalary}</if>
            <if test="insuranceFundDate != null">and insurance_fund_date = #{insuranceFundDate}</if>
            <if test="userId != null">and user_id = #{userId}</if>

        </trim>
    </sql>

    <!-- 待审核员工表 列表总数-->
    <select id="countFindAll" resultType="java.lang.Integer">SELECT count(1) as value FROM cm_employee_audit</select>

    <!-- 根据各字段条件查询  待审核员工表 -->
    <select id="freeFind" resultMap="result_map_cm_employee_audit" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM cm_employee_audit
        <include refid="Example_Where_Clause"/>
    </select>

    <!-- 根据各字段条件查询  待审核员工表 记录数 -->
    <select id="countFreeFind" resultType="java.lang.Integer">
        SELECT count(1) as value FROM cm_employee_audit
        <include refid="Example_Where_Clause"/>
    </select>

    <!-- 根据id查询 待审核员工表 -->
    <select id="findByPK" resultMap="result_map_cm_employee_audit" parameterType="Object">SELECT
        <include refid="Base_Column_List"/>
        FROM cm_employee_audit WHERE EMP_ID=#{empId}
    </select>

    <!-- 插入记录 -->
    <insert id="insert" parameterType="Object">
        INSERT INTO cm_employee_audit (
        <trim prefix=" " prefixOverrides=",">
            <if test="empId != null ">,emp_id</if>
            <if test="cpId != null ">,cp_id</if>
            <if test="name != null ">,name</if>
            <if test="identityType != null ">,identity_type</if>
            <if test="identityCode != null ">,identity_code</if>
            <if test="mobile != null ">,mobile</if>
            <if test="createBy != null ">,create_by</if>
            <if test="createDt != null ">,create_dt</if>
            <if test="modifyBy != null ">,modify_by</if>
            <if test="modifyDt != null ">,modify_dt</if>
            <if test="dr != null ">,dr</if>
            <if test="openId != null ">,open_id</if>
            <if test="entryTime != null ">,entry_time</if>
            <if test="headPhoto != null ">,head_photo</if>
            <if test="json != null ">,json</if>
            <if test="state != null ">,state</if>
            <if test="areaId != null ">,area_id</if>
            <if test="isWorked != null ">,is_worked</if>
            <if test="insuranceLivingType != null ">,insurance_living_type</if>
            
            <if test="insuranceSalary != null">,insurance_salary</if>
            <if test="fundSalary != null">,fund_salary</if>
            <if test="insuranceFundDate != null">,insurance_fund_date</if>
            <if test="userId != null">,user_id</if>
        </trim>
        ) VALUES (
        <trim prefix=" " prefixOverrides=",">
            <if test="empId != null ">,#{empId}</if>
            <if test="cpId != null ">,#{cpId}</if>
            <if test="name != null ">,#{name}</if>
            <if test="identityType != null ">,#{identityType}</if>
            <if test="identityCode != null ">,#{identityCode}</if>
            <if test="mobile != null ">,#{mobile}</if>
            <if test="createBy != null ">,#{createBy}</if>
            <if test="createDt != null ">,#{createDt}</if>
            <if test="modifyBy != null ">,#{modifyBy}</if>
            <if test="modifyDt != null ">,#{modifyDt}</if>
            <if test="dr != null ">,#{dr}</if>
            <if test="openId != null ">,#{openId}</if>
            <if test="entryTime != null ">,#{entryTime}</if>
            <if test="headPhoto != null ">,#{headPhoto}</if>
            <if test="json != null ">,#{json}</if>
            <if test="state != null ">,#{state}</if>
            <if test="areaId != null ">,#{areaId}</if>
            <if test="isWorked != null ">,#{isWorked}</if>
            <if test="insuranceLivingType != null ">,#{insuranceLivingType}</if>
            
            <if test="insuranceSalary != null">,#{insuranceSalary}</if>
            <if test="fundSalary != null">,#{fundSalary}</if>
            <if test="insuranceFundDate != null">,#{insuranceFundDate}</if>
            <if test="userId != null">,#{userId}</if>
        </trim>
        )
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="empId">
            SELECT LAST_INSERT_ID() AS EMP_ID
        </selectKey>
    </insert>

    <!-- 根据id，修改记录-->
    <update id="update" parameterType="Object">
        UPDATE cm_employee_audit
        <trim prefix=" SET " prefixOverrides=",">
            <if test="empId != null ">,emp_id=#{empId}</if>
            <if test="cpId != null ">,cp_id=#{cpId}</if>
            <if test="name != null ">,name=#{name}</if>
            <if test="identityType != null ">,identity_type=#{identityType}</if>
            <if test="identityCode != null ">,identity_code=#{identityCode}</if>
            <if test="mobile != null ">,mobile=#{mobile}</if>
            <if test="createBy != null ">,create_by=#{createBy}</if>
            <if test="createDt != null ">,create_dt=#{createDt}</if>
            <if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
            <if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
            <if test="dr != null ">,dr=#{dr}</if>
            <if test="openId != null ">,open_id=#{openId}</if>
            <if test="entryTime != null ">,entry_time=#{entryTime}</if>
            <if test="headPhoto != null ">,head_photo=#{headPhoto}</if>
            <if test="json != null ">,json=#{json}</if>
            <if test="state != null ">,state=#{state}</if>
            <if test="areaId != null ">,area_id=#{areaId}</if>
            <if test="isWorked != null ">,is_worked=#{isWorked}</if>
            <if test="insuranceLivingType != null ">,insurance_living_type=#{insuranceLivingType}</if>
            
            <if test="insuranceSalary != null">,insurance_salary = #{insuranceSalary}</if>
            <if test="fundSalary != null">,fund_salary = #{fundSalary}</if>
            <if test="insuranceFundDate != null">,insurance_fund_date = #{insuranceFundDate}</if>
            <if test="userId != null">,user_id = #{userId}</if>
        </trim>
        WHERE EMP_ID=#{empId}
    </update>

    <!-- 删除记录 -->
    <delete id="remove">DELETE FROM cm_employee_audit WHERE EMP_ID=#{empId}</delete>

    <!-- 根据各字段条件查询  待审核员工表 -->
    <select id="getCmEmployeeAuditByOpenId" resultMap="result_map_cm_employee_audit" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM cm_employee_audit
        WHERE open_id=#{openId} and (state =1 or state =2)
    </select>


    <!-- 根据id查询 员工表 -->
    <select id="findByFree" resultMap="result_map_cm_employee_audit" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM cm_employee_audit WHERE cp_id=#{cpId} and name = #{name }
        and RIGHT(identity_code,4) = #{identityCode}
        and dr=0 limit 1
    </select>
    <update id="updateOpenIdByOpenId"  parameterType="Object">
      UPDATE  cm_employee_audit set open_id = null WHERE  open_id =#{openId}
    </update>

</mapper>   
