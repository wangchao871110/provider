<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BD_BSTYPEAREAFIELD" >
    <!-- Result Map-->
    <resultMap id="result_map_BD_BSTYPEAREAFIELD" type="com.xfs.business.model.BdBstypeareafield" >
        <result column="id" property="id"/>
        <result column="bstype_id" property="bstypeId"/>
        <result column="area_id" property="areaId"/>
        <result column="required" property="required"/>
        <result column="field_id" property="fieldId"/>
        <result column="create_by" property="createBy"/>
        <result column="create_dt" property="createDt"/>
        <result column="modify_by" property="modifyBy"/>
        <result column="modify_dt" property="modifyDt"/>
        <result column="page_is_hidden" property="pageIsHidden"/>
        <result column="model_is_hidden" property="modelIsHidden"/>
        <result column="default_value" property="defaultValue"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <!-- bd_bstypeareafield table all fields -->
    <sql id="Base_Column_List" >
	 id,bstype_id,area_id,required,field_id,create_by,create_dt,modify_by,modify_dt,page_is_hidden,model_is_hidden,default_value,remark
</sql>

    <!-- 查询条件 -->
    <sql id="Example_Where_Clause">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="id != null" >and id = #{id}</if>
            <if test="bstypeId != null" >and bstype_id = #{bstypeId}</if>
            <if test="areaId != null" >and area_id = #{areaId}</if>
            <if test="required != null" >and required = #{required}</if>
            <if test="fieldId != null" >and field_id = #{fieldId}</if>
            <if test="createBy != null" >and create_by = #{createBy}</if>
            <if test="createDt != null" >and create_dt = #{createDt}</if>
            <if test="modifyBy != null" >and modify_by = #{modifyBy}</if>
            <if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
            <if test="pageIsHidden != null" >and page_is_hidden = #{pageIsHidden}</if>
            <if test="modelIsHidden != null" >and model_is_hidden = #{modelIsHidden}</if>
            <if test="defaultValue != null" >and default_value = #{defaultValue}</if>
        </trim>
    </sql>

    <!-- 查询条件 带模糊查询 以及 时间起始查询 -->
    <sql id="Example_Where_Clause2">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="id != null">AND id = #{id}</if>
            <if test="bstypeId != null">AND bstype_id = ${bstypeId}</if>
            <if test="areaId != null">AND area_id = ${areaId}</if>
            <if test="required != null">AND required like '%${required}%'</if>
            <if test="requiredEq != null">AND required = #{requiredEq}</if>
            <if test="fieldId != null">AND field_id = '${fieldId}'</if>
            <if test="createBy != null">AND create_by = '%${createBy}%'</if>
            <if test="createDt != null">AND create_dt = #{createDt}</if>
            <if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
            <if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
            <if test="modifyBy != null">AND modify_by = '%${modifyBy}%'</if>
            <if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
            <if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
            <if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
            <if test="pageIsHidden != null" >and page_is_hidden = #{pageIsHidden}</if>
            <if test="modelIsHidden != null" >and model_is_hidden = #{modelIsHidden}</if>
            <if test="defaultValue != null" >and default_value = #{defaultValue}</if>
        </trim>
    </sql>

    <!-- 插入记录 -->
    <insert id="InsertBD_BSTYPEAREAFIELD" parameterType="Object" >
        INSERT INTO BD_BSTYPEAREAFIELD (
        <trim prefix=" " prefixOverrides=",">
            <if test="id != null ">,id</if>
            <if test="bstypeId != null ">,bstype_id</if>
            <if test="areaId != null ">,area_id</if>
            <if test="required != null ">,required</if>
            <if test="fieldId != null ">,field_id</if>
            <if test="createBy != null ">,create_by</if>
            <if test="createDt != null ">,create_dt</if>
            <if test="modifyBy != null ">,modify_by</if>
            <if test="modifyDt != null ">,modify_dt</if>
            <if test="pageIsHidden != null" >,page_is_hidden</if>
            <if test="modelIsHidden != null" >,model_is_hidden</if>
            <if test="defaultValue != null" >,default_value</if>
            <if test="remark != null" >,remark</if>
        </trim>
        )  VALUES (
        <trim prefix=" " prefixOverrides=",">
            <if test="id != null ">,#{id}</if>
            <if test="bstypeId != null ">,#{bstypeId}</if>
            <if test="areaId != null ">,#{areaId}</if>
            <if test="required != null ">,#{required}</if>
            <if test="fieldId != null ">,#{fieldId}</if>
            <if test="createBy != null ">,#{createBy}</if>
            <if test="createDt != null ">,#{createDt}</if>
            <if test="modifyBy != null ">,#{modifyBy}</if>
            <if test="modifyDt != null ">,#{modifyDt}</if>
            <if test="pageIsHidden != null" >,#{pageIsHidden}</if>
            <if test="modelIsHidden != null" >,#{modelIsHidden}</if>
            <if test="defaultValue != null" >,#{defaultValue}</if>
            <if test="remark != null" >,#{remark}</if>
        </trim>
        )
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID() AS ID
        </selectKey>
    </insert>

    <!-- 根据id，修改记录-->
    <update id="UpdateBD_BSTYPEAREAFIELD" parameterType="Object" >
        UPDATE BD_BSTYPEAREAFIELD
        <trim prefix=" SET " prefixOverrides=",">
            <if test="id != null ">,id=#{id}</if>
            <if test="bstypeId != null ">,bstype_id=#{bstypeId}</if>
            <if test="areaId != null ">,area_id=#{areaId}</if>
            <if test="required != null ">,required=#{required}</if>
            <if test="fieldId != null ">,field_id=#{fieldId}</if>
            <if test="createBy != null ">,create_by=#{createBy}</if>
            <if test="createDt != null ">,create_dt=#{createDt}</if>
            <if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
            <if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
            <if test="pageIsHidden != null" >,page_is_hidden=#{pageIsHidden}</if>
            <if test="modelIsHidden != null" >,model_is_hidden=#{modelIsHidden}</if>
            <if test="defaultValue != null" >,default_value=#{defaultValue}</if>
            <if test="remark != null" >,remark=#{remark}</if>
        </trim>
        WHERE ID=#{id}
    </update>

    <!-- 删除记录 -->
    <delete id="DeleteBD_BSTYPEAREAFIELD">DELETE FROM BD_BSTYPEAREAFIELD WHERE ID=#{id}</delete>
    <!-- 业务类型地区字段 列表总数-->
    <select id="CountFindAllBD_BSTYPEAREAFIELD" resultType="java.lang.Integer">SELECT count(1) as value FROM BD_BSTYPEAREAFIELD</select>
    <select id="CountBD_BSTYPEAREAFIELD" resultType="java.lang.Integer">SELECT count(1) as value FROM BD_BSTYPEAREAFIELD WHERE ID=#{id}</select>
    <!-- 根据id查询 业务类型地区字段 -->
    <select id="FindByPK" resultMap="result_map_BD_BSTYPEAREAFIELD" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM BD_BSTYPEAREAFIELD WHERE ID=#{id}</select>

    <!-- 根据各字段条件带模糊查询  业务类型地区字段 -->
    <select id="FreeFindBD_BSTYPEAREAFIELD" resultMap="result_map_BD_BSTYPEAREAFIELD" parameterType="Object">
        SELECT <include refid="Base_Column_List" /> FROM BD_BSTYPEAREAFIELD
        <include refid="Example_Where_Clause2" />
    </select>
    <!-- 根据各字段条件带模糊查询  业务类型地区字段 记录数 -->
    <select id="CountFreeFindBD_BSTYPEAREAFIELD" resultType="java.lang.Integer">
        SELECT count(1) as value FROM BD_BSTYPEAREAFIELD
        <include refid="Example_Where_Clause2" />
    </select>
    <!-- 根据各字段条件带排序  业务类型地区字段 -->
    <select id="FreeFindBD_BSTYPEAREAFIELDOrdered" resultMap="result_map_BD_BSTYPEAREAFIELD" parameterType="Object">
        SELECT <include refid="Base_Column_List" /> FROM BD_BSTYPEAREAFIELD
        <include refid="Example_Where_Clause2" />
        ORDER BY ${_orderBy}
    </select>


    <!-- *****************************  温馨提示：  ***************************** -->
    <!-- **                                                                    ** -->
    <!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
    <!-- **                                             ** 2016/05/18 11:55:59 ** -->
    <!-- ************************************************************************ -->

    <resultMap id="mapType" type="java.util.Map">
    </resultMap>
    <!-- 根据 bstype_id,area_id 查询 字段信息 -->
    <select id="findBsTypeField" resultMap="mapType" parameterType="Object">
        SELECT t.*,f.code,f.name,f.type
        FROM bd_bstypeareafield t inner join bd_businessfield f 
        on t.field_id = f.field_id 
        where t.bstype_id=#{bstypeId} and t.area_id =#{areaId}
    </select>

    <!-- 根据 业务类型名称 查询 字段信息 -->
    <select id="findBsTypeFieldByName" resultMap="mapType" parameterType="Object">
        SELECT t.*,f.code,f.name
        FROM bd_bstypeareafield t inner join bd_businessfield f 
        on t.field_id = f.field_id 
        where t.area_id =#{areaId} and 
        exists (select 1 from bd_bstype y where y.bstype_id = t.bstype_id and y.name in (${requiredEq}) )
    </select>

    <!--通过地区id 与 类型 删除所属字段-->
    <delete id="DeleteBD_BSTYPEAREAFIELD_BY_AREAANDTYPE">DELETE FROM BD_BSTYPEAREAFIELD WHERE area_id=${areaId} AND bstype_id=${bstypeId}</delete>

    <select id="findBdBstypeareafield" resultMap="result_map_BD_BSTYPEAREAFIELD" parameterType="Object">
        SELECT <include refid="Base_Column_List" /> FROM BD_BSTYPEAREAFIELD
        <include refid="Example_Where_Clause" />
    </select>

    <delete id="DELETE_BdBstypeareafield">DELETE FROM BD_BSTYPEAREAFIELD WHERE area_id=${areaId} and bstype_id=${bstypeId}</delete>

    <select id="findBdBstypeareafieldList" resultMap="result_map_BD_BSTYPEAREAFIELD" parameterType="Object">
        SELECT <include refid="Base_Column_List" /> FROM BD_BSTYPEAREAFIELD
        <include refid="Example_Where_Clause" />
    </select>

    <select id="findBsTypeFieldList" resultType="java.util.Map" parameterType="Object">
        SELECT
        bb.field_id,bb.`code`,bb.`name`
        FROM
        bd_bstypeareafield bbf
        inner join  bd_businessfield bb ON bbf.field_id = bb.field_id
        inner join bs_area a on a.area_id=bbf.area_id
        WHERE
        a.`code`=#{code}

    </select>

</mapper>
