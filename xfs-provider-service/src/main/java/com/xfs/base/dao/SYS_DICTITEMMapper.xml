<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SYS_DICTITEM" > 
<!-- Result Map-->
<resultMap id="result_map_SYS_DICTITEM" type="com.xfs.base.model.SysDictitem" >
	<result column="id" property="id"/>
	<result column="tid" property="tid"/>
	<result column="dictionary" property="dictionary"/>
	<result column="code" property="code"/>
	<result column="name" property="name"/>
	<result column="description" property="description"/>
	<result column="orderby" property="orderby"/>
	<result column="create_user" property="createUser"/>
	<result column="create_time" property="createTime"/>
    <result column="area_id" property="areaId"/>
    <result column="synonym" property="synonym"/>
</resultMap>
       
<!-- sys_dictitem table all fields -->
<sql id="Base_Column_List" >
	 id,tid,dictionary,code,name,description,orderby,create_user,create_time,area_id,synonym
</sql>

	<sql id="Base_Column_List1" >
		item.id,item.tid,item.dictionary,item.code,item.name,item.description,item.orderby,item.create_user,item.create_time
	</sql>

<!-- 查询条件 -->
<sql id="Example_Where_Clause">
  <trim prefix=" WHERE " prefixOverrides="AND ">
	<if test="id != null" >and id = #{id}</if>
	<if test="tid != null" >and tid = #{tid}</if>
	<if test="dictionary != null" >and dictionary = #{dictionary}</if>
	<if test="code != null" >and code = #{code}</if>
	<if test="name != null" >and name = #{name}</if>
	<if test="description != null" >and description = #{description}</if>
	<if test="orderby != null" >and orderby = #{orderby}</if>
	<if test="createUser != null" >and create_user = #{createUser}</if>
	<if test="createTime != null" >and create_time = #{createTime}</if>
	<if test="areaId != null" >and area_id = #{areaId}</if>
	<if test="synonym != null" >and synonym = #{synonym}</if>
</trim>
</sql>

<!-- 查询条件 带模糊查询 以及 时间起始查询 -->
<sql id="Example_Where_Clause2">
  <trim prefix=" WHERE " prefixOverrides="AND ">
    <if test="id != null">AND id = #{id}</if>
    <if test="tid != null">AND tid = '${tId}'</if>
    <if test="tidEq != null">AND tid = #{tidEq}</if>
    <if test="dictionary != null">AND dictionary like '%${dictionary}%'</if>
    <if test="code != null">AND code like '%${code}%'</if>
    <if test="codeEq != null">AND code = #{codeEq}</if>
    <if test="name != null">AND name like '%${name}%'</if>
    <if test="nameEq != null">AND name = #{nameEq}</if>
    <if test="description != null">AND description like '%${description}%'</if>
    <if test="descriptionEq != null">AND description = #{descriptionEq}</if>
    <if test="orderby != null">AND orderby like '%${orderby}%'</if>
    <if test="createUser != null">AND create_user like '%${createUser}%'</if>
    <if test="createTime != null">AND create_time like '%${createTime}%'</if>
    <if test="areaId != null">AND area_id = #{areaId}</if>
    <if test="createTimeEq != null">AND create_time = #{createTimeEq}</if>
    <if test="synonym != null">AND synonym like '%${synonym}%'</if>
    <if test="synonymEq != null">AND synonym = #{synonymEq}</if>
  </trim>
</sql>

<!-- 插入记录 -->
<insert id="InsertSYS_DICTITEM" parameterType="Object" >
  INSERT INTO SYS_DICTITEM (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,id</if>
	<if test="tid != null ">,tid</if>
	<if test="dictionary != null ">,dictionary</if>
	<if test="code != null ">,code</if>
	<if test="name != null ">,name</if>
	<if test="description != null ">,description</if>
	<if test="orderby != null ">,orderby</if>
	<if test="createUser != null ">,create_user</if>
	<if test="createTime != null ">,create_time</if>
	<if test="areaId != null ">,area_id</if>
	<if test="synonym != null ">,synonym</if>
  </trim>
  )  VALUES (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,#{id}</if>
	<if test="tid != null ">,#{tid}</if>
	<if test="dictionary != null ">,#{dictionary}</if>
	<if test="code != null ">,#{code}</if>
	<if test="name != null ">,#{name}</if>
	<if test="description != null ">,#{description}</if>
	<if test="orderby != null ">,#{orderby}</if>
	<if test="createUser != null ">,#{createUser}</if>
	<if test="createTime != null ">,#{createTime}</if>
	<if test="areaId != null ">,#{areaId}</if>
	<if test="synonym != null ">,#{synonym}</if>
  </trim>
  )
  <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
	SELECT LAST_INSERT_ID() AS ID
  </selectKey>
</insert>

<!-- 根据id，修改记录-->  
<update id="UpdateSYS_DICTITEM" parameterType="Object" >
UPDATE SYS_DICTITEM 
  <trim prefix=" SET " prefixOverrides=",">
	<if test="id != null ">,id=#{id}</if>
	<if test="tid != null ">,tid=#{tid}</if>
	<if test="dictionary != null ">,dictionary=#{dictionary}</if>
	<if test="code != null ">,code=#{code}</if>
	<if test="name != null ">,name=#{name}</if>
	<if test="description != null ">,description=#{description}</if>
	<if test="orderby != null ">,orderby=#{orderby}</if>
	<if test="createUser != null ">,create_user=#{createUser}</if>
	<if test="createTime != null ">,create_time=#{createTime}</if>
	<if test="areaId != null ">,area_id=#{areaId}</if>
  </trim>
WHERE ID=#{id}
</update>
 
<!-- 删除记录 -->
<delete id="DeleteSYS_DICTITEM">DELETE FROM SYS_DICTITEM WHERE ID=#{id}</delete>
<!-- 字典子集表 列表总数-->
<select id="CountFindAllSYS_DICTITEM" resultType="java.lang.Integer">SELECT count(1) as value FROM SYS_DICTITEM</select>
<select id="CountSYS_DICTITEM" resultType="java.lang.Integer">SELECT count(1) as value FROM SYS_DICTITEM WHERE ID=#{id}</select>
<!-- 根据id查询 字典子集表 -->
<select id="FindByPK" resultMap="result_map_SYS_DICTITEM" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM SYS_DICTITEM WHERE ID=#{id}</select>

<!-- 根据各字段条件带模糊查询  字典子集表 -->
<select id="FreeFindSYS_DICTITEM" resultMap="result_map_SYS_DICTITEM" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM SYS_DICTITEM 
	 <include refid="Example_Where_Clause2" />  order by orderby
</select>
<!-- 根据各字段条件带模糊查询  字典子集表 记录数 -->
<select id="CountFreeFindSYS_DICTITEM" resultType="java.lang.Integer">
SELECT count(1) as value FROM SYS_DICTITEM 
 <include refid="Example_Where_Clause2" />
</select>
<!-- 根据各字段条件带排序  字典子集表 -->
<select id="FreeFindSYS_DICTITEMOrdered" resultMap="result_map_SYS_DICTITEM" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM SYS_DICTITEM 
	 <include refid="Example_Where_Clause2" />
	 ORDER BY ${_orderBy}
</select>

<!-- *******************************  温馨提示：     ******************************* -->
<!-- **                                                                    ** -->
<!-- **************以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写************** -->
<!-- **                                  ** quanjiahua,2015/12/10 17:19:51 ** -->
<!-- ************************************************************************ -->


    <!-- 根据字典名称 查看 字典项 -->
    <select id="SYS_DICTITEM.findByDictNameAndArea" resultMap="result_map_SYS_DICTITEM" parameterType="Object">SELECT <include refid="Base_Column_List" /> from sys_dictitem item where  item.dictionary in (select t.id from sys_dictionary t where t.name=#{dictName} ) and EXISTS( select belong_city from bs_area bsa where area_id=#{areaId} and bsa.belong_city = item.area_id) ORDER BY item.orderby</select>


    <select id="FindSYS_DICTITEMBydictionary" resultMap="result_map_SYS_DICTITEM">
    SELECT <include refid="Base_Column_List" /> FROM SYS_DICTITEM
    <trim prefix=" WHERE " prefixOverrides="AND ">
      <if test="dictionary == null ">AND 1=2</if>
      <if test="dictionary != null ">AND dictionary=#{dictionary}</if>
    </trim> 
     ORDER BY orderby
</select>
<!-- 删除记录 -->
<delete id="DeleteSYS_DICTITEMByDictionary">DELETE FROM SYS_DICTITEM WHERE dictionary=#{dictionary} <if test="areaId != null" >and area_id = #{areaId}</if></delete>

<!-- 根据字典名称 查看 字典项 -->
<select id="SYS_DICTITEM.findByDictName" resultMap="result_map_SYS_DICTITEM" parameterType="Object">SELECT <include refid="Base_Column_List" /> from sys_dictitem where  dictionary in (select t.id from sys_dictionary t where t.name=#{dictName} ) ORDER BY orderby</select>

	<select id="SYS_DICTITEM.findSysDicitem" resultMap="result_map_SYS_DICTITEM" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM SYS_DICTITEM
		<include refid="Example_Where_Clause" /></select>

	<!-- 查询社保缴交地区参保类别 -->
	<select id="findCblb" resultType="java.util.Map" >
		select sys_dictitem.* ,bs_area.code area_code from sys_dictitem
		inner join bs_area on bs_area.area_id = sys_dictitem.area_id and bs_area.area_id in(select area_id from sys_dictitem where dictionary = 93)
		where dictionary = 93
	</select>
	<!-- 删除记录 -->
	<delete id="CS_DeleteSYS_DICTITEMByDictionary">DELETE FROM SYS_DICTITEM WHERE dictionary=#{dictionary}</delete>


	<!--通过code查询参保类型-->
	<select id="FindSYS_DICTITEMByLivingCode" resultMap="result_map_SYS_DICTITEM">
		SELECT <include refid="Base_Column_List" /> FROM SYS_DICTITEM
		where dictionary=93
		<if test="code != null "> and `code` = #{code}</if>
	</select>


	<!-- 根据传来的参数 查询社保缴交地区上级区域Id -->
	<select id="findByAreaCode" resultMap="result_map_SYS_DICTITEM" parameterType="java.lang.String">
		select sys_dictitem.* from sys_dictitem
		inner join bs_area on bs_area.area_id = sys_dictitem.area_id
		and locate(bs_area.code,#{areacode})=1 and bs_area.area_id in(select area_id from sys_dictitem where dictionary = 93)
		where dictionary = 93
	</select>

	<!-- 查询 城市下 字典信息 -->
	<select id="findDictItemsByAreaId" resultType="java.util.Map" parameterType="Object">
		select t1.NAME dictcode,t1.cnname dictname,t2.`code` itemcode,t2.name itemname from sys_dictionary t1,sys_dictitem t2
		where t1.id = t2.dictionary and t2.area_id= #{areaId}
	</select>

	<select id="findSysDictitem" resultMap="result_map_SYS_DICTITEM" parameterType="Object">
		SELECT si.* FROM sys_dictionary sd JOIN sys_dictitem si on sd.id=si.dictionary WHERE sd.`name`=#{name} AND si.area_id=#{areaId};
	</select>

	<!-- 2016-08 新版 任务管理 操作详情页面  查询员工证件类型集合  -->
	<select id="findEmpDocTypeMap" resultType="java.util.Map" parameterType="Object">
		select  code,name from sys_dictitem where  dictionary = 89
	</select>

	<!-- 根据各字段条件带模糊查询  字典子集表 -->
	<select id="findDicitemBySchemeId" resultMap="result_map_SYS_DICTITEM" parameterType="Object">
		SELECT <include refid="Base_Column_List1" />   from sps_scheme sch
		INNER JOIN  bs_area area on sch.area_id = area.area_id
		INNER JOIN sys_dictitem item on area.belong_city = item.area_id and item.dictionary = 93
		where sch.scheme_id = #{schemeId}
	</select>

	<!-- 根据areaId 查询社保参保类别  modify by lifq 20160925-->
	<select id="findLiveTypeByAreaId" resultType="java.util.Map" parameterType="Object">
		select t.`code`,t.`name`,t.area_id from sys_dictitem t
		where t.dictionary = 93 and t.area_id= #{area_id} and
		t.code in (select b.living_type from bs_arearatio a,bs_arearatioscope b
		where a.ratio_id = b.ratio_id and a.area_id=#{area_id})
	</select>

	<delete id="SPS_DeleteSYS_DICTITEMByDictionary">DELETE FROM SYS_DICTITEM WHERE dictionary=#{dictionary}</delete>


	<!-- 获取所有地区去重后的参保类型-->
	<select id="findLiveTypeDISTINCT" resultType="java.util.Map" parameterType="Object">
		select DISTINCT `name`,`code` from sys_dictitem where dictionary=93
	</select>
	
	<!-- 根据城市id 获取户口性质 -->
	<select id="getSysDictitem" resultType="java.lang.String" parameterType="java.util.Map">
		select DISTINCT sd.name 
		from sys_dictitem  sd,bs_area ba
		where ba.area_id=sd.area_id
		and sd.dictionary=93
		and ba.areacode in (${areacode})
	</select>
</mapper>   
