<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SPS_MALL_PRODUCT">
    <!-- Result Map-->
    <resultMap id="result_map_SPS_MALL_PRODUCT" type="com.xfs.mall.product.model.SpsMallProduct">
        <result column="product_id" property="productId"/>
        <result column="sp_id" property="spId"/>
        <result column="product_name" property="productName"/>
        <result column="area_id" property="areaId"/>
        <result column="service_type" property="serviceType"/>
        <result column="per_month" property="perMonth"/>
        <result column="per_month_price" property="perMonthPrice"/>
        <result column="once" property="once"/>
        <result column="once_price" property="oncePrice"/>
        <result column="photo" property="photo"/>
        <result column="orderby" property="orderby"/>
        <result column="state" property="state"/>
        <result column="create_by" property="createBy"/>
        <result column="create_dt" property="createDt"/>
        <result column="modify_by" property="modifyBy"/>
        <result column="modify_dt" property="modifyDt"/>
        <result column="dr" property="dr"/>
        <result column="product_des" property="productDes"/>
        <result column="agent_ci_id" property="agentCiId"/>
        <result column="agent_group_id" property="agentGroupId"/>
    </resultMap>

    <!-- sps_mall_product table all fields -->
    <sql id="Base_Column_List">
	 product_id,sp_id,product_name,area_id,service_type,per_month,per_month_price,once,once_price,photo,orderby,state,product_des,create_by,create_dt,modify_by,modify_dt,dr,agent_ci_id,agent_group_id
	</sql>

    <!-- 查询条件 -->
    <sql id="Example_Where_Clause">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="productId != null">and product_id = #{productId}</if>
            <if test="spId != null">and sp_id = #{spId}</if>
            <if test="productName != null">and product_name = #{productName}</if>
            <if test="areaId != null">and area_id = #{areaId}</if>
            <if test="serviceType != null">and service_type = #{serviceType}</if>
            <if test="perMonth != null">and per_month = #{perMonth}</if>
            <if test="perMonthPrice != null">and per_month_price = #{perMonthPrice}</if>
            <if test="once != null">and once = #{once}</if>
            <if test="oncePrice != null">and once_price = #{oncePrice}</if>
            <if test="photo != null">and photo = #{photo}</if>
            <if test="orderby != null">and orderby = #{orderby}</if>
            <if test="state != null">and state = #{state}</if>
            <if test="createBy != null">and create_by = #{createBy}</if>
            <if test="createDt != null">and create_dt = #{createDt}</if>
            <if test="modifyBy != null">and modify_by = #{modifyBy}</if>
            <if test="modifyDt != null">and modify_dt = #{modifyDt}</if>
            <if test="dr != null">and dr = #{dr}</if>
            <if test="productDes != null">and product_des = #{productDes}</if>
            <if test="agentCiId != null">and agent_ci_id = #{agentCiId}</if>
            <if test="agentGroupId != null">and agent_group_id = #{agentGroupId}</if>
        </trim>
    </sql>

    <!-- 查询条件 带模糊查询 以及 时间起始查询 -->
    <sql id="Example_Where_Clause2">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="productId != null">AND product_id = '${productId}'</if>
            <if test="spId != null">AND sp_id = '${spId}'</if>
            <if test="productName != null">AND product_name like '%${productName}%'</if>
            <if test="productNameEq != null">AND product_name = #{productNameEq}</if>
            <if test="areaId != null">AND area_id = '${areaId}'</if>
            <if test="areaIdEq != null">AND area_id = #{areaIdEq}</if>
            <if test="serviceType != null">AND service_type like '%${serviceType}%'</if>
            <if test="serviceTypeEq != null">AND service_type = #{serviceTypeEq}</if>
            <if test="perMonth != null">AND per_month like '%${perMonth}%'</if>
            <if test="perMonthEq != null">AND per_month = #{perMonthEq}</if>
            <if test="perMonthPrice != null">AND per_month_price like '%${perMonthPrice}%'</if>
            <if test="once != null">AND once like '%${once}%'</if>
            <if test="onceEq != null">AND once = #{onceEq}</if>
            <if test="oncePrice != null">AND once_price like '%${oncePrice}%'</if>
            <if test="photo != null">AND photo like '%${photo}%'</if>
            <if test="photoEq != null">AND photo = #{photoEq}</if>
            <if test="orderby != null">AND orderby like '%${orderby}%'</if>
            <if test="state != null">AND state like '%${state}%'</if>
            <if test="stateEq != null">AND state = #{stateEq}</if>
            <if test="createBy != null">AND create_by = '%${createBy}%'</if>
            <if test="createDt != null">AND create_dt = #{createDt}</if>
            <if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
            <if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
            <if test="modifyBy != null">AND modify_by = '%${modifyBy}%'</if>
            <if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
            <if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
            <if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
            <if test="dr != null">AND dr like '%${dr}%'</if>
            <if test="productDes != null">AND product_des like '%${productDes}%'</if>
            <if test="productDesEq != null">AND product_des = #{productDesEq}</if>
            <if test="agentCiId != null">AND agent_ci_id = #{agentCiId}</if>
            <if test="agentGroupId != null">AND agent_group_id = #{agentGroupId}</if>
        </trim>
    </sql>

    <!-- 插入记录 -->
    <insert id="InsertSPS_MALL_PRODUCT" parameterType="Object">
        INSERT INTO SPS_MALL_PRODUCT (
        <trim prefix=" " prefixOverrides=",">
            <if test="productId != null ">,product_id</if>
            <if test="spId != null ">,sp_id</if>
            <if test="productName != null ">,product_name</if>
            <if test="areaId != null ">,area_id</if>
            <if test="serviceType != null ">,service_type</if>
            <if test="perMonth != null ">,per_month</if>
            <if test="perMonthPrice != null ">,per_month_price</if>
            <if test="once != null ">,once</if>
            <if test="oncePrice != null ">,once_price</if>
            <if test="photo != null ">,photo</if>
            <if test="orderby != null ">,orderby</if>
            <if test="state != null ">,state</if>
            <if test="createBy != null ">,create_by</if>
            <if test="createDt != null ">,create_dt</if>
            <if test="modifyBy != null ">,modify_by</if>
            <if test="modifyDt != null ">,modify_dt</if>
            <if test="dr != null ">,dr</if>
            <if test="productDes != null ">,product_des</if>
            <if test="agentCiId != null ">,agent_ci_id</if>
            <if test="agentGroupId != null ">,agent_group_id</if>
        </trim>
        ) VALUES (
        <trim prefix=" " prefixOverrides=",">
            <if test="productId != null ">,#{productId}</if>
            <if test="spId != null ">,#{spId}</if>
            <if test="productName != null ">,#{productName}</if>
            <if test="areaId != null ">,#{areaId}</if>
            <if test="serviceType != null ">,#{serviceType}</if>
            <if test="perMonth != null ">,#{perMonth}</if>
            <if test="perMonthPrice != null ">,#{perMonthPrice}</if>
            <if test="once != null ">,#{once}</if>
            <if test="oncePrice != null ">,#{oncePrice}</if>
            <if test="photo != null ">,#{photo}</if>
            <if test="orderby != null ">,#{orderby}</if>
            <if test="state != null ">,#{state}</if>
            <if test="createBy != null ">,#{createBy}</if>
            <if test="createDt != null ">,#{createDt}</if>
            <if test="modifyBy != null ">,#{modifyBy}</if>
            <if test="modifyDt != null ">,#{modifyDt}</if>
            <if test="dr != null ">,#{dr}</if>
            <if test="productDes != null ">,#{productDes}</if>
            <if test="agentCiId != null ">,#{agentCiId}</if>
            <if test="agentGroupId != null ">,#{agentGroupId}</if>
        </trim>
        )
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="productId">
            SELECT LAST_INSERT_ID() AS PRODUCT_ID
        </selectKey>
    </insert>

    <!-- 根据id，修改记录-->
    <update id="UpdateSPS_MALL_PRODUCT" parameterType="Object">
        UPDATE SPS_MALL_PRODUCT
        <trim prefix=" SET " prefixOverrides=",">
            <if test="productId != null ">,product_id=#{productId}</if>
            <if test="spId != null ">,sp_id=#{spId}</if>
            <if test="productName != null ">,product_name=#{productName}</if>
            <if test="areaId != null ">,area_id=#{areaId}</if>
            <if test="serviceType != null ">,service_type=#{serviceType}</if>
            <if test="perMonth != null ">,per_month=#{perMonth}</if>
            <if test="perMonthPrice != null ">,per_month_price=#{perMonthPrice}</if>
            <if test="once != null ">,once=#{once}</if>
            <if test="oncePrice != null ">,once_price=#{oncePrice}</if>
            <if test="photo != null ">,photo=#{photo}</if>
            <if test="orderby != null ">,orderby=#{orderby}</if>
            <if test="state != null ">,state=#{state}</if>
            <if test="createBy != null ">,create_by=#{createBy}</if>
            <if test="createDt != null ">,create_dt=#{createDt}</if>
            <if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
            <if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
            <if test="dr != null ">,dr=#{dr}</if>
            <if test="productDes != null ">,product_des=#{productDes}</if>
            <if test="agentCiId != null ">,agent_ci_id=#{agentCiId}</if>
            <if test="agentGroupId != null ">,agent_group_id=#{agentGroupId}</if>
        </trim>
        WHERE PRODUCT_ID=#{productId}
    </update>

    <!-- 删除记录 -->
    <delete id="DeleteSPS_MALL_PRODUCT">DELETE FROM SPS_MALL_PRODUCT WHERE PRODUCT_ID=#{productId}</delete>
    <!-- sps_mall_product 列表总数-->
    <select id="CountFindAllSPS_MALL_PRODUCT"
            resultType="java.lang.Integer">SELECT count(1) as value FROM SPS_MALL_PRODUCT</select>
    <select id="CountSPS_MALL_PRODUCT"
            resultType="java.lang.Integer">SELECT count(1) as value FROM SPS_MALL_PRODUCT WHERE PRODUCT_ID=#{productId}</select>
    <!-- 根据id查询 sps_mall_product -->
    <select id="FindByPK" resultMap="result_map_SPS_MALL_PRODUCT" parameterType="Object">SELECT
        <include refid="Base_Column_List"/>
        FROM SPS_MALL_PRODUCT WHERE PRODUCT_ID=#{productId}
    </select>

    
    <!-- 根据各字段条件带排序  sps_mall_product -->
    <select id="FreeFindSPS_MALL_PRODUCTOrdered" resultMap="result_map_SPS_MALL_PRODUCT" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM SPS_MALL_PRODUCT
        <include refid="Example_Where_Clause2"/>
        ORDER BY ${_orderBy}
    </select>

    <!-- *****************************  温馨提示：  ***************************** -->
    <!-- **                                                                    ** -->
    <!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
    <!-- **                                             ** 2016/06/20 14:56:21 ** -->
    <!-- ************************************************************************ -->

    <!-- 获取服务商品列表 -->


    <!-- 条件搜索产品总数 -->
    <!--<select id="CountFindSPS_MALL_PRODUCT" resultType="java.lang.Integer" parameterType="Object">
        SELECT COUNT(1) AS value FROM (
        SELECT mp.* FROM sps_mall_product mp
        INNER JOIN sp_service ss ON mp.`sp_id` = ss.`sp_id`
        INNER JOIN sps_mall_info i ON ss.sp_id = i.sp_id
        INNER JOIN sps_mall_product_item mpi ON (mp.`product_id` = mpi.`product_id` AND mpi.`dr` = 0)
        INNER JOIN bs_mall_item mi ON (mpi.`item_id` = mi.`item_id` &lt;!&ndash;AND mp.`area_id` = mi.`area_id`&ndash;&gt; AND mi.`dr` =
        0)
        WHERE mp.`dr` = 0 AND i.dr = 0 AND mpi.`dr` = 0 AND mi.`dr` = 0 AND mp.`service_type` = 'B' AND mp.`state` =
        'ON' AND ss.enabled_mall = 'SIGNED'
        <if test="areaId != null">
            AND EXISTS (
            SELECT mpa.product_id FROM sps_mall_productarea mpa
            WHERE mpa.`area_id` = #{areaId} AND mp.product_id = mpa.product_id
            )
        </if>
        <if test="categoryId != null">
            AND EXISTS (
            SELECT mic.category_id FROM bs_mall_item_category mic
            WHERE mic.`category_id` = mi.`category_id` AND (mic.`pid` = #{categoryId} OR mic.`category_id` =
            #{categoryId})
            )
        </if>
        <if test="searchWord != null">
            AND (mp.`product_name` LIKE '%${searchWord}%' OR ss.`sp_name` LIKE '%${searchWord}%' OR ss.`short_name` LIKE
            '%${searchWord}%')
        </if>
        GROUP BY mp.`product_id`
        ) t
    </select>-->
    <!-- 条件搜索产品列表 -->
    <!--<select id="FindSPS_MALL_PRODUCT" resultType="java.util.Map" parameterType="Object">
        SELECT mp.*, ss.`sp_name`, ss.`short_name`, ss.`logo`, ss.`org_star`&lt;!&ndash;, a.`name` AS area_name&ndash;&gt;
        FROM sps_mall_product mp
        INNER JOIN sp_service ss ON mp.`sp_id` = ss.`sp_id`
        INNER JOIN sps_mall_info i ON ss.sp_id = i.sp_id
        &lt;!&ndash;INNER JOIN bs_area a ON mp.`area_id` = a.`area_id`&ndash;&gt;
        INNER JOIN sps_mall_product_item mpi ON (mp.`product_id` = mpi.`product_id` AND mpi.`dr` = 0)
        INNER JOIN bs_mall_item mi ON (mpi.`item_id` = mi.`item_id` &lt;!&ndash;AND mp.`area_id` = mi.`area_id`&ndash;&gt; AND mi.`dr` =
        0)
        WHERE mp.`dr` = 0 AND i.dr = 0 AND mpi.`dr` = 0 AND mi.`dr` = 0 AND mp.`service_type` = 'B' AND mp.`state` =
        'ON' AND ss.enabled_mall = 'SIGNED'
        <if test="areaId != null">
            AND EXISTS (
            SELECT mpa.product_id FROM sps_mall_productarea mpa
            WHERE mpa.`area_id` = #{areaId} AND mp.product_id = mpa.product_id
            )
        </if>
        <if test="categoryId != null">
            AND EXISTS (
            SELECT mic.category_id FROM bs_mall_item_category mic
            WHERE mic.`category_id` = mi.`category_id` AND (mic.`pid` = #{categoryId} OR mic.`category_id` =
            #{categoryId})
            )
        </if>
        <if test="searchWord != null">
            AND (mp.`product_name` LIKE '%${searchWord}%' OR ss.`sp_name` LIKE '%${searchWord}%' OR ss.`short_name` LIKE
            '%${searchWord}%')
        </if>
        GROUP BY mp.`product_id`
        ORDER BY mp.`per_month` DESC,
        <if test="orderByPrice != null">mp.per_month_price ${orderByPrice}, mp.once_price ${orderByPrice},</if>
        mp.`orderby` DESC, mp.`product_id` DESC
    </select>-->

    <select id="FindSP_SPS_MALL_PRODUCT" resultType="java.util.Map" parameterType="Object">
        SELECT mp.*<!--, a.`name` AS area_name-->
        FROM sps_mall_product mp
        INNER JOIN sps_mall_info i ON mp.sp_id = i.sp_id
        <!--INNER JOIN bs_area a ON mp.`area_id` = a.`area_id`-->
        WHERE mp.`dr` = 0 AND i.dr = 0 AND mp.`service_type` = 'B' AND mp.`state` = 'ON' AND mp.`sp_id` = #{spId}
        ORDER BY mp.`orderby` DESC, mp.`product_id` DESC
    </select>

    <select id="COUNTFINDSPS_MALL_PRODUCT" resultType="java.lang.Integer" parameterType="Object">
        SELECT COUNT(1) AS value FROM (
        SELECT mp.product_id FROM sps_mall_product mp
        INNER JOIN sp_service ss ON mp.`sp_id` = ss.`sp_id` AND ss.enabled_mall = 'SIGNED'
        INNER JOIN sps_mall_info i ON ss.sp_id = i.sp_id AND i.`dr` = 0
        INNER JOIN sps_mall_product_item mpi ON mp.`product_id` = mpi.`product_id` AND mpi.`dr` = 0
        INNER JOIN bs_mall_item mi ON mpi.`item_id` = mi.`item_id` AND mi.`dr` = 0
        INNER JOIN bs_mall_item_category mic ON mic.`category_id` = mi.`category_id` AND mic.`dr` = 0
        INNER JOIN sps_mall_productarea mpa ON mp.`product_id` = mpa.`product_id`
        INNER JOIN bs_area a ON mpa.`area_id` = a.`area_id`
        WHERE mp.`dr` = 0 AND mp.`service_type` = 'B' AND mp.`state` = 'ON'
        <if test="areaIds != null">AND mpa.`area_id` IN (${areaIds})</if>
        <if test="categoryIds != null">
            AND (mic.`pid` IN (${categoryIds}) OR mic.`category_id` IN (${categoryIds}))
        </if>
        <if test="spId != null">AND mp.sp_id = #{spId}</if>
        <if test="searchWord != null">
            AND (mp.`product_name` LIKE CONCAT('%', #{searchWord}, '%') OR mi.`item_name` LIKE CONCAT('%',
            #{searchWord}, '%')
            OR ss.`sp_name` LIKE CONCAT('%', #{searchWord}, '%') OR ss.`short_name` LIKE CONCAT('%', #{searchWord},
            '%'))
        </if>
        GROUP BY mp.`product_id`
        ) tab
    </select>

    <select id="FINDSPS_MALL_PRODUCT_LIST" resultType="java.util.Map" parameterType="Object">
        SELECT mp.`product_id`, mp.`product_name`, mp.`per_month`, mp.`per_month_price`, mp.`once`, mp.`once_price`,
        ss.`sp_name`, ss.`short_name`, GROUP_CONCAT(DISTINCT a.`name`) AS area_names
        FROM sps_mall_product mp
        INNER JOIN sp_service ss ON mp.`sp_id` = ss.`sp_id` AND ss.enabled_mall = 'SIGNED'
        INNER JOIN sps_mall_info i ON ss.sp_id = i.sp_id AND i.`dr` = 0
        INNER JOIN sps_mall_product_item mpi ON mp.`product_id` = mpi.`product_id` AND mpi.`dr` = 0
        INNER JOIN bs_mall_item mi ON mpi.`item_id` = mi.`item_id` AND mi.`dr` = 0
        INNER JOIN bs_mall_item_category mic ON mic.`category_id` = mi.`category_id` AND mic.`dr` = 0
        INNER JOIN sps_mall_productarea mpa ON mp.`product_id` = mpa.`product_id`
        INNER JOIN bs_area a ON mpa.`area_id` = a.`area_id`
        WHERE mp.`dr` = 0 AND mp.`service_type` = 'B' AND mp.`state` = 'ON'
        <if test="areaIds != null">
            AND EXISTS (
            SELECT mpa.product_id FROM sps_mall_productarea mpa WHERE mp.product_id = mpa.product_id AND mpa.`area_id`
            IN (${areaIds})
            )
        </if>
        <if test="categoryIds != null">
            AND (mic.`pid` IN (${categoryIds}) OR mic.`category_id` IN (${categoryIds}))
        </if>
        <if test="spId != null">AND mp.sp_id = #{spId}</if>
        <if test="searchWord != null">
            AND (mp.`product_name` LIKE CONCAT('%', #{searchWord}, '%') OR mi.`item_name` LIKE CONCAT('%',
            #{searchWord}, '%')
            OR ss.`sp_name` LIKE CONCAT('%', #{searchWord}, '%') OR ss.`short_name` LIKE CONCAT('%', #{searchWord},
            '%'))
        </if>
        GROUP BY mp.`product_id`
        ORDER BY mp.`orderby` DESC, mp.`product_id` DESC
    </select>

    <select id="FindSPS_MALL_PRODUCT_DETAIL" resultType="java.util.Map" parameterType="Object">
        SELECT mp.*, ss.`sp_name`, ss.`short_name`, ss.`logo`<!--, a.`name` AS area_name-->, ss.`company_level` FROM
        sps_mall_product mp
        INNER JOIN sp_service ss ON mp.`sp_id` = ss.`sp_id`
        INNER JOIN sps_mall_info i ON ss.sp_id = i.sp_id
        <!--INNER JOIN bs_area a ON mp.`area_id` = a.`area_id`-->
        WHERE i.dr = 0 AND mp.`product_id` = #{productId} AND ss.enabled_mall = 'SIGNED'
    </select>

    <select id="FindSP_SPS_MALL_PRODUCT_BY_SPID" resultType="java.util.Map" parameterType="Object">
        SELECT count(DISTINCT smpi.item_id) AS itemIdNum,smp.product_id ,smp.product_name ,smp.per_month, smp.product_des
        ,smp.per_month_price ,smp.once ,smp.once_price ,ss.sp_name, ss.short_name,GROUP_CONCAT(DISTINCT ba.name) AS
        area_names
        FROM sps_mall_product smp
        INNER JOIN sp_service ss ON smp.`sp_id` = ss.`sp_id` AND ss.enabled_mall = 'SIGNED'
        INNER JOIN sps_mall_info i ON smp.sp_id = i.sp_id
        INNER JOIN sps_mall_productarea smpa ON smpa.product_id = smp.product_id
        INNER JOIN sps_mall_product_item smpi ON smpi.product_id = smp.product_id
        INNER JOIN bs_area ba ON ba.area_id = smpa.area_id
        WHERE smp.`dr` = 0 AND i.dr = 0 AND smp.`service_type` = 'B' AND smp.`state` = 'ON' AND smp.sp_id = #{spId}
        <if test="productId != null">
            AND smp.product_id != #{productId}
        </if>
        GROUP BY smp.product_id
        ORDER BY smp.`orderby` DESC, smp.`product_id` DESC
    </select>
	
	<!-- 根据商城推荐商品列表及商品名称查询过滤  记录数 -->
	<select id="CountSPS_MALL_PRODUCT_By_Recom" resultType="java.lang.Integer" parameterType="Object">
	SELECT count(1) as value  
		FROM sps_mall_product ss
		LEFT JOIN bs_mall_recomproduct bb on ss.product_id = bb.product_id
		LEFT JOIN sp_service cc on ss.sp_id = cc.sp_id
		where 1=1
		and state ='ON' and bb.id is null
	    <if test="productName != null">AND product_name like '%${productName}%'</if>
 	</select>

<!-- 根据商城推荐服务商列表及服务商名称查询过滤  服务商信息 -->
	<select id="findSPS_MALL_PRODUCT_By_Recom" resultType="java.util.HashMap"
		parameterType="Object">
		SELECT
		ss.product_id productId,ss.product_name productName,ss.per_month perMonth,ss.per_month_price perMonthPrice,
		ss.once,ss.once_price oncePrice,cc.sp_name spName
		FROM sps_mall_product ss
		LEFT JOIN bs_mall_recomproduct bb on ss.product_id = bb.product_id
		LEFT JOIN sp_service cc on ss.sp_id = cc.sp_id
		where 1=1
		and state ='ON' and bb.id is null
	    <if test="productName != null">AND product_name like '%${productName}%'</if>
	    <if test="spName != null">AND sp_name like '%${spName}%'</if>
	</select>
		<select id="findAllmsg" resultType="java.util.Map" parameterType="Object">
		SELECT s.sp_name,product_id,s.sp_id,product_name,service_type,per_month,per_month_price,once,once_price,photo,orderby,state,p.create_by,p.create_dt,p.modify_by,p.modify_dt,dr,product_des 
		FROM sps_mall_product p,sp_service s
		WHERE p.sp_id = s.sp_id	
		<if test="sp_name != null">AND s.sp_name=#{sp_name }</if>		
	</select>
	<select id="findAllCount" resultType="java.lang.Integer" parameterType="Object">
		SELECT count(1)
		FROM sps_mall_product p,sp_service s
		WHERE p.sp_id = s.sp_id	
		<if test="sp_name != null">AND s.sp_name=#{sp_name }</if>	
	</select>
	
	<select id="FreeFindSPS_MALL_PRODUCT" resultMap="result_map_SPS_MALL_PRODUCT" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM SPS_MALL_PRODUCT 
	 where sp_id = #{spId} and dr=0
	 <if test="productNameEq != null">and product_name like '%${productNameEq}%'</if>
	 <if test="serviceType != null">and service_type = #{serviceType}</if>
	 <if test="state != null">and state = #{state}</if>
	 order by orderby desc
</select>
<!-- 服务产品 记录数 -->
<select id="CountFreeFindSPS_MALL_PRODUCT" resultType="java.lang.Integer">
SELECT count(1) as value FROM SPS_MALL_PRODUCT 
 where sp_id = #{spId} and dr=0
 <if test="productNameEq != null">and product_name like '%${productNameEq}%'</if>
 <if test="serviceType != null">and service_type = #{serviceType}</if>
 <if test="state != null">and state = #{state}</if>
</select>

<!-- 根据各字段条件带模糊查询  sps_mall_product -->
    <select id="FreeFindSPS_MALL_PRODUCT_CS" resultMap="result_map_SPS_MALL_PRODUCT" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM SPS_MALL_PRODUCT
        <include refid="Example_Where_Clause2"/>
    </select>
    <!-- 根据各字段条件带模糊查询  sps_mall_product 记录数 -->
    <select id="CountFreeFindSPS_MALL_PRODUCT_CS" resultType="java.lang.Integer">
        SELECT count(1) as value FROM SPS_MALL_PRODUCT
        <include refid="Example_Where_Clause2"/>
    </select>

<!-- 根据 区域ID 查询bs所有项目-->
<select id="FindAllBySpIdAreaId" resultType="java.util.Map" parameterType="Object">
	select ssr.sp_id,bmi.* from sp_service ssr
	inner join  bs_mall_item  bmi on bmi.area_id = 
	(select a.area_id as id from bs_area a 
	where locate(a.code, (select code from bs_area where area_id = ssr.area_id)) = 1 
	and EXISTS (
		select 1 from bs_areabusi ab WHERE a.area_id = ab.area_id
	))
	inner join bs_mall_item_category c on bmi.category_id = c.category_id 
	where ssr.sp_id=#{spId} and bmi.dr=0 and c.category_type in ('INSURANCE','FUND') 
	order by bmi.item_id
</select>
<!-- 根据id，修改记录-->  
<update id="UpdateOrderByByProductId" parameterType="Object" >
update sps_mall_product set orderby =#{orderby}
where product_id=#{orderby}
</update>

<select id="FindAreaIdBySpAreaId" parameterType="Object" resultMap="result_map_SPS_MALL_PRODUCT">
select a.area_id from bs_area a 
	where locate(a.code, (select code from bs_area where area_id =#{areaId})) = 1 
	and EXISTS (
		select 1 from bs_areabusi ab WHERE a.area_id = ab.area_id
	)
</select>

	<select id="FindAreaName" resultType="java.lang.String" parameterType="java.lang.Integer">
		SELECT name FROM bs_area
	 	where area_id = #{areaId}
	</select>  
</mapper>   
