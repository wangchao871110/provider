<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SPS_MALL_CUSTOMER" >
	<!-- Result Map-->
	<resultMap id="result_map_SPS_MALL_CUSTOMER" type="com.xfs.mall.customer.model.SpsMallCustomer" >
		<result column="customer_id" property="customerId"/>
		<result column="sp_id" property="spId"/>
		<result column="customer_name" property="customerName"/>
		<result column="nick_name" property="nickName"/>
		<result column="sex" property="sex"/>
		<result column="service_type" property="serviceType"/>
		<result column="service_star" property="serviceStar"/>
		<result column="service_year" property="serviceYear"/>
		<result column="photo" property="photo"/>
		<result column="service_feature" property="serviceFeature"/>
		<result column="orderby" property="orderby"/>
		<result column="state" property="state"/>
		<result column="create_by" property="createBy"/>
		<result column="create_dt" property="createDt"/>
		<result column="modify_by" property="modifyBy"/>
		<result column="modify_dt" property="modifyDt"/>
		<result column="dr" property="dr"/>
		<result column="defaultb" property="defaultb"/>
		<result column="defaultc" property="defaultc"/>
		<result column="user_id" property="userId"/>
		<result column="score" property="score"/>
	</resultMap>

	<!-- sps_mall_customer table all fields -->
	<sql id="Base_Column_List" >
		customer_id,sp_id,customer_name,nick_name,sex,service_type,service_star,service_year,photo,service_feature,orderby,state,create_by,create_dt,modify_by,modify_dt,dr,defaultb,defaultc,user_id
	</sql>

	<!-- 查询条件 -->
	<sql id="Example_Where_Clause">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="customerId != null" >and customer_id = #{customerId}</if>
			<if test="spId != null" >and sp_id = #{spId}</if>
			<if test="customerName != null" >and customer_name = #{customerName}</if>
			<if test="nickName != null" >and nick_name = #{nickName}</if>
			<if test="sex != null" >and sex = #{sex}</if>
			<if test="serviceType != null" >and service_type = #{serviceType}</if>
			<if test="serviceStar != null" >and service_star = #{serviceStar}</if>
			<if test="serviceYear != null" >and service_year = #{serviceYear}</if>
			<if test="photo != null" >and photo = #{photo}</if>
			<if test="serviceFeature != null" >and service_feature = #{serviceFeature}</if>
			<if test="orderby != null" >and orderby = #{orderby}</if>
			<if test="state != null" >and state = #{state}</if>
			<if test="createBy != null" >and create_by = #{createBy}</if>
			<if test="createDt != null" >and create_dt = #{createDt}</if>
			<if test="modifyBy != null" >and modify_by = #{modifyBy}</if>
			<if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
			<if test="dr != null" >and dr = #{dr}</if>
			<if test="defaultb != null" >and defaultb = #{defaultb}</if>
			<if test="defaultc != null" >and defaultc = #{defaultc}</if>
			<if test="userId != null" >and user_id = #{userId}</if>
		</trim>
	</sql>

	<!-- 查询条件 带模糊查询 以及 时间起始查询 -->
	<sql id="Example_Where_Clause2">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="customerId != null">AND customer_id = '${customerId}'</if>
			<if test="spId != null">AND sp_id = '${spId}'</if>
			<if test="customerName != null">AND customer_name like '%${customerName}%'</if>
			<if test="customerNameEq != null">AND customer_name = #{customerNameEq}</if>
			<if test="nickName != null">AND nick_name like '%${nickName}%'</if>
			<if test="nickNameEq != null">AND nick_name = #{nickNameEq}</if>
			<if test="sex != null">AND sex like '%${sex}%'</if>
			<if test="sexEq != null">AND sex = #{sexEq}</if>
			<if test="serviceType != null">AND service_type like '%${serviceType}%'</if>
			<if test="serviceTypeEq != null">AND service_type = #{serviceTypeEq}</if>
			<if test="serviceStar != null">AND service_star like '%${serviceStar}%'</if>
			<if test="serviceYear != null">AND service_year like '%${serviceYear}%'</if>
			<if test="serviceYearEq != null">AND service_year = #{serviceYearEq}</if>
			<if test="photo != null">AND photo like '%${photo}%'</if>
			<if test="serviceFeature != null">AND service_feature like '%${serviceFeature}%'</if>
			<if test="serviceFeatureEq != null">AND service_feature = #{serviceFeatureEq}</if>
			<if test="orderby != null">AND orderby like '%${orderby}%'</if>
			<if test="state != null">AND state like '%${state}%'</if>
			<if test="stateEq != null">AND state = #{stateEq}</if>
			<if test="createBy != null">AND create_by = '%${createBy}%'</if>
			<if test="createDt != null">AND create_dt = #{createDt}</if>
			<if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
			<if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
			<if test="modifyBy != null">AND modify_by = '%${modifyBy}%'</if>
			<if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
			<if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
			<if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
			<if test="dr != null">AND dr like '%${dr}%'</if>
			<if test="defaultb != null">AND defaultb like '%${defaultb}%'</if>
			<if test="defaultbEq != null">AND defaultb = #{defaultbEq}</if>
			<if test="defaultc != null">AND defaultc like '%${defaultc}%'</if>
			<if test="defaultcEq != null">AND defaultc = #{defaultcEq}</if>
			<if test="userId != null">AND user_id = '${userId}'</if>
		</trim>
	</sql>

	<!-- 插入记录 -->
	<insert id="InsertSPS_MALL_CUSTOMER" parameterType="Object" >
		INSERT INTO SPS_MALL_CUSTOMER (
		<trim prefix=" " prefixOverrides=",">
			<if test="customerId != null ">,customer_id</if>
			<if test="spId != null ">,sp_id</if>
			<if test="customerName != null ">,customer_name</if>
			<if test="nickName != null ">,nick_name</if>
			<if test="sex != null ">,sex</if>
			<if test="serviceType != null ">,service_type</if>
			<if test="serviceStar != null ">,service_star</if>
			<if test="serviceYear != null ">,service_year</if>
			<if test="photo != null ">,photo</if>
			<if test="serviceFeature != null ">,service_feature</if>
			<if test="orderby != null ">,orderby</if>
			<if test="state != null ">,state</if>
			<if test="createBy != null ">,create_by</if>
			<if test="createDt != null ">,create_dt</if>
			<if test="modifyBy != null ">,modify_by</if>
			<if test="modifyDt != null ">,modify_dt</if>
			<if test="dr != null ">,dr</if>
			<if test="defaultb != null ">,defaultb</if>
			<if test="defaultc != null ">,defaultc</if>
			<if test="userId != null ">,user_id</if>
		</trim>
		)  VALUES (
		<trim prefix=" " prefixOverrides=",">
			<if test="customerId != null ">,#{customerId}</if>
			<if test="spId != null ">,#{spId}</if>
			<if test="customerName != null ">,#{customerName}</if>
			<if test="nickName != null ">,#{nickName}</if>
			<if test="sex != null ">,#{sex}</if>
			<if test="serviceType != null ">,#{serviceType}</if>
			<if test="serviceStar != null ">,#{serviceStar}</if>
			<if test="serviceYear != null ">,#{serviceYear}</if>
			<if test="photo != null ">,#{photo}</if>
			<if test="serviceFeature != null ">,#{serviceFeature}</if>
			<if test="orderby != null ">,#{orderby}</if>
			<if test="state != null ">,#{state}</if>
			<if test="createBy != null ">,#{createBy}</if>
			<if test="createDt != null ">,#{createDt}</if>
			<if test="modifyBy != null ">,#{modifyBy}</if>
			<if test="modifyDt != null ">,#{modifyDt}</if>
			<if test="dr != null ">,#{dr}</if>
			<if test="defaultb != null ">,#{defaultb}</if>
			<if test="defaultc != null ">,#{defaultc}</if>
			<if test="userId != null ">,#{userId}</if>
		</trim>
		)
		<selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="customerId">
			SELECT LAST_INSERT_ID() AS CUSTOMER_ID
		</selectKey>
	</insert>

	<!-- 根据id，修改记录-->
	<update id="UpdateSPS_MALL_CUSTOMER" parameterType="Object" >
		UPDATE SPS_MALL_CUSTOMER
		<trim prefix=" SET " prefixOverrides=",">
			<if test="customerId != null ">,customer_id=#{customerId}</if>
			<if test="spId != null ">,sp_id=#{spId}</if>
			<if test="customerName != null ">,customer_name=#{customerName}</if>
			<if test="nickName != null ">,nick_name=#{nickName}</if>
			<if test="sex != null ">,sex=#{sex}</if>
			<if test="serviceType != null ">,service_type=#{serviceType}</if>
			<if test="serviceStar != null ">,service_star=#{serviceStar}</if>
			<if test="serviceYear != null ">,service_year=#{serviceYear}</if>
			<if test="photo != null ">,photo=#{photo}</if>
			<if test="serviceFeature != null ">,service_feature=#{serviceFeature}</if>
			<if test="orderby != null ">,orderby=#{orderby}</if>
			<if test="state != null ">,state=#{state}</if>
			<if test="createBy != null ">,create_by=#{createBy}</if>
			<if test="createDt != null ">,create_dt=#{createDt}</if>
			<if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
			<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
			<if test="dr != null ">,dr=#{dr}</if>
			<if test="defaultb != null ">,defaultb=#{defaultb}</if>
			<if test="defaultc != null ">,defaultc=#{defaultc}</if>
			<if test="userId != null ">,user_id=#{userId}</if>
		</trim>
		WHERE CUSTOMER_ID=#{customerId}
	</update>

	<!-- 删除记录 -->
	<delete id="DeleteSPS_MALL_CUSTOMER">DELETE FROM SPS_MALL_CUSTOMER WHERE CUSTOMER_ID=#{customerId}</delete>
	<!-- sps_mall_customer 列表总数-->
	<select id="CountFindAllSPS_MALL_CUSTOMER" resultType="java.lang.Integer">SELECT count(1) as value FROM SPS_MALL_CUSTOMER</select>
	<select id="CountSPS_MALL_CUSTOMER" resultType="java.lang.Integer">SELECT count(1) as value FROM SPS_MALL_CUSTOMER WHERE CUSTOMER_ID=#{customerId}</select>
	<!-- 根据id查询 sps_mall_customer -->
	<select id="FindByPK" resultMap="result_map_SPS_MALL_CUSTOMER" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM SPS_MALL_CUSTOMER WHERE CUSTOMER_ID=#{customerId}</select>

	<!-- 根据各字段条件带模糊查询  sps_mall_customer -->
	<select id="FreeFindSPS_MALL_CUSTOMER" resultMap="result_map_SPS_MALL_CUSTOMER" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SPS_MALL_CUSTOMER
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带模糊查询  sps_mall_customer 记录数 -->
	<select id="CountFreeFindSPS_MALL_CUSTOMER" resultType="java.lang.Integer">
		SELECT count(1) as value FROM SPS_MALL_CUSTOMER
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带排序  sps_mall_customer -->
	<select id="FreeFindSPS_MALL_CUSTOMEROrdered" resultMap="result_map_SPS_MALL_CUSTOMER" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SPS_MALL_CUSTOMER
		<include refid="Example_Where_Clause2" />
		ORDER BY ${_orderBy}
	</select>

	<!-- *****************************  温馨提示：  ***************************** -->
	<!-- **                                                                    ** -->
	<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
	<!-- **                                             ** 2016/06/15 14:42:35 ** -->
	<!-- ************************************************************************ -->

	<!-- 注意：上面有score字段，请勿整体替换mapper文件！！！ -->
	<!-- 商铺客服列表(如果default不为空，则查询默认客户) -->
	<select id="FindSPS_MALL_CUSTOMER" resultMap="result_map_SPS_MALL_CUSTOMER" parameterType="Object">
		SELECT mc.*, sc.score,su.mobile FROM SPS_MALL_CUSTOMER mc
			LEFT JOIN bd_score_collection sc ON sc.score_target_type = 'CUSTOMER' AND mc.customer_id = sc.score_target_id AND sc.dr = 0
			LEFT JOIN sys_user su ON su.user_id = mc.user_id
			WHERE mc.dr = 0 AND mc.`state` = 'ON' AND (mc.service_type = 'A' OR mc.service_type = 'B') AND mc.sp_id = #{spId}
			<if test="defaultb != null "> AND mc.defaultb = #{defaultb}</if>
			<if test="defaultc != null "> AND mc.defaultc = #{defaultc}</if>
			ORDER BY mc.orderby DESC, mc.customer_id DESC
	</select>

	<select id="FindBusinessCustomers" resultMap="result_map_SPS_MALL_CUSTOMER" parameterType="Object">
		SELECT mc.*, sc.score FROM SPS_MALL_CUSTOMER mc
			INNER JOIN SP_SERVICE s ON mc.sp_id = s.sp_id
			LEFT JOIN bd_score_collection sc ON sc.score_target_type = 'CUSTOMER' AND mc.customer_id = sc.score_target_id AND sc.dr = 0
			WHERE mc.dr = 0 AND mc.`state` = 'ON' AND (mc.service_type = 'A' OR mc.service_type = 'B')
			AND s.sp_id = 87
			ORDER BY mc.orderby DESC, mc.customer_id DESC
	</select>

	<!-- 查询客服的手机号 -->
	<select id="FindSPS_MALL_CUSTOMER_MOBILE" resultType="java.util.Map" parameterType="Object">
		SELECT mc.`sp_id`, mc.`user_id`, u.`mobile` FROM sps_mall_customer mc
			INNER JOIN sys_user u ON mc.`user_id` = u.`user_id`
			WHERE mc.`sp_id` = #{spId} AND mc.`dr` = 0 AND mc.`defaultb` = 'Y'
	</select>
	
	<!--FreeFindSPS_MALL_CUSTOMER添加了order by customer_id desc modify by lifq 
		20160612 -->
	<select id="findByIMUserid" resultMap="result_map_SPS_MALL_CUSTOMER"
			parameterType="Object">
		SELECT ss.*
		FROM SPS_MALL_CUSTOMER ss
		where ss.user_id=#{user_id}
	</select>
	<select id="findByMyUserid" resultType="java.util.Map"
			parameterType="Object">
		SELECT ss.customer_id customerId,ss.customer_name customerName,pp.sp_name spName
		FROM SPS_MALL_CUSTOMER ss
		INNER JOIN sp_service pp ON ss.sp_id = pp.sp_id
		where ss.user_id=#{user_id}
	</select>
	
	<!-- 根据各字段条件带模糊查询  商城客服表 -->
	<select id="findAllNotCurrent" resultMap="result_map_SPS_MALL_CUSTOMER" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SPS_MALL_CUSTOMER 
		 where user_id=#{userId} and sp_id = #{spId} 
		  <if test="customerId != null "> and customer_id != #{customerId} </if>
	</select>

</mapper>   
