<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SPS_FEE_EMPONCEDETAIL" > 
<!-- Result Map-->
<resultMap id="result_map_SPS_FEE_EMPONCEDETAIL" type="com.xfs.bill.model.SpsFeeEmponcedetail" >
	<result column="id" property="id"/>
	<result column="emp_fee_id" property="empFeeId"/>
	<result column="insurance_type" property="insuranceType"/>
	<result column="state" property="state"/>
	<result column="emp_ratio" property="empRatio"/>
	<result column="corp_ratio" property="corpRatio"/>
	<result column="corp_payment" property="corpPayment"/>
	<result column="emp_payment" property="empPayment"/>
	<result column="ratio_id" property="ratioId"/>
	<result column="emp_paybase" property="empPaybase"/>
	<result column="corp_paybase" property="corpPaybase"/>
	<result column="corp_addition" property="corpAddition"/>
	<result column="psn_addition" property="psnAddition"/>
</resultMap>
       
<!-- sps_fee_emponcedetail table all fields -->
<sql id="Base_Column_List" >
	 id,emp_fee_id,insurance_type,state,emp_ratio,corp_ratio,corp_payment,emp_payment,ratio_id,emp_paybase,corp_paybase,corp_addition,psn_addition
</sql>

<!-- 查询条件 -->
<sql id="Example_Where_Clause">
  <trim prefix=" WHERE " prefixOverrides="AND ">
	<if test="id != null" >and id = #{id}</if>
	<if test="empFeeId != null" >and emp_fee_id = #{empFeeId}</if>
	<if test="insuranceType != null" >and insurance_type = #{insuranceType}</if>
	<if test="state != null" >and state = #{state}</if>
	<if test="empRatio != null" >and emp_ratio = #{empRatio}</if>
	<if test="corpRatio != null" >and corp_ratio = #{corpRatio}</if>
	<if test="corpPayment != null" >and corp_payment = #{corpPayment}</if>
	<if test="empPayment != null" >and emp_payment = #{empPayment}</if>
	<if test="ratioId != null" >and ratio_id = #{ratioId}</if>
	<if test="empPaybase != null" >and emp_paybase = #{empPaybase}</if>
	<if test="corpPaybase != null" >and corp_paybase = #{corpPaybase}</if>
	<if test="corpAddition != null" >and corp_addition = #{corpAddition}</if>
	<if test="psnAddition != null" >and psn_addition = #{psnAddition}</if>
</trim>
</sql>

<!-- 插入记录 -->
<insert id="InsertSPS_FEE_EMPONCEDETAIL" parameterType="Object" >
  INSERT INTO SPS_FEE_EMPONCEDETAIL (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,id</if>
	<if test="empFeeId != null ">,emp_fee_id</if>
	<if test="insuranceType != null ">,insurance_type</if>
	<if test="state != null ">,state</if>
	<if test="empRatio != null ">,emp_ratio</if>
	<if test="corpRatio != null ">,corp_ratio</if>
	<if test="corpPayment != null ">,corp_payment</if>
	<if test="empPayment != null ">,emp_payment</if>
	<if test="ratioId != null ">,ratio_id</if>
	<if test="empPaybase != null ">,emp_paybase</if>
	<if test="corpPaybase != null ">,corp_paybase</if>
	<if test="corpAddition != null ">,corp_addition</if>
	<if test="psnAddition != null ">,psn_addition</if>
  </trim>
  )  VALUES (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,#{id}</if>
	<if test="empFeeId != null ">,#{empFeeId}</if>
	<if test="insuranceType != null ">,#{insuranceType}</if>
	<if test="state != null ">,#{state}</if>
	<if test="empRatio != null ">,#{empRatio}</if>
	<if test="corpRatio != null ">,#{corpRatio}</if>
	<if test="corpPayment != null ">,#{corpPayment}</if>
	<if test="empPayment != null ">,#{empPayment}</if>
	<if test="ratioId != null ">,#{ratioId}</if>
	<if test="empPaybase != null ">,#{empPaybase}</if>
	<if test="corpPaybase != null ">,#{corpPaybase}</if>
	<if test="corpAddition != null ">,#{corpAddition}</if>
	<if test="psnAddition != null ">,#{psnAddition}</if>
  </trim>
  )
  <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
	SELECT LAST_INSERT_ID() AS ID
  </selectKey>
</insert>

<!-- 根据id，修改记录-->  
<update id="UpdateSPS_FEE_EMPONCEDETAIL" parameterType="Object" >
UPDATE SPS_FEE_EMPONCEDETAIL 
  <trim prefix=" SET " prefixOverrides=",">
	,id=#{id}
	,emp_fee_id=#{empFeeId}
	,insurance_type=#{insuranceType}
	,state=#{state}
	,emp_ratio=#{empRatio}
	,corp_ratio=#{corpRatio}
	,corp_payment=#{corpPayment}
	,emp_payment=#{empPayment}
	,ratio_id=#{ratioId}
	,emp_paybase=#{empPaybase}
	,corp_paybase=#{corpPaybase}
	,corp_addition=#{corpAddition}
	,psn_addition=#{psnAddition}
  </trim>
WHERE ID=#{id}
</update>
 
<!-- 删除记录 -->
<delete id="DeleteSPS_FEE_EMPONCEDETAIL">DELETE FROM SPS_FEE_EMPONCEDETAIL WHERE ID=#{id}</delete>
<!-- 员工一次性费用明细 列表总数-->
<select id="CountFindAllSPS_FEE_EMPONCEDETAIL" resultType="java.lang.Integer">SELECT count(1) as value FROM SPS_FEE_EMPONCEDETAIL</select>
<select id="CountSPS_FEE_EMPONCEDETAIL" resultType="java.lang.Integer">SELECT count(1) as value FROM SPS_FEE_EMPONCEDETAIL WHERE ID=#{id}</select>
<!-- 根据id查询 员工一次性费用明细 -->
<select id="FindByPK" resultMap="result_map_SPS_FEE_EMPONCEDETAIL" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM SPS_FEE_EMPONCEDETAIL WHERE ID=#{pk}</select>

<!-- 根据各字段条件带查询  员工一次性费用明细 -->
<select id="FreeFindSPS_FEE_EMPONCEDETAIL" resultMap="result_map_SPS_FEE_EMPONCEDETAIL" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM SPS_FEE_EMPONCEDETAIL 
	 <include refid="Example_Where_Clause" />
</select>
<!-- 根据各字段条件带查询  员工一次性费用明细 记录数 -->
<select id="CountFreeFindSPS_FEE_EMPONCEDETAIL" resultType="java.lang.Integer">
SELECT count(1) as value FROM SPS_FEE_EMPONCEDETAIL 
 <include refid="Example_Where_Clause" />
</select>
<!-- 根据各字段条件带排序  员工一次性费用明细 -->
<select id="FreeFindSPS_FEE_EMPONCEDETAILOrdered" resultMap="result_map_SPS_FEE_EMPONCEDETAIL" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM SPS_FEE_EMPONCEDETAIL 
	 <include refid="Example_Where_Clause" />
	 ORDER BY ${_orderBy}
</select>

<!-- *****************************  温馨提示：  ***************************** -->
<!-- **                                                                    ** -->
<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
<!-- **                                             ** 2016/09/25 16:45:53 ** -->
<!-- ************************************************************************ -->

	<!-- 查看当前员工补缴详情 -->
	<select id="QUERY_EMP_BACK_INUS_INFO" resultType="java.util.Map" parameterType="Object">
		SELECT ins.`name`,detail.* FROM sps_fee_emponcedetail detail
		INNER JOIN sps_fee_emponce emponce ON detail.emp_fee_id = emponce.id
		AND emponce.sp_id = #{sp_id} AND emponce.cp_id = #{cp_id} AND emponce.emp_id = #{emp_id}
		INNER JOIN bd_insurance ins ON ins.insurance_id = detail.insurance_type
	</select>

	<select id="QUERY_EMP_BACK_INUS_INFO_LIST" resultMap="result_map_SPS_FEE_EMPONCEDETAIL" parameterType="Object">
		SELECT detail.* FROM sps_fee_emponcedetail detail WHERE detail.emp_fee_id = #{emp_fee_id}
	</select>
	
	<!-- 查看补缴信息 -->
	<select id="FIND_EMP_BACK_INUS_INFO" resultType="java.util.Map" parameterType="Object">
		SELECT
		once.insured_month,
		ins.`name`,
		detail.*
		FROM
		sps_fee_emponcedetail detail
		INNER JOIN sps_fee_emponce once ON detail.emp_fee_id = once.id AND once.sourceid = #{sourceid}
		AND once.emp_id = #{empId}
		INNER JOIN bd_insurance ins ON ins.insurance_id = detail.insurance_type
		ORDER BY
		once.insured_month ,detail.insurance_type ASC
		<!-- once.id ASC -->
	</select>
	<!-- 查看汇缴信息 社保 公积金 增加 新参 增员 根据begin_task ，减少 减员  根据 bstypeId = 4,11 用 end_task, 去重 taskid经过比例变更后会变多条-->
	<select id="FIND_EMP_BACK_INUS_INFO_HJ" resultType="java.util.Map" parameterType="Object">
		select bi.name as insurance_name,cei.* 
		from cm_employee_insurance cei 
		left join bd_insurance bi on cei.insurance_id = bi.insurance_id
		where cei.id in (select min(id) from cm_employee_insurance ein where 
		<if test="bstypeId ==4||bstypeId ==11"> ein.end_task =#{taskId} and</if>
		<if test="bstypeId ==2||bstypeId ==3||bstypeId ==10"> ein.begin_task =#{taskId} and</if>
		 ein.emp_id =#{empId} and ein.pay_type = 'MONTH' group by emp_id,insurance_id) and cei.pay_type = 'MONTH'
		 order by cei.insurance_id 
	</select>
</mapper>   
