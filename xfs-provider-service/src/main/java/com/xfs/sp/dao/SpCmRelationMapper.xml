<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SP_CM_RELATION" > 
<!-- Result Map-->
<resultMap id="result_map_SP_CM_RELATION" type="com.xfs.sp.model.SpCmRelation" >
	<result column="id" property="id"/>
	<result column="cp_id" property="cpId"/>
	<result column="sp_id" property="spId"/>
	<result column="insurance_type" property="insuranceType"/>
	<result column="reg_num" property="regNum"/>
	<result column="area_id" property="areaId"/>
	<result column="create_by" property="createBy"/>
	<result column="create_dt" property="createDt"/>
	<result column="modify_by" property="modifyBy"/>
	<result column="modify_dt" property="modifyDt"/>
	<result column="reg_numpass" property="regNumpass"/>
	<result column="reg_usbkeypass" property="regUsbkeypass"/>
	<result column="insurance_account_id" property="insuranceAccountId"/>
	<result column="fund_type" property="fundType"/>
	<result column="fund_account_id" property="fundAccountId"/>
	<result column="bill_liaison" property="billLiaison"/>
	<result column="bill_mail" property="billMail"/>
	<result column="bill_day" property="billDay"/>
	<result column="service_price" property="servicePrice"/>
	<result column="charge_mode" property="chargeMode"/>
	<result column="charge_mode_remark" property="chargeModeRemark"/>
	<result column="source" property="source"/>
	<result column="contract_type" property="contractType"/>
	<result column="dr" property="dr"/>
</resultMap>

	<!-- sp_cm_relation table all fields -->
	<sql id="Base_Column_List" >
		id,cp_id,sp_id,insurance_type,reg_num,area_id,create_by,create_dt,modify_by,modify_dt,reg_numpass,reg_usbkeypass,insurance_account_id,fund_type,fund_account_id,bill_liaison,bill_mail,bill_day,service_price,charge_mode,charge_mode_remark,source,contract_type,dr
	</sql>

	<!-- 查询条件 -->
	<sql id="Example_Where_Clause">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="id != null" >and id = #{id}</if>
			<if test="cpId != null" >and cp_id = #{cpId}</if>
			<if test="spId != null" >and sp_id = #{spId}</if>
			<if test="insuranceType != null" >and insurance_type = #{insuranceType}</if>
			<if test="regNum != null" >and reg_num = #{regNum}</if>
			<if test="areaId != null" >and area_id = #{areaId}</if>
			<if test="createBy != null" >and create_by = #{createBy}</if>
			<if test="createDt != null" >and create_dt = #{createDt}</if>
			<if test="modifyBy != null" >and modify_by = #{modifyBy}</if>
			<if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
			<if test="regNumpass != null" >and reg_numpass = #{regNumpass}</if>
			<if test="regUsbkeypass != null" >and reg_usbkeypass = #{regUsbkeypass}</if>
			<if test="insuranceAccountId != null" >and insurance_account_id = #{insuranceAccountId}</if>
			<if test="fundType != null" >and fund_type = #{fundType}</if>
			<if test="fundAccountId != null" >and fund_account_id = #{fundAccountId}</if>
			<if test="billLiaison != null" >and bill_liaison = #{billLiaison}</if>
			<if test="billMail != null" >and bill_mail = #{billMail}</if>
			<if test="billDay != null" >and bill_day = #{billDay}</if>
			<if test="servicePrice != null" >and service_price = #{servicePrice}</if>
			<if test="chargeMode != null" >and charge_mode = #{chargeMode}</if>
			<if test="chargeModeRemark != null" >and charge_mode_remark = #{chargeModeRemark}</if>
			<if test="source != null" >and source = #{source}</if>
			<if test="contractType != null" >and contract_type = #{contractType}</if>
			<if test="dr != null" >and dr = #{dr}</if>
		</trim>
	</sql>

	<!-- 查询条件 带模糊查询 以及 时间起始查询 -->
	<sql id="Example_Where_Clause2">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="id != null">AND id = #{id}</if>
			<if test="cpId != null">AND cp_id = #{cpId}</if>
			<if test="spId != null">AND sp_id = #{spId}</if>
			<if test="insuranceType != null">AND insurance_type like '%${insuranceType}%'</if>
			<if test="insuranceTypeEq != null">AND insurance_type = #{insuranceTypeEq}</if>
			<if test="regNum != null">AND reg_num like '%${regNum}%'</if>
			<if test="regNumEq != null">AND reg_num = #{regNumEq}</if>
			<if test="areaId != null">AND area_id = #{areaId}</if>
			<if test="createBy != null">AND create_by = #{createBy}</if>
			<if test="createDt != null">AND create_dt = #{createDt}</if>
			<if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
			<if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
			<if test="modifyBy != null">AND modify_by = #{modifyBy}</if>
			<if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
			<if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
			<if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
			<if test="regNumpass != null">AND reg_numpass like '%${regNumpass}%'</if>
			<if test="regNumpassEq != null">AND reg_numpass = #{regNumpassEq}</if>
			<if test="regUsbkeypass != null">AND reg_usbkeypass like '%${regUsbkeypass}%'</if>
			<if test="regUsbkeypassEq != null">AND reg_usbkeypass = #{regUsbkeypassEq}</if>
			<if test="insuranceAccountId != null">AND insurance_account_id = #{insuranceAccountId}</if>
			<if test="fundType != null">AND fund_type like '%${fundType}%'</if>
			<if test="fundTypeEq != null">AND fund_type = #{fundTypeEq}</if>
			<if test="fundAccountId != null">AND fund_account_id = #{fundAccountId}</if>
			<if test="billLiaison != null">AND bill_liaison like '%${billLiaison}%'</if>
			<if test="billLiaisonEq != null">AND bill_liaison = #{billLiaisonEq}</if>
			<if test="billMail != null">AND bill_mail like '%${billMail}%'</if>
			<if test="billMailEq != null">AND bill_mail = #{billMailEq}</if>
			<if test="billDay != null">AND bill_day like '%${billDay}%'</if>
			<if test="billDayEq != null">AND bill_day = #{billDayEq}</if>
			<if test="servicePrice != null">AND service_price like '%${servicePrice}%'</if>
			<if test="chargeMode != null">AND charge_mode like '%${chargeMode}%'</if>
			<if test="chargeModeEq != null">AND charge_mode = #{chargeModeEq}</if>
			<if test="chargeModeRemark != null">AND charge_mode_remark like '%${chargeModeRemark}%'</if>
			<if test="chargeModeRemarkEq != null">AND charge_mode_remark = #{chargeModeRemarkEq}</if>
			<if test="source != null">AND source like '%${source}%'</if>
			<if test="sourceEq != null">AND source = #{sourceEq}</if>
			<if test="contractType != null">AND contract_type = #{contractType}</if>
			<if test="dr != null">AND dr = #{dr}</if>
		</trim>
	</sql>

	<!-- 插入记录 -->
	<insert id="InsertSP_CM_RELATION" parameterType="Object" >
		INSERT INTO SP_CM_RELATION (
		<trim prefix=" " prefixOverrides=",">
			<if test="id != null ">,id</if>
			<if test="cpId != null ">,cp_id</if>
			<if test="spId != null ">,sp_id</if>
			<if test="insuranceType != null ">,insurance_type</if>
			<if test="regNum != null ">,reg_num</if>
			<if test="areaId != null ">,area_id</if>
			<if test="createBy != null ">,create_by</if>
			<if test="createDt != null ">,create_dt</if>
			<if test="modifyBy != null ">,modify_by</if>
			<if test="modifyDt != null ">,modify_dt</if>
			<if test="regNumpass != null ">,reg_numpass</if>
			<if test="regUsbkeypass != null ">,reg_usbkeypass</if>
			<if test="insuranceAccountId != null ">,insurance_account_id</if>
			<if test="fundType != null ">,fund_type</if>
			<if test="fundAccountId != null ">,fund_account_id</if>
			<if test="billLiaison != null ">,bill_liaison</if>
			<if test="billMail != null ">,bill_mail</if>
			<if test="billDay != null ">,bill_day</if>
			<if test="servicePrice != null ">,service_price</if>
			<if test="chargeMode != null ">,charge_mode</if>
			<if test="chargeModeRemark != null ">,charge_mode_remark</if>
			<if test="source != null ">,source</if>
			<if test="contractType != null ">,contract_type</if>
			<if test="dr != null ">,dr</if>
		</trim>
		)  VALUES (
		<trim prefix=" " prefixOverrides=",">
			<if test="id != null ">,#{id}</if>
			<if test="cpId != null ">,#{cpId}</if>
			<if test="spId != null ">,#{spId}</if>
			<if test="insuranceType != null ">,#{insuranceType}</if>
			<if test="regNum != null ">,#{regNum}</if>
			<if test="areaId != null ">,#{areaId}</if>
			<if test="createBy != null ">,#{createBy}</if>
			<if test="createDt != null ">,#{createDt}</if>
			<if test="modifyBy != null ">,#{modifyBy}</if>
			<if test="modifyDt != null ">,#{modifyDt}</if>
			<if test="regNumpass != null ">,#{regNumpass}</if>
			<if test="regUsbkeypass != null ">,#{regUsbkeypass}</if>
			<if test="insuranceAccountId != null ">,#{insuranceAccountId}</if>
			<if test="fundType != null ">,#{fundType}</if>
			<if test="fundAccountId != null ">,#{fundAccountId}</if>
			<if test="billLiaison != null ">,#{billLiaison}</if>
			<if test="billMail != null ">,#{billMail}</if>
			<if test="billDay != null ">,#{billDay}</if>
			<if test="servicePrice != null ">,#{servicePrice}</if>
			<if test="chargeMode != null ">,#{chargeMode}</if>
			<if test="chargeModeRemark != null ">,#{chargeModeRemark}</if>
			<if test="source != null ">,#{source}</if>
			<if test="contractType != null ">,#{contractType}</if>
			<if test="dr != null ">,#{dr}</if>
		</trim>
		)
		<selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
			SELECT LAST_INSERT_ID() AS ID
		</selectKey>
	</insert>

	<!-- 根据id，修改记录-->
	<update id="UpdateSP_CM_RELATION" parameterType="Object" >
		UPDATE SP_CM_RELATION
		<trim prefix=" SET " prefixOverrides=",">
			<if test="id != null ">,id=#{id}</if>
			<if test="cpId != null ">,cp_id=#{cpId}</if>
			<if test="spId != null ">,sp_id=#{spId}</if>
			<if test="insuranceType != null ">,insurance_type=#{insuranceType}</if>
			<if test="regNum != null ">,reg_num=#{regNum}</if>
			<if test="areaId != null ">,area_id=#{areaId}</if>
			<if test="createBy != null ">,create_by=#{createBy}</if>
			<if test="createDt != null ">,create_dt=#{createDt}</if>
			<if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
			<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
			<if test="regNumpass != null ">,reg_numpass=#{regNumpass}</if>
			<if test="regUsbkeypass != null ">,reg_usbkeypass=#{regUsbkeypass}</if>
			<if test="insuranceAccountId != null ">,insurance_account_id=#{insuranceAccountId}</if>
			<if test="fundType != null ">,fund_type=#{fundType}</if>
			<if test="fundAccountId != null ">,fund_account_id=#{fundAccountId}</if>
			<if test="billLiaison != null ">,bill_liaison=#{billLiaison}</if>
			<if test="billMail != null ">,bill_mail=#{billMail}</if>
			<if test="billDay != null ">,bill_day=#{billDay}</if>
			<if test="servicePrice != null ">,service_price=#{servicePrice}</if>
			<if test="chargeMode != null ">,charge_mode=#{chargeMode}</if>
			<if test="chargeModeRemark != null ">,charge_mode_remark=#{chargeModeRemark}</if>
			<if test="source != null ">,source=#{source}</if>
			<if test="contractType != null ">,contract_type=#{contractType}</if>
			<if test="dr != null ">,dr=#{dr}</if>
		</trim>
		WHERE ID=#{id}
	</update>

	<!-- 删除记录 -->
	<delete id="DeleteSP_CM_RELATION">DELETE FROM SP_CM_RELATION WHERE ID=#{id}</delete>
	<!-- 任务单历史 列表总数-->
	<select id="CountFindAllSP_CM_RELATION" resultType="java.lang.Integer">SELECT count(1) as value FROM SP_CM_RELATION</select>
	<select id="CountSP_CM_RELATION" resultType="java.lang.Integer">SELECT count(1) as value FROM SP_CM_RELATION WHERE ID=#{id}</select>
	<!-- 根据id查询 任务单历史 -->
	<select id="FindByPK" resultMap="result_map_SP_CM_RELATION" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM SP_CM_RELATION WHERE ID=#{id}</select>

	<!-- 根据各字段条件带模糊查询  任务单历史 -->
	<select id="FreeFindSP_CM_RELATION" resultMap="result_map_SP_CM_RELATION" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SP_CM_RELATION
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带模糊查询  任务单历史 记录数 -->
	<select id="CountFreeFindSP_CM_RELATION" resultType="java.lang.Integer">
		SELECT count(1) as value FROM SP_CM_RELATION
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带排序  任务单历史 -->
	<select id="FreeFindSP_CM_RELATIONOrdered" resultMap="result_map_SP_CM_RELATION" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SP_CM_RELATION
		<include refid="Example_Where_Clause2" />
		ORDER BY ${_orderBy}
	</select>

	<!-- *****************************  温馨提示：  ***************************** -->
	<!-- **                                                                    ** -->
	<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
	<!-- **                                             ** 2016/12/21 12:46:38 ** -->
	<!-- ************************************************************************ -->



	<!-- 根据企业ID删除企业关系记录 -->
<delete id="DeleteSP_CM_RELATIONByCpId">DELETE FROM SP_CM_RELATION WHERE cp_id=#{cpId}</delete>

<!-- 根据区域id和服务商id查询企业列表 -->
<select id="FindCorpsBySpId" resultType="java.util.Map" parameterType="Object">
	SELECT c.`cp_id`, c.`corp_name` FROM sp_cm_relation scr
		INNER JOIN cm_corp c ON scr.`cp_id` = c.`cp_id`
		INNER JOIN bs_area ba ON ba.`area_id` = c.cp_address_area
		WHERE scr.`sp_id` = #{spId}
		<if test="areaCode != null "> AND ba.`code` LIKE '${areaCode}%' </if>
		ORDER BY c.cp_id ASC;
</select>
<select id="findSP_CM_RELATIONBySpidAndCpid" resultMap="result_map_SP_CM_RELATION" parameterType="Object">
		select <include refid="Base_Column_List" /> from sp_cm_relation
		<include refid="Example_Where_Clause" />
</select>

	<!-- 根据账单日获取企业列表 -->
	<select id="QUERY_ALL_CROPS_BY_BILL_DAY" resultMap="result_map_SP_CM_RELATION" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM sp_cm_relation re WHERE re.bill_day = date_format(NOW(),'%e')
	</select>

	<select id="FINDSP_CM_RELATION_BY_CPID" resultType="java.util.Map" parameterType="Object">
		SELECT * FROM SP_CM_RELATION WHERE cp_id = #{cpId} AND (source = 'SAAS' OR source = 'MALL')
	</select>



    <!-- 根据企业ID spID删除企业关系记录 -->
    <update id="delRELATIONByCpIdandSpId" parameterType="Object">
    UPDATE  SP_CM_RELATION SET  dr = 1 WHERE cp_id=#{cpId} and sp_id=#{spId}
    </update>
</mapper>   
