<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SP_SERVICE" >
	<!-- Result Map-->
	<resultMap id="result_map_SP_SERVICE" type="com.xfs.sp.model.SpService" >
		<result column="sp_id" property="spId"/>
		<result column="cp_id" property="cpId"/>
		<result column="sp_name" property="spName"/>
		<result column="short_name" property="shortName"/>
		<result column="service_state" property="serviceState"/>
		<result column="contactor" property="contactor"/>
		<result column="job" property="job"/>
		<result column="mobile" property="mobile"/>
		<result column="area_id" property="areaId"/>
		<result column="collaborator" property="collaborator"/>
		<result column="service_num" property="serviceNum"/>
		<result column="create_by" property="createBy"/>
		<result column="create_dt" property="createDt"/>
		<result column="modify_by" property="modifyBy"/>
		<result column="modify_dt" property="modifyDt"/>
		<result column="ol_contactor" property="olContactor"/>
		<result column="ol_mobile" property="olMobile"/>
		<result column="ol_address" property="olAddress"/>
		<result column="logo" property="logo"/>
		<result column="org_star" property="orgStar"/>
		<result column="address" property="address"/>
		<result column="busi_license_num" property="busiLicenseNum"/>
		<result column="busi_license_file" property="busiLicenseFile"/>
		<result column="comany_type" property="comanyType"/>
		<result column="established_time" property="establishedTime"/>
		<result column="legal_psn" property="legalPsn"/>
		<result column="registered_capital" property="registeredCapital"/>
		<result column="registered_gov" property="registeredGov"/>
		<result column="busi_scope" property="busiScope"/>
		<result column="unaudit_reason" property="unauditReason"/>
		<result column="enabled_mall" property="enabledMall"/>
		<result column="company_level" property="companyLevel"/>
		<result column="partner_no" property="partnerNo"/>
		<result column="balance" property="balance"/>
		<result column="sp_email" property="spEmail"/>
		<result column="customer_num" property="customerNum"/>
		<result column="parent_sp" property="parentSp"/>
		<result column="billing_day" property="billingDay"/>
		<result column="memo" property="memo"/>
		<result column="certificate" property="certificate"/>
		<result column="human_certification" property="humanCertification"/>
		<result column="labor_certification" property="laborCertification"/>
		<result column="position_score" property="positionScore"/>
		<result column="person_quality_score" property="personQualityScore"/>
		<result column="office_score" property="officeScore"/>
		<result column="office_area_score" property="officeAreaScore"/>
		<result column="plat_contribute_score" property="platContributeScore"/>
		<result column="knowledge_score" property="knowledgeScore"/>
		<result column="service_qualification" property="serviceQualification"/>
		<result column="service_capability" property="serviceCapability"/>
		<result column="service_quality" property="serviceQuality"/>
		<result column="service_evaluation" property="serviceEvaluation"/>
	</resultMap>
	<!-- sp_service table all fields -->
	<sql id="Base_Column_List" >
		sp_id,
		cp_id,
		sp_name,
		service_state,
		contactor,
		job,
		mobile,
		area_id,
		collaborator,
		service_num,
		create_by,
		create_dt,
		modify_by,
		modify_dt,
		logo,
		ol_contactor,
		ol_mobile,
		ol_address,
		org_star,
		address,
		busi_license_num,
		busi_license_file,
		comany_type,
		established_time,
		legal_psn,
		registered_capital,
		registered_gov,
		busi_scope,
		unaudit_reason,
		short_name,
		company_level,
		enabled_mall,
		partner_no,
		balance,
		sp_email,
		customer_num,
		parent_sp,
		billing_day,
		memo,
		certificate,
		labor_certification,
		human_certification,
		position_score,
		person_quality_score,
		office_score,
		office_area_score,
		plat_contribute_score,
		knowledge_score,
		service_qualification,
		service_capability,
		service_quality,
		service_evaluation
	</sql>

	<!-- 查询条件 -->
	<sql id="Example_Where_Clause">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="spId != null" >and sp_id = #{spId}</if>
			<if test="cpId != null" >and cp_id = #{cpId}</if>
			<if test="spName != null" >and sp_name = #{spName}</if>
			<if test="shortName != null" >and short_name = #{shortName}</if>
			<if test="serviceState != null" >and service_state = #{serviceState}</if>
			<if test="contactor != null" >and contactor = #{contactor}</if>
			<if test="job != null" >and job = #{job}</if>
			<if test="mobile != null" >and mobile = #{mobile}</if>
			<if test="areaId != null" >and area_id = #{areaId}</if>
			<if test="collaborator != null" >and collaborator = #{collaborator}</if>
			<if test="serviceNum != null" >and service_num = #{serviceNum}</if>
			<if test="createBy != null" >and create_by = #{createBy}</if>
			<if test="createDt != null" >and create_dt = #{createDt}</if>
			<if test="modifyBy != null" >and modify_by = #{modifyBy}</if>
			<if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
			<if test="olContactor != null" >and ol_contactor = #{olContactor}</if>
			<if test="olMobile != null" >and ol_mobile = #{olMobile}</if>
			<if test="olAddress != null" >and ol_address = #{olAddress}</if>
			<if test="logo != null" >and logo = #{logo}</if>
			<if test="orgStar != null" >and org_star = #{orgStar}</if>
			<if test="address != null" >and address = #{address}</if>
			<if test="busiLicenseNum != null" >and busi_license_num = #{busiLicenseNum}</if>
			<if test="busiLicenseFile != null" >and busi_license_file = #{busiLicenseFile}</if>
			<if test="comanyType != null" >and comany_type = #{comanyType}</if>
			<if test="establishedTime != null" >and established_time = #{establishedTime}</if>
			<if test="legalPsn != null" >and legal_psn = #{legalPsn}</if>
			<if test="registeredCapital != null" >and registered_capital = #{registeredCapital}</if>
			<if test="registeredGov != null" >and registered_gov = #{registeredGov}</if>
			<if test="busiScope != null" >and busi_scope = #{busiScope}</if>
			<if test="unauditReason != null" >and unaudit_reason = #{unauditReason}</if>

			<if test="enabledMall != null" >and enabled_mall = #{enabledMall}</if>
			<if test="companyLevel != null" >and company_level = #{companyLevel}</if>
			<if test="billingDay != null" >and billing_day = #{billingDay}</if>
			<if test="memo != null" >and memo = #{memo}</if>
			<if test="partnerNo != null" >and partner_no = #{partnerNo}</if>
			<if test="balance != null" >and balance = #{balance}</if>
			<if test="spEmail != null" >and sp_email = #{spEmail}</if>
			<if test="customerNum != null" >and customer_num = #{customerNum}</if>
			<if test="parentSp != null" >and parent_sp = #{parentSp}</if>
			<if test="certificate != null" >and certificate = #{certificate}</if>
			<if test="humanCertification != null" >and human_certification = #{humanCertification}</if>
			<if test="laborCertification != null" >and labor_certification = #{laborCertification}</if>
		</trim>
	</sql>

	<!-- 查询条件 带模糊查询 以及 时间起始查询 -->
	<sql id="Example_Where_Clause2">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="spId != null">AND sp_id = #{spId}</if>
			<if test="cpId != null" >and cp_id = #{cpId}</if>
			<if test="spName != null">AND sp_name like '%${spName}%'</if>
			<if test="spNameEq != null">AND sp_name = #{spNameEq}</if>
			<if test="serviceState != null">AND service_state like '%${serviceState}%'</if>
			<if test="serviceStateEq != null">AND service_state = #{serviceStateEq}</if>
			<if test="contactor != null">AND contactor like '%${contactor}%'</if>
			<if test="contactorEq != null">AND contactor = #{contactorEq}</if>
			<if test="job != null">AND job like '%${job}%'</if>
			<if test="jobEq != null">AND job = #{jobEq}</if>
			<if test="mobile != null">AND mobile like '%${mobile}%'</if>
			<if test="mobileEq != null">AND mobile = #{mobileEq}</if>
			<if test="areaId != null">AND area_id = #{areaId}</if>
			<if test="collaborator != null">AND collaborator like '%${collaborator}%'</if>
			<if test="collaboratorEq != null">AND collaborator = #{collaboratorEq}</if>
			<if test="serviceNum != null">AND service_num = #{serviceNum}</if>
			<if test="createBy != null">AND create_by = #{createBy}</if>
			<if test="createDt != null">AND create_dt = #{createDt}</if>
			<if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
			<if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
			<if test="modifyBy != null">AND modify_by = #{modifyBy}</if>
			<if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
			<if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
			<if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
			<if test="logo != null">AND logo = #{logo}</if>
			<if test="olContactor != null">AND ol_contactor like '%${olContactor}%'</if>
			<if test="olContactorEq != null">AND ol_contactor = #{olContactorEq}</if>
			<if test="olMobile != null">AND ol_mobile like '%${olMobile}%'</if>
			<if test="olMobileEq != null">AND ol_mobile = #{olMobileEq}</if>
			<if test="olAddress != null">AND ol_address like '%${olAddress}%'</if>
			<if test="olAddressEq != null">AND ol_address = #{olAddressEq}</if>
			<if test="orgStar != null">AND org_star = #{orgStar}</if>
			<if test="address != null">AND address like '%${address}%'</if>
			<if test="addressEq != null">AND address = #{addressEq}</if>
			<if test="busiLicenseNum != null">AND busi_license_num like '%${busiLicenseNum}%'</if>
			<if test="busiLicenseNumEq != null">AND busi_license_num = #{busiLicenseNumEq}</if>
			<if test="busiLicenseFile != null">AND busi_license_file = #{busiLicenseFile}</if>
			<if test="comanyType != null">AND comany_type like '%${comanyType}%'</if>
			<if test="comanyTypeEq != null">AND comany_type = #{comanyTypeEq}</if>
			<if test="establishedTime != null">AND established_time = #{establishedTime}</if>
			<if test="establishedTimeFrom != null">AND established_time&gt;=#{establishedTimeFrom}</if>
			<if test="establishedTimeTo != null">AND established_time&lt;=#{establishedTimeTo}</if>
			<if test="legalPsn != null">AND legal_psn like '%${legalPsn}%'</if>
			<if test="legalPsnEq != null">AND legal_psn = #{legalPsnEq}</if>
			<if test="registeredCapital != null">AND registered_capital like '%${registeredCapital}%'</if>
			<if test="registeredCapitalEq != null">AND registered_capital = #{registeredCapitalEq}</if>
			<if test="registeredGov != null">AND registered_gov like '%${registeredGov}%'</if>
			<if test="registeredGovEq != null">AND registered_gov = #{registeredGovEq}</if>
			<if test="busiScope != null">AND busi_scope like '%${busiScope}%'</if>
			<if test="busiScopeEq != null">AND busi_scope = #{busiScopeEq}</if>
			<if test="unauditReason != null">AND unaudit_reason like '%${unauditReason}%'</if>
			<if test="unauditReasonEq != null">AND unaudit_reason = #{unauditReasonEq}</if>
			<if test="shortName != null">AND short_name like '%${shortName}%'</if>
			<if test="shortNameEq != null">AND short_name = #{shortNameEq}</if>
			<if test="companyLevel != null">AND company_level like '%${companyLevel}%'</if>
			<if test="companyLevelEq != null">AND company_level = #{companyLevelEq}</if>
			<if test="enabledMall != null">AND enabled_mall like '%${enabledMall}%'</if>
			<if test="enabledMallEq != null">AND enabled_mall = #{enabledMallEq}</if>
			<if test="partnerNo != null">AND partner_no like '%${partnerNo}%'</if>
			<if test="partnerNoEq != null">AND partner_no = #{partnerNoEq}</if>
			<if test="balance != null">AND balance like '%${balance}%'</if>
			<if test="spEmail != null">AND sp_email like '%${spEmail}%'</if>
			<if test="spEmailEq != null">AND sp_email = #{spEmailEq}</if>
			<if test="customerNum != null">AND customer_num like '%${customerNum}%'</if>
			<if test="customerNumEq != null">AND customer_num = #{customerNumEq}</if>
			<if test="parentSp != null">AND parent_sp = #{parentSp}</if>
			<if test="billingDay != null">AND billing_day = #{billingDay}</if>
			<if test="memo != null">AND memo like '%${memo}%'</if>
			<if test="memoEq != null">AND memo = #{memoEq}</if>
			<if test="humanCertification != null">AND human_certification like '%${humanCertification}%'</if>
			<if test="humanCertificationEq != null">AND human_certification = #{humanCertificationEq}</if>
			<if test="laborCertification != null">AND labor_certification like '%${laborCertification}%'</if>
			<if test="laborCertificationEq != null">AND labor_certification = #{laborCertificationEq}</if>
		</trim>
	</sql>

	<!-- 插入记录 -->
	<insert id="InsertSP_SERVICE" parameterType="Object" >
		INSERT INTO SP_SERVICE (
		<trim prefix=" " prefixOverrides=",">
			<if test="spId != null ">,sp_id</if>
			<if test="cpId != null ">,cp_id</if>
			<if test="spName != null ">,sp_name</if>
			<if test="shortName != null ">,short_name</if>
			<if test="serviceState != null ">,service_state</if>
			<if test="contactor != null ">,contactor</if>
			<if test="job != null ">,job</if>
			<if test="mobile != null ">,mobile</if>
			<if test="areaId != null ">,area_id</if>
			<if test="collaborator != null ">,collaborator</if>
			<if test="serviceNum != null ">,service_num</if>
			<if test="createBy != null ">,create_by</if>
			<if test="createDt != null ">,create_dt</if>
			<if test="modifyBy != null ">,modify_by</if>
			<if test="modifyDt != null ">,modify_dt</if>
			<if test="olContactor != null ">,ol_contactor</if>
			<if test="olMobile != null ">,ol_mobile</if>
			<if test="olAddress != null ">,ol_address</if>
			<if test="logo != null ">,logo</if>
			<if test="orgStar != null ">,org_star</if>
			<if test="address != null ">,address</if>
			<if test="busiLicenseNum != null ">,busi_license_num</if>
			<if test="busiLicenseFile != null ">,busi_license_file</if>
			<if test="comanyType != null ">,comany_type</if>
			<if test="establishedTime != null ">,established_time</if>
			<if test="legalPsn != null ">,legal_psn</if>
			<if test="registeredCapital != null ">,registered_capital</if>
			<if test="registeredGov != null ">,registered_gov</if>
			<if test="busiScope != null ">,busi_scope</if>
			<if test="unauditReason != null ">,unaudit_reason</if>

			<if test="enabledMall != null ">,enabled_mall</if>
			<if test="companyLevel != null ">,company_level</if>
			<if test="billingDay != null ">,billing_day</if>
			<if test="spEmail != null ">,sp_email</if>
			<if test="customerNum != null ">,customer_num</if>
			<if test="parentSp != null ">,parent_sp</if>
			<if test="partnerNo != null ">,partner_no</if>
			<if test="balance != null ">,balance</if>
			<if test="memo != null ">,memo</if>
			<if test="certificate != null ">,certificate</if>
			<if test="humanCertification != null ">,human_certification</if>
			<if test="laborCertification != null ">,labor_certification</if>
		</trim>
		)  VALUES (
		<trim prefix=" " prefixOverrides=",">
			<if test="spId != null ">,#{spId}</if>
			<if test="cpId != null ">,#{cpId}</if>
			<if test="spName != null ">,#{spName}</if>
			<if test="shortName != null ">,#{shortName}</if>
			<if test="serviceState != null ">,#{serviceState}</if>
			<if test="contactor != null ">,#{contactor}</if>
			<if test="job != null ">,#{job}</if>
			<if test="mobile != null ">,#{mobile}</if>
			<if test="areaId != null ">,#{areaId}</if>
			<if test="collaborator != null ">,#{collaborator}</if>
			<if test="serviceNum != null ">,#{serviceNum}</if>
			<if test="createBy != null ">,#{createBy}</if>
			<if test="createDt != null ">,#{createDt}</if>
			<if test="modifyBy != null ">,#{modifyBy}</if>
			<if test="modifyDt != null ">,#{modifyDt}</if>
			<if test="olContactor != null ">,#{olContactor}</if>
			<if test="olMobile != null ">,#{olMobile}</if>
			<if test="olAddress != null ">,#{olAddress}</if>
			<if test="logo != null ">,#{logo}</if>
			<if test="orgStar != null ">,#{orgStar}</if>
			<if test="address != null ">,#{address}</if>
			<if test="busiLicenseNum != null ">,#{busiLicenseNum}</if>
			<if test="busiLicenseFile != null ">,#{busiLicenseFile}</if>
			<if test="comanyType != null ">,#{comanyType}</if>
			<if test="establishedTime != null ">,#{establishedTime}</if>
			<if test="legalPsn != null ">,#{legalPsn}</if>
			<if test="registeredCapital != null ">,#{registeredCapital}</if>
			<if test="registeredGov != null ">,#{registeredGov}</if>
			<if test="busiScope != null ">,#{busiScope}</if>
			<if test="unauditReason != null ">,#{unauditReason}</if>

			<if test="enabledMall != null ">,#{enabledMall}</if>
			<if test="companyLevel != null ">,#{companyLevel}</if>
			<if test="billingDay != null ">,#{billingDay}</if>
			<if test="spEmail != null ">,#{spEmail}</if>
			<if test="customerNum != null ">,#{customerNum}</if>
			<if test="parentSp != null ">,#{parentSp}</if>
			<if test="partnerNo != null ">,#{partnerNo}</if>
			<if test="balance != null ">,#{balance}</if>
			<if test="memo != null ">,#{memo}</if>
			<if test="certificate != null ">,#{certificate}</if>
			<if test="humanCertification != null ">,#{humanCertification}</if>
			<if test="laborCertification != null ">,#{laborCertification}</if>
		</trim>
		)
		<selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="spId">
			SELECT LAST_INSERT_ID() AS SP_ID
		</selectKey>
	</insert>

	<!-- 根据id，修改记录-->
	<update id="UpdateSP_SERVICE" parameterType="Object" >
		UPDATE SP_SERVICE
		<trim prefix=" SET " prefixOverrides=",">
			<if test="cpId != null ">,cp_id=#{cpId}</if>
			<if test="spName != null ">,sp_name=#{spName}</if>
			<if test="shortName != null ">,short_name=#{shortName}</if>
			<if test="serviceState != null ">,service_state=#{serviceState}</if>
			<if test="contactor != null ">,contactor=#{contactor}</if>
			<if test="job != null ">,job=#{job}</if>
			<if test="mobile != null ">,mobile=#{mobile}</if>
			<if test="areaId != null ">,area_id=#{areaId}</if>
			<if test="collaborator != null ">,collaborator=#{collaborator}</if>
			<if test="serviceNum != null ">,service_num=#{serviceNum}</if>
			<if test="createBy != null ">,create_by=#{createBy}</if>
			<if test="createDt != null ">,create_dt=#{createDt}</if>
			<if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
			<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
			<if test="olContactor != null ">,ol_contactor=#{olContactor}</if>
			<if test="olMobile != null ">,ol_mobile=#{olMobile}</if>
			<if test="olAddress != null ">,ol_address=#{olAddress}</if>
			<if test="logo != null ">,logo=#{logo}</if>
			<if test="orgStar != null ">,org_star=#{orgStar}</if>
			<if test="address != null ">,address=#{address}</if>
			<if test="busiLicenseNum != null ">,busi_license_num=#{busiLicenseNum}</if>
			<if test="busiLicenseFile != null ">,busi_license_file=#{busiLicenseFile}</if>
			<if test="comanyType != null ">,comany_type=#{comanyType}</if>
			<if test="establishedTime != null ">,established_time=#{establishedTime}</if>
			<if test="legalPsn != null ">,legal_psn=#{legalPsn}</if>
			<if test="registeredCapital != null ">,registered_capital=#{registeredCapital}</if>
			<if test="registeredGov != null ">,registered_gov=#{registeredGov}</if>
			<if test="busiScope != null ">,busi_scope=#{busiScope}</if>
			<if test="unauditReason != null ">,unaudit_reason=#{unauditReason}</if>
			<if test="billingDay != null ">,billing_day=#{billingDay}</if>
			<if test="enabledMall != null ">,enabled_mall=#{enabledMall}</if>
			<if test="companyLevel != null ">,company_level=#{companyLevel}</if>
			<if test="memo != null ">,memo=#{memo}</if>
			<if test="spEmail != null" >,sp_email = #{spEmail}</if>
			<if test="customerNum != null" >,customer_num = #{customerNum}</if>
			<if test="parentSp != null ">,parent_sp=#{parentSp}</if>
			<if test="partnerNo != null ">,partner_no=#{partnerNo}</if>
			<if test="balance != null ">,balance=#{balance}</if>
			<if test="certificate != null ">,certificate=#{certificate}</if>
			<if test="humanCertification != null ">,human_certification=#{humanCertification}</if>
			<if test="laborCertification != null ">,labor_certification=#{laborCertification}</if>
		</trim>
		WHERE SP_ID=#{spId}
	</update>

	<!-- 删除记录 -->
	<delete id="DeleteSP_SERVICE">DELETE FROM SP_SERVICE WHERE SP_ID=#{spId}</delete>
	<!-- 字典表 列表总数-->
	<select id="CountFindAllSP_SERVICE" resultType="java.lang.Integer">SELECT count(1) as value FROM SP_SERVICE</select>
	<select id="CountSP_SERVICE" resultType="java.lang.Integer">SELECT count(1) as value FROM SP_SERVICE WHERE SP_ID=#{spId}</select>
	<!-- 根据id查询 字典表 -->
	<select id="FindByPK" resultMap="result_map_SP_SERVICE" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM SP_SERVICE WHERE SP_ID=#{spId}</select>

	<!-- 根据各字段条件带模糊查询  字典表 -->
	<select id="FreeFindSP_SERVICE" resultMap="result_map_SP_SERVICE" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SP_SERVICE
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带模糊查询  字典表 记录数 -->
	<select id="CountFreeFindSP_SERVICE" resultType="java.lang.Integer">
		SELECT count(1) as value FROM SP_SERVICE
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带排序  字典表 -->
	<select id="FreeFindSP_SERVICEOrdered" resultMap="result_map_SP_SERVICE" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM SP_SERVICE
		<include refid="Example_Where_Clause2" />
		ORDER BY ${_orderBy}
	</select>

	<!-- *****************************  温馨提示：  ***************************** -->
	<!-- **                                                                    ** -->
	<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
	<!-- **                                             ** 2016/04/12 19:22:57 ** -->
	<!-- ************************************************************************ -->

	<!-- 查询服务商的OpenList联系人-->
	<select id="FindOL_Contact_By_SPID" resultMap="result_map_SP_SERVICE" parameterType="Object">
		SELECT sp.sp_id,sp.contactor,sp.mobile,sp.ol_contactor,sp.ol_mobile,sp.ol_address,sp.sp_name FROM
		sp_service sp where sp.sp_id = #{sp_id}
	</select>

	<!-- 根据各字段条件带模糊查询 服务商信息 -->
	<select id="findSP_SERVICE_By_SpService" resultMap="result_map_SP_SERVICE"
			parameterType="Object">
		SELECT
		<include refid="Base_Column_List" />
		FROM SP_SERVICE
		<include refid="Example_Where_Clause" />
	</select>

	<select id="find_AllSpServiceName"   resultType="java.lang.String"
			parameterType="Object">
		SELECT sp_name FROM SP_SERVICE
	</select>

	<!-- 查询服务商的服务区域，商城 -->
	<select id="findAreaIdBySpId" resultType="java.util.Map" parameterType="Object">
		SELECT ss.sp_id as spId,sp_name as spName,ss.area_id as areaId ,baa.name FROM sp_service ss
		INNER JOIN bs_areabusi ba on ss.area_id = ba.area_id
		INNER JOIN bs_area baa on ss.area_id = baa.area_id
		WHERE ba.busi = 'MALL' and ss.sp_id = #{spId}
	</select>

	<!-- 模糊查询spId和spName -->
	<select id="FreeFindspIdspName" resultMap="result_map_SP_SERVICE" parameterType="Object">
		SELECT sp_id,sp_name FROM SP_SERVICE WHERE sp_name like '%${spName}%'

	</select>

	<!-- update by wuzhe merge 20161027 source from cs-->
	<!-- 查询优质服务商列表 -->
	<select id="Find_MALL_SP_SERVICE" resultMap="result_map_SP_SERVICE" parameterType="Object">
		SELECT s.* FROM sp_service s
		INNER JOIN bs_area a ON s.`area_id` = a.`area_id`
		INNER JOIN sps_mall_info mi ON s.`sp_id` = mi.`sp_id`
		WHERE a.code LIKE '${code}%' AND s.enabled_mall = 'SIGNED' AND mi.dr = 0
		GROUP BY s.`sp_id`
		ORDER BY a.`area_id` ASC;
	</select>

	<!-- 服务机构列表 -->
	<select id="Find_MALL_SP_SERVICES" resultType="java.util.Map" parameterType="Object">
		SELECT s.`sp_id`, s.`short_name`, s.`sp_name` FROM bs_areabusi ab
		INNER JOIN (
		SELECT a.`belong_city` AS area_id, sa.`sp_id` FROM sps_servicearea sa INNER JOIN bs_area a ON sa.`area_id` = a.`area_id` AND sa.`dr` = 0
		) tab ON  ab.`area_id` = tab.`area_id`
		INNER JOIN sp_service s ON tab.`sp_id` = s.`sp_id` AND s.`enabled_mall` = 'SIGNED'
		INNER JOIN sps_mall_info mi ON s.`sp_id` = mi.`sp_id` AND mi.`dr` = 0
		INNER JOIN sps_mall_product mp ON s.`sp_id` = mp.`sp_id` AND mp.`dr` = 0
		INNER JOIN sps_mall_servicerange msr ON s.`sp_id` = msr.`sp_id` AND msr.`dr` = 0
		INNER JOIN sps_mall_productarea mpa ON mp.`product_id` = mpa.`product_id` AND ab.`area_id` = mpa.`area_id`
		WHERE ab.`busi` = 'MALL'
		<if test="areaIds != null"> AND ab.`area_id` IN (#{areaIds})</if>
		GROUP BY s.`sp_id`
	</select>

	<select id="COUNTFIND_MALL_SP_SERVICE" resultType="java.lang.Integer" parameterType="Object">
		SELECT COUNT(1) FROM (
		SELECT COUNT(s.sp_id) FROM sp_service s
		INNER JOIN sps_mall_info mi ON s.`sp_id` = mi.`sp_id` AND mi.`dr` = 0
		INNER JOIN sps_servicearea sa ON s.`sp_id` = sa.`sp_id` AND sa.`dr` = 0
		INNER JOIN bs_area a ON sa.`area_id` = a.area_id
		INNER JOIN bs_areabusi ab ON a.`belong_city` = ab.`area_id` AND ab.`busi` = 'MALL'
		INNER JOIN sps_mall_product mp ON s.`sp_id` = mp.`sp_id`
		AND mp.`dr` = 0
		INNER JOIN sps_mall_productarea mpa ON mp.`product_id` = mpa.`product_id`
		AND ab.`area_id` = mpa.`area_id`
		INNER JOIN sps_mall_servicerange msr ON s.`sp_id` = msr.`sp_id` AND msr.`dr` = 0
		INNER JOIN bs_mall_item_category mic ON msr.`category_id` = mic.`category_id` AND mic.`dr` = 0
		WHERE s.`enabled_mall` = 'SIGNED'
		<if test="certificationType != null and certificationType == 'HUMAN'">
			AND s.`human_certification` IS NOT NULL
		</if>
		<if test="certificationType != null and certificationType == 'LABOR'">
			AND s.`labor_certification` IS NOT NULL
		</if>
		<if test="areaId != null">
			AND EXISTS (
			SELECT * FROM sps_servicearea sa INNER JOIN bs_area a ON sa.`area_id` = a.`area_id` WHERE sa.`sp_id` = s.`sp_id` AND a.`belong_city` = #{areaId}
			)
		</if>
		<if test="categoryId != null">
			AND EXISTS (
			SELECT * FROM sps_mall_servicerange msr WHERE msr.`sp_id` = s.`sp_id` AND msr.`category_id` = #{categoryId}
			)
		</if>
		<if test="beginYear != null">
			AND TIMESTAMPDIFF(YEAR, s.established_time, NOW()) &gt;= ${beginYear}
		</if>
		<if test="endYear != null">
			AND TIMESTAMPDIFF(YEAR, s.established_time, NOW()) &lt; ${endYear}
		</if>
		<if test="searchWord != null">
			AND (s.sp_name LIKE CONCAT('%', #{searchWord}, '%') OR s.short_name LIKE CONCAT('%', #{searchWord}, '%'))
		</if>
		GROUP BY s.`sp_id`
		) tab
	</select>

	<!-- 服务机构列表 -->
	<select id="FIND_MALL_SP_SERVICES" resultType="java.util.Map" parameterType="Object">
		SELECT s.`sp_id`, s.`sp_name`, s.`short_name`, s.`company_level`,s.logo,
		mi.is_bus_certification, mi.is_onsite_audit, mi.is_fund_supervision, mi.risk_margin, mi.risk_margin_star,
		GROUP_CONCAT(DISTINCT ba.`name`) AS area_names, GROUP_CONCAT(DISTINCT mic.`category_name`) category_names,
		/*IFNULL(tab.emp_num, 0) AS emp_num, */TIMESTAMPDIFF(YEAR, s.established_time, NOW()) AS age, sc.score
		FROM sp_service s
		INNER JOIN sps_mall_info mi ON s.`sp_id` = mi.`sp_id` AND mi.`dr` = 0
		INNER JOIN sps_servicearea sa ON s.`sp_id` = sa.`sp_id` AND sa.`dr` = 0
		INNER JOIN bs_area a ON sa.`area_id` = a.area_id
		INNER JOIN bs_area ba ON a.`belong_city` = ba.area_id
		INNER JOIN bs_areabusi ab ON a.`belong_city` = ab.`area_id` AND ab.`busi` = 'MALL'
		INNER JOIN sps_mall_product mp ON s.`sp_id` = mp.`sp_id` AND mp.`dr` = 0
		INNER JOIN sps_mall_productarea mpa ON mp.`product_id` = mpa.`product_id` AND ab.`area_id` = mpa.`area_id`
		INNER JOIN sps_mall_servicerange msr ON s.`sp_id` = msr.`sp_id` AND msr.`dr` = 0
		INNER JOIN bs_mall_item_category mic ON msr.`category_id` = mic.`category_id` AND mic.`dr` = 0
		LEFT JOIN bd_score_collection sc ON sc.score_target_type = 'SERVICE' AND s.sp_id = sc.score_target_id AND sc.dr = 0
		<!-- LEFT JOIN (
            SELECT s.`sp_id`, COUNT(e.`emp_id`) AS emp_num FROM sp_service s
                INNER JOIN sp_cm_relation scr ON s.`sp_id` = scr.`sp_id`
                INNER JOIN cm_corp c ON scr.`cp_id` = c.`cp_id`
                INNER JOIN cm_employee e ON c.`cp_id` = e.`cp_id`
                GROUP BY s.`sp_id`
        ) tab ON s.`sp_id` = tab.sp_id -->
		WHERE s.`enabled_mall` = 'SIGNED'
		<if test="certificationType != null and certificationType == 'HUMAN'">
			AND s.`human_certification` IS NOT NULL
		</if>
		<if test="certificationType != null and certificationType == 'LABOR'">
			AND s.`labor_certification` IS NOT NULL
		</if>
		<if test="areaId != null">
			AND EXISTS (
			SELECT * FROM sps_servicearea sa INNER JOIN bs_area a ON sa.`area_id` = a.`area_id` WHERE sa.`sp_id` = s.`sp_id` AND a.`belong_city` = #{areaId}
			)
		</if>
		<if test="categoryId != null">
			AND EXISTS (
			SELECT * FROM sps_mall_servicerange msr WHERE msr.`sp_id` = s.`sp_id` AND msr.`category_id` = #{categoryId}
			)
		</if>
		<if test="beginYear != null">
			AND TIMESTAMPDIFF(YEAR, s.established_time, NOW()) &gt;= ${beginYear}
		</if>
		<if test="endYear != null">
			AND TIMESTAMPDIFF(YEAR, s.established_time, NOW()) &lt; ${endYear}
		</if>
		<if test="searchWord != null">
			AND (s.sp_name LIKE CONCAT('%', #{searchWord}, '%') OR s.short_name LIKE CONCAT('%', #{searchWord}, '%'))
		</if>
		GROUP BY s.`sp_id`
		ORDER BY sc.score DESC, s.`sp_id` ASC
	</select>

	<select id="FIND_MALL_SERVICE_BY_PRODUCTID" resultType="java.util.Map" parameterType="Object">
		SELECT ss.sp_id, ss.sp_name, ss.short_name, ss.logo, ss.`company_level`, sc.score,
		smi.is_bus_certification, smi.is_onsite_audit, smi.is_fund_supervision, smi.risk_margin, smi.risk_margin_star, smp.agent_ci_id
		FROM sp_service ss
		INNER JOIN sps_mall_info smi ON smi.sp_id = ss.sp_id
		INNER JOIN sps_mall_product smp ON smp.sp_id = ss.sp_id
		LEFT JOIN bd_score_collection sc ON sc.score_target_type = 'SERVICE' AND ss.sp_id = sc.score_target_id AND sc.dr = 0
		WHERE smp.product_id = #{productId} GROUP BY ss.sp_id
	</select>


	<!-- update by wuzhe merge 20161027 source from bs-->
	<resultMap id="result_map_SP_SERVICEWithAreaName" type="com.xfs.sp.model.SpService" >
		<result column="sp_id" property="spId"/>
		<result column="sp_name" property="spName"/>
		<result column="service_state" property="serviceState"/>
		<result column="contactor" property="contactor"/>
		<result column="job" property="job"/>
		<result column="mobile" property="mobile"/>
		<result column="busi_license_num" property="busiLicenseNum"/>
		<result column="area_id" property="areaId"/>
		<result column="area_name" property="areaName"/>
		<result column="service_num" property="serviceNum"/>
		<result column="collaborator" property="collaborator"/>
		<result column="create_by" property="createBy"/>
		<result column="create_dt" property="createDt"/>
		<result column="modify_by" property="modifyBy"/>
		<result column="modify_dt" property="modifyDt"/>
	</resultMap>

	<select id="FreeFindSP_SERVICEAndBS_AREAOrdered" resultMap="result_map_SP_SERVICEWithAreaName" parameterType="Object">
		SELECT  sps.sp_id,sps.sp_name,sps.service_state,sps.contactor,sps.job,sps.mobile,sps.busi_license_num,bs_a.fullname as "area_name",sps.service_num,sps.collaborator,sps.create_by,sps.create_dt,sps.modify_by,sps.modify_dt  FROM SP_SERVICE sps LEFT JOIN  BS_AREA bs_a
		on sps.area_id=bs_a.area_id <if test="spName != null">WHERE sp_name like '%${spName}%'</if>
		ORDER BY ${_orderBy}
	</select>

	<select id="FreeFindSP_SERVICE_Verify" resultMap="result_map_SP_SERVICEWithAreaName" parameterType="Object">
		SELECT  sps.sp_id,sps.sp_name,sps.service_state,sps.contactor,sps.mobile,sps.busi_license_num
		FROM SP_SERVICE sps
		WHERE 1=1
		<if test="serviceState != null">
			and service_state = #{serviceState}
		</if>
		<if test="spName != null">
			and sp_name like '%${spName}%'
		</if>
		ORDER BY ${_orderBy}
	</select>

	<!-- 根据各字段条件带模糊查询 服务商信息 -->
	<select id="findSP_SERVICE_By_State" resultMap="result_map_SP_SERVICE"
			parameterType="Object">
		SELECT
		<include refid="Base_Column_List" />
		FROM SP_SERVICE
		where 1=1
		<if test="serviceState != null">AND service_state =#{serviceState}</if>
		<if test="enabledMall != null">AND enabled_mall =#{enabledMall}</if>
		<if test="spname != null">AND sp_name like '%${spname}%'</if>
		ORDER BY ${_orderBy}
	</select>
	<!-- 根据各字段条件带模糊查询  字典表 记录数 -->
	<select id="CountSP_SERVICE_By_State" resultType="java.lang.Integer" parameterType="Object">
		SELECT count(1) as value FROM SP_SERVICE
		where 1=1
		<if test="serviceState != null">AND service_state =#{serviceState}</if>
		<if test="enabledMall != null">AND enabled_mall =#{enabledMall}</if>
		<if test="spname != null">AND sp_name like '%${spname}%'</if>
	</select>

	<select id="CountFreeFindByStatusSP_SERVICE" resultType="java.lang.Integer">
		select count(1) as value from sp_service
		where service_state = 'REGISTERED'
		or service_state = 'AUDITED'
		or service_state = 'SIGNING'
		or service_state = 'SIGNED'
		or service_state = 'STOPED'
	</select>

	<!-- 根据商城推荐服务商列表及服务商名称查询过滤  记录数 -->
	<select id="CountSP_SERVICE_By_Recom" resultType="java.lang.Integer" parameterType="Object">
		SELECT count(1) as value
		FROM SP_SERVICE ss
		LEFT JOIN bs_mall_recomservice bb on ss.sp_id = bb.sp_id
		where 1=1
		and service_state ='SIGNED' and bb.id is null
		<if test="spName != null">AND sp_name like '%${spName}%'</if>
	</select>

	<!-- 根据商城推荐服务商列表及服务商名称查询过滤  服务商信息 -->
	<select id="findSP_SERVICE_By_Recom" resultMap="result_map_SP_SERVICE"
			parameterType="Object">
		SELECT
		ss.sp_id spId,ss.sp_name spName,ss.contactor,ss.mobile
		FROM SP_SERVICE ss
		LEFT JOIN bs_mall_recomservice bb on ss.sp_id = bb.sp_id
		where 1=1
		and service_state ='SIGNED' and bb.id is null
		<if test="spName != null">AND sp_name like '%${spName}%'</if>
	</select>

	<!-- 根据spid查询该服务商的客服数，服务客户量，服务员工数 -->
	<select id="CountFreeInfoBySpId" resultType="java.util.Map" parameterType="Object">
		SELECT ss.sp_id as sp_id,COUNT(scr.cp_id) as cpNum,COUNT(cee.emp_id) as empNum,COUNT(smc.customer_id) as customerNum
		FROM sp_service  ss
		LEFT JOIN sp_cm_relation scr ON  ss.sp_id = scr.sp_id
		LEFT JOIN cm_employee cee ON scr.cp_id = cee.cp_id and cee.dr=0
		LEFT JOIN sps_mall_customer smc ON smc.sp_id = ss.sp_id
		WHERE ss.sp_id = #{spId} GROUP BY ss.sp_id;
	</select>


	<!-- 根据id，修改记录-->
	<update id="UpdateSP_SERVICEToStar" parameterType="Object" >
		UPDATE SP_SERVICE
		<trim prefix=" SET " prefixOverrides=",">
			<!-- <if test="spId != null ">,sp_id=#{spId}</if> -->
			<if test="cpId != null ">,cp_id=#{cpId}</if>
			<if test="spName != null ">,sp_name=#{spName}</if>
			<if test="shortName != null ">,short_name=#{shortName}</if>
			<if test="serviceState != null ">,service_state=#{serviceState}</if>
			<if test="contactor != null ">,contactor=#{contactor}</if>
			<if test="job != null ">,job=#{job}</if>
			<if test="mobile != null ">,mobile=#{mobile}</if>
			<if test="areaId != null ">,area_id=#{areaId}</if>
			<if test="collaborator != null ">,collaborator=#{collaborator}</if>
			<if test="serviceNum != null ">,service_num=#{serviceNum}</if>
			<if test="createBy != null ">,create_by=#{createBy}</if>
			<if test="createDt != null ">,create_dt=#{createDt}</if>
			<if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
			<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
			<if test="olContactor != null ">,ol_contactor=#{olContactor}</if>
			<if test="olMobile != null ">,ol_mobile=#{olMobile}</if>
			<if test="olAddress != null ">,ol_address=#{olAddress}</if>
			<if test="logo != null ">,logo=#{logo}</if>
			<if test="address != null ">,address=#{address}</if>
			<if test="busiLicenseNum != null ">,busi_license_num=#{busiLicenseNum}</if>
			<if test="busiLicenseFile != null ">,busi_license_file=#{busiLicenseFile}</if>
			<if test="comanyType != null ">,comany_type=#{comanyType}</if>
			<if test="establishedTime != null ">,established_time=#{establishedTime}</if>
			<if test="legalPsn != null ">,legal_psn=#{legalPsn}</if>
			<if test="registeredCapital != null ">,registered_capital=#{registeredCapital}</if>
			<if test="registeredGov != null ">,registered_gov=#{registeredGov}</if>
			<if test="busiScope != null ">,busi_scope=#{busiScope}</if>
			<if test="unauditReason != null ">,unaudit_reason=#{unauditReason}</if>
			<if test="enabledMall != null ">,enabled_mall=#{enabledMall}</if>
			<if test="companyLevel != null ">,company_level=#{companyLevel}</if>
			<if test="billingDay != null ">,billing_day=#{billingDay}</if>
			<if test="customerNum != null ">,customer_num=#{customerNum}</if>


			<if test="certificate != null ">,certificate=#{certificate}</if>
			<if test="laborCertification != null ">,labor_certification=#{laborCertification}</if>
			<if test="humanCertification != null ">,human_certification=#{humanCertification}</if>

			<if test="spEmail != null ">,sp_Email=#{spEmail}</if>

			<if test="positionScore != null ">,position_score=#{positionScore}</if>
			<if test="personQualityScore != null ">,person_quality_score=#{personQualityScore}</if>
			<if test="officeScore != null ">,office_score=#{officeScore}</if>
			<if test="officeAreaScore != null ">,office_area_score=#{officeAreaScore}</if>
			<if test="platContributeScore != null ">,plat_contribute_score=#{platContributeScore}</if>
			<if test="knowledgeScore != null ">,knowledge_score=#{knowledgeScore}</if>
			<if test="serviceQualification != null ">,service_qualification=#{serviceQualification}</if>
			<if test="serviceCapability != null ">,service_capability=#{serviceCapability}</if>
			<if test="serviceQuality != null ">,service_quality=#{serviceQuality}</if>
			<if test="serviceEvaluation != null ">,service_evaluation=#{serviceEvaluation}</if>

			,org_star=#{orgStar}
		</trim>
		WHERE SP_ID=#{spId}
	</update>

	<select id="findSpByInventedCorp" resultMap="result_map_SP_SERVICE" parameterType="Object">
		SELECT
		<include refid="Base_Column_List" />
		FROM SP_SERVICE
		where cp_id = #{cpId}
	</select>
	<!-- 获取服务商对账列表 -->
	<select id="findServiceBillList" resultType="com.xfs.serviceBill.dto.ServiceBillVo" parameterType="Object">
		select base.cp_id as cpId, base.sp_id as spId, base.sp_name as spsName ,group_concat(a.name) as areaName
		,GROUP_CONCAT(DISTINCT base.bill_date)+0 as billDay
		,CASE WHEN date_format(NOW(), '%e' ) &lt;= base.bill_date THEN date_format(CONCAT(date_format(NOW(), '%Y-%c-' ),base.bill_date),'%Y-%c-%d')
		ELSE date_format(CONCAT(date_format(date_add(NOW(), interval 1 month), '%Y-%c-' ),base.bill_date),'%Y-%c-%d')
		END as bday
		from(
			select c.cp_id, s.sp_id, s.sp_name ,a.belong_city,scheme.bill_date
			from cm_corp c 
			inner join sp_cm_relation r on c.cp_id= r.cp_id and c.cp_id=#{cpId} and c.dr=0 and r.dr=0 
			inner join sp_service s on r.sp_id=s.sp_id
			<if test="spId != null and spId != ''"> AND s.sp_id=#{spId} </if>
			<if test="spsName != null and spsName != ''">AND s.sp_name like '%${spsName}%'</if>
			inner join sps_scheme scheme on s.sp_id=scheme.sp_id and scheme.dr=0
			<if test="authority != 'ALL'"> 
				and scheme.scheme_id in (${authority})
			</if>
			inner join bs_area a on scheme.area_id=a.area_id
			group by  s.sp_id , a.belong_city
		) base
		left join bs_area a on base.belong_city=a.area_id
		group by base.sp_id
		order by bday
	</select>
	<!-- 获取服务商对账总数 -->
	<select id="findServiceBillListCount" resultType="java.lang.Integer">
		select count(b.spId) as value
		from(
			select base.cp_id as cpId, base.sp_id as spId, base.sp_name as spsName ,group_concat(a.name) as areaName
			,GROUP_CONCAT(DISTINCT base.bill_date)+0 as billDay
			,CASE WHEN date_format(NOW(), '%e' ) &lt;= base.bill_date THEN date_format(CONCAT(date_format(NOW(), '%Y-%c-' ),base.bill_date),'%Y-%c-%d')
			ELSE date_format(CONCAT(date_format(date_add(NOW(), interval 1 month), '%Y-%c-' ),base.bill_date),'%Y-%c-%d')
			END as bday
			from(
				select c.cp_id, s.sp_id, s.sp_name ,a.belong_city,scheme.bill_date
				from cm_corp c 
				inner join sp_cm_relation r on c.cp_id= r.cp_id and c.cp_id=#{cpId} and c.dr=0 and r.dr=0 
				inner join sp_service s on r.sp_id=s.sp_id
				<if test="spId != null and spId != ''"> AND s.sp_id=#{spId} </if>
				<if test="spsName != null and spsName != ''">AND s.sp_name like '%${spsName}%'</if>
				inner join sps_scheme scheme on s.sp_id=scheme.sp_id and scheme.dr=0
				<if test="authority != 'ALL'"> 
					and scheme.scheme_id in (${authority})
				</if>
				inner join bs_area a on scheme.area_id=a.area_id
				group by s.sp_id , a.belong_city
			) base
			left join bs_area a on base.belong_city=a.area_id
			group by base.sp_id
			order by bday
		) b
	</select>
	
	 <!-- 根据 服务商名称 查询 -->
	<select id="findSpByName" resultType="java.util.Map" parameterType="Object">
		select t.sp_id,t.sp_name,r.cp_id from sp_service t 
		INNER JOIN sp_cm_relation r 
		where t.sp_id=r.sp_id and t.sp_name = #{spName} and r.cp_id = #{cpId} 
		<if test="spId !=null ">
		 and t.sp_id != #{spId} 
		</if>
	</select>

</mapper>
