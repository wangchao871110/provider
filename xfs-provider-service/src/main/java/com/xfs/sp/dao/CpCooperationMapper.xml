<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CP_COOPERATION" >
    <!-- Result Map-->
    <resultMap id="result_map_CP_COOPERATION" type="com.xfs.sp.model.CpCooperation" >
        <result column="id" property="id"/>
        <result column="sp_id" property="spId"/>
        <result column="partner_sp_id" property="partnerSpId"/>
        <result column="type" property="type"/>
        <result column="person" property="person"/>
        <result column="mobile" property="mobile"/>
        <result column="bill_day" property="billDay"/>
        <result column="bill" property="bill"/>
        <result column="partner_person" property="partnerPerson"/>
        <result column="partner_mobile" property="partnerMobile"/>
        <result column="partner_bill_day" property="partnerBillDay"/>
        <result column="partner_bill" property="partnerBill"/>
        <result column="agreement" property="agreement"/>
        <result column="sign_dt" property="signDt"/>
        <result column="state" property="state"/>
        <result column="reason" property="reason"/>
        <result column="create_by" property="createBy"/>
        <result column="create_dt" property="createDt"/>
        <result column="modify_by" property="modifyBy"/>
        <result column="modify_dt" property="modifyDt"/>
        <result column="partner_cooperation_id" property="partnerCooperationId"/>
        <result column="dr" property="dr"/>
        <result column="relation" property="relation"/>
        <result column="begin_date" property="beginDate"/>
        <result column="end_date" property="endDate"/>
        <result column="pay_day" property="payDay"/>
    </resultMap>
    <resultMap id="result_map_ITEM_DTO" type="com.xfs.sp.dto.ItemDto" >
        <result column="item_id" property="itemId"/>
        <result column="item_name" property="itemName"/>
    </resultMap>

    <resultMap id="result_map_CP_COOPERATION_DTO" type="com.xfs.sp.dto.CpCooperationDto" >
        <result column="id" property="id"/>
        <result column="sp_id" property="spId"/>
        <result column="sp_name" property="spName"/>
        <result column="area_id" property="areaId"/>
        <result column="area_name" property="areaName"/>
        <result column="partner_sp_id" property="partnerSpId"/>
        <result column="type" property="type"/>
        <result column="person" property="person"/>
        <result column="mobile" property="mobile"/>
        <result column="bill_day" property="billDay"/>
        <result column="bill" property="bill"/>
        <result column="partner_person" property="partnerPerson"/>
        <result column="partner_mobile" property="partnerMobile"/>
        <result column="partner_bill_day" property="partnerBillDay"/>
        <result column="partner_bill" property="partnerBill"/>
        <result column="agreement" property="agreement"/>
        <result column="sign_dt" property="signDt"/>
        <result column="state" property="state"/>
        <result column="reason" property="reason"/>
        <result column="create_by" property="createBy"/>
        <result column="create_dt" property="createDt"/>
        <result column="modify_by" property="modifyBy"/>
        <result column="modify_dt" property="modifyDt"/>
        <result column="dr" property="dr"/>
        <result column="relation" property="relation"/>
        <result column="begin_date" property="beginDate"/>
        <result column="end_date" property="endDate"/>
        <result column="pay_day" property="payDay"/>
    </resultMap>



    <!-- cp_cooperation table all fields -->
    <sql id="Base_Column_List" >
	 id,sp_id,partner_sp_id,type,person,mobile,bill_day,bill,partner_person,partner_mobile,partner_bill_day,partner_bill,agreement,sign_dt,state,reason,create_by,create_dt,modify_by,modify_dt,partner_cooperation_id,dr,relation,begin_date,end_date,pay_day
</sql>

    <!-- 查询条件 -->
    <sql id="Example_Where_Clause">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="id != null" >and id = #{id}</if>
            <if test="spId != null" >and sp_id = #{spId}</if>
            <if test="partnerSpId != null" >and partner_sp_id = #{partnerSpId}</if>
            <if test="type != null" >and type = #{type}</if>
            <if test="person != null" >and person = #{person}</if>
            <if test="mobile != null" >and mobile = #{mobile}</if>
            <if test="billDay != null" >and bill_day = #{billDay}</if>
            <if test="bill != null" >and bill = #{bill}</if>
            <if test="partnerPerson != null" >and partner_person = #{partnerPerson}</if>
            <if test="partnerMobile != null" >and partner_mobile = #{partnerMobile}</if>
            <if test="partnerBillDay != null" >and partner_bill_day = #{partnerBillDay}</if>
            <if test="partnerBill != null" >and partner_bill = #{partnerBill}</if>
            <if test="agreement != null" >and agreement = #{agreement}</if>
            <if test="signDt != null" >and sign_dt = #{signDt}</if>
            <if test="state != null" >and state = #{state}</if>
            <if test="reason != null" >and reason = #{reason}</if>
            <if test="createBy != null" >and create_by = #{createBy}</if>
            <if test="createDt != null" >and create_dt = #{createDt}</if>
            <if test="modifyBy != null" >and modify_by = #{modifyBy}</if>
            <if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
            <if test="partnerCooperationId != null" >and partner_cooperation_id = #{partnerCooperationId}</if>
            <if test="dr != null" >and dr = #{dr}</if>
            <if test="relation != null" >and relation = #{relation}</if>
            <if test="beginDate != null">AND begin_date = #{beginDate}</if>
            <if test="beginDateFrom != null">AND begin_date&gt;=#{beginDateFrom}</if>
            <if test="beginDateTo != null">AND begin_date&lt;=#{beginDateTo}</if>
            <if test="endDate != null">AND end_date = #{endDate}</if>
            <if test="endDateFrom != null">AND end_date&gt;=#{endDateFrom}</if>
            <if test="endDateTo != null">AND end_date&lt;=#{endDateTo}</if>
            <if test="payDay != null">AND pay_day like '%${payDay}%'</if>
        </trim>
    </sql>

    <!-- 查询条件 带模糊查询 以及 时间起始查询 -->
    <sql id="Example_Where_Clause2">
        <trim prefix=" WHERE " prefixOverrides="AND ">
            <if test="id != null">AND id like '%${id}%'</if>
            <if test="spId != null">AND sp_id like '%${spId}%'</if>
            <if test="partnerSpId != null">AND partner_sp_id like '%${partnerSpId}%'</if>
            <if test="type != null">AND type like '%${type}%'</if>
            <if test="typeEq != null">AND type = #{typeEq}</if>
            <if test="person != null">AND person like '%${person}%'</if>
            <if test="personEq != null">AND person = #{personEq}</if>
            <if test="mobile != null">AND mobile like '%${mobile}%'</if>
            <if test="mobileEq != null">AND mobile = #{mobileEq}</if>
            <if test="billDay != null">AND bill_day like '%${billDay}%'</if>
            <if test="bill != null">AND bill like '%${bill}%'</if>
            <if test="partnerPerson != null">AND partner_person like '%${partnerPerson}%'</if>
            <if test="partnerPersonEq != null">AND partner_person = #{partnerPersonEq}</if>
            <if test="partnerMobile != null">AND partner_mobile like '%${partnerMobile}%'</if>
            <if test="partnerMobileEq != null">AND partner_mobile = #{partnerMobileEq}</if>
            <if test="partnerBillDay != null">AND partner_bill_day like '%${partnerBillDay}%'</if>
            <if test="partnerBill != null">AND partner_bill like '%${partnerBill}%'</if>
            <if test="agreement != null">AND agreement like '%${agreement}%'</if>
            <if test="agreementEq != null">AND agreement = #{agreementEq}</if>
            <if test="signDt != null">AND sign_dt = #{signDt}</if>
            <if test="signDtFrom != null">AND sign_dt&gt;=#{signDtFrom}</if>
            <if test="signDtTo != null">AND sign_dt&lt;=#{signDtTo}</if>
            <if test="state != null">AND state like '%${state}%'</if>
            <if test="stateEq != null">AND state = #{stateEq}</if>
            <if test="reason != null">AND reason like '%${reason}%'</if>
            <if test="reasonEq != null">AND reason = #{reasonEq}</if>
            <if test="createBy != null">AND create_by like '%${createBy}%'</if>
            <if test="createDt != null">AND create_dt = #{createDt}</if>
            <if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
            <if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
            <if test="modifyBy != null">AND modify_by like '%${modifyBy}%'</if>
            <if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
            <if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
            <if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
            <if test="partnerCooperationId != null">AND partner_cooperation_id like '%${partnerCooperationId}%'</if>
            <if test="dr != null">AND dr like '%${dr}%'</if>
            <if test="relation != null">AND relation like '%${relation}%'</if>
            <if test="relationEq != null">AND relation = #{relationEq}</if>
            <if test="beginDate != null">AND begin_date = #{beginDate}</if>
            <if test="beginDateFrom != null">AND begin_date&gt;=#{beginDateFrom}</if>
            <if test="beginDateTo != null">AND begin_date&lt;=#{beginDateTo}</if>
            <if test="endDate != null">AND end_date = #{endDate}</if>
            <if test="endDateFrom != null">AND end_date&gt;=#{endDateFrom}</if>
            <if test="endDateTo != null">AND end_date&lt;=#{endDateTo}</if>
            <if test="payDay != null">AND pay_day like '%${payDay}%'</if>
        </trim>
    </sql>

    <!-- 插入记录 -->
    <insert id="InsertCP_COOPERATION" parameterType="Object" >
        INSERT INTO CP_COOPERATION (
        <trim prefix=" " prefixOverrides=",">
            <if test="id != null ">,id</if>
            <if test="spId != null ">,sp_id</if>
            <if test="partnerSpId != null ">,partner_sp_id</if>
            <if test="type != null ">,type</if>
            <if test="person != null ">,person</if>
            <if test="mobile != null ">,mobile</if>
            <if test="billDay != null ">,bill_day</if>
            <if test="bill != null ">,bill</if>
            <if test="partnerPerson != null ">,partner_person</if>
            <if test="partnerMobile != null ">,partner_mobile</if>
            <if test="partnerBillDay != null ">,partner_bill_day</if>
            <if test="partnerBill != null ">,partner_bill</if>
            <if test="agreement != null ">,agreement</if>
            <if test="signDt != null ">,sign_dt</if>
            <if test="state != null ">,state</if>
            <if test="reason != null ">,reason</if>
            <if test="createBy != null ">,create_by</if>
            <if test="createDt != null ">,create_dt</if>
            <if test="modifyBy != null ">,modify_by</if>
            <if test="modifyDt != null ">,modify_dt</if>
            <if test="partnerCooperationId != null ">,partner_cooperation_id</if>
            <if test="dr != null ">,dr</if>
            <if test="relation != null ">,relation</if>
            <if test="beginDate != null ">,begin_date</if>
            <if test="endDate != null ">,end_date</if>
            <if test="payDay != null ">,pay_day</if>
        </trim>
        )  VALUES (
        <trim prefix=" " prefixOverrides=",">
            <if test="id != null ">,#{id}</if>
            <if test="spId != null ">,#{spId}</if>
            <if test="partnerSpId != null ">,#{partnerSpId}</if>
            <if test="type != null ">,#{type}</if>
            <if test="person != null ">,#{person}</if>
            <if test="mobile != null ">,#{mobile}</if>
            <if test="billDay != null ">,#{billDay}</if>
            <if test="bill != null ">,#{bill}</if>
            <if test="partnerPerson != null ">,#{partnerPerson}</if>
            <if test="partnerMobile != null ">,#{partnerMobile}</if>
            <if test="partnerBillDay != null ">,#{partnerBillDay}</if>
            <if test="partnerBill != null ">,#{partnerBill}</if>
            <if test="agreement != null ">,#{agreement}</if>
            <if test="signDt != null ">,#{signDt}</if>
            <if test="state != null ">,#{state}</if>
            <if test="reason != null ">,#{reason}</if>
            <if test="createBy != null ">,#{createBy}</if>
            <if test="createDt != null ">,#{createDt}</if>
            <if test="modifyBy != null ">,#{modifyBy}</if>
            <if test="modifyDt != null ">,#{modifyDt}</if>
            <if test="partnerCooperationId != null ">,#{partnerCooperationId}</if>
            <if test="dr != null ">,#{dr}</if>
            <if test="relation != null ">,#{relation}</if>
            <if test="beginDate != null ">,#{beginDate}</if>
            <if test="endDate != null ">,#{endDate}</if>
            <if test="payDay != null ">,#{payDay}</if>
        </trim>
        )
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID() AS ID
        </selectKey>
    </insert>

    <!-- 根据id，修改记录-->
    <update id="UpdateCP_COOPERATION" parameterType="Object" >
        UPDATE CP_COOPERATION
        <trim prefix=" SET " prefixOverrides=",">
            <if test="id != null ">,id=#{id}</if>
            <if test="spId != null ">,sp_id=#{spId}</if>
            <if test="partnerSpId != null ">,partner_sp_id=#{partnerSpId}</if>
            <if test="type != null ">,type=#{type}</if>
            <if test="person != null ">,person=#{person}</if>
            <if test="mobile != null ">,mobile=#{mobile}</if>
            <if test="billDay != null ">,bill_day=#{billDay}</if>
            <if test="bill != null ">,bill=#{bill}</if>
            <if test="partnerPerson != null ">,partner_person=#{partnerPerson}</if>
            <if test="partnerMobile != null ">,partner_mobile=#{partnerMobile}</if>
            <if test="partnerBillDay != null ">,partner_bill_day=#{partnerBillDay}</if>
            <if test="partnerBill != null ">,partner_bill=#{partnerBill}</if>
            <if test="agreement != null ">,agreement=#{agreement}</if>
            <if test="signDt != null ">,sign_dt=#{signDt}</if>
            <if test="state != null ">,state=#{state}</if>
            <if test="reason != null ">,reason=#{reason}</if>
            <if test="createBy != null ">,create_by=#{createBy}</if>
            <if test="createDt != null ">,create_dt=#{createDt}</if>
            <if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
            <if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
            <if test="partnerCooperationId != null ">,partner_cooperation_id=#{partnerCooperationId}</if>
            <if test="dr != null ">,dr=#{dr}</if>
            <if test="relation != null ">,relation=#{relation}</if>
            <if test="beginDate != null ">,begin_date=#{beginDate}</if>
            <if test="endDate != null ">,end_date=#{endDate}</if>
            <if test="payDay != null ">,pay_day=#{payDay}</if>
        </trim>
        WHERE ID=#{id}
    </update>

    <!-- 删除记录 -->
    <delete id="DeleteCP_COOPERATION">DELETE FROM CP_COOPERATION WHERE ID=#{id}</delete>
    <!-- 协同表 列表总数-->
    <select id="CountFindAllCP_COOPERATION" resultType="java.lang.Integer">SELECT count(1) as value FROM CP_COOPERATION</select>

    <select id="CountCP_COOPERATION" resultType="java.lang.Integer">SELECT count(1) as value FROM CP_COOPERATION WHERE ID=#{id}</select>
    <!-- 协同表 互为委托客户数-->
    <select id="CountFindClientMutualDepute" resultType="java.lang.Integer">
ELECT count(1) as value FROM CP_COOPERATION WHERE type=#{type}

</select>
    <!-- 根据id查询 协同表 -->
    <select id="FindByPK" resultMap="result_map_CP_COOPERATION" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM CP_COOPERATION WHERE ID=#{id}</select>

    <!-- 根据各字段条件带模糊查询  协同表 -->
    <select id="FreeFindCP_COOPERATION" resultMap="result_map_CP_COOPERATION" parameterType="Object">
        SELECT <include refid="Base_Column_List" /> FROM CP_COOPERATION
        <include refid="Example_Where_Clause2" />
    </select>
    <!-- 根据各字段条件带模糊查询  协同表 记录数 -->
    <select id="CountFreeFindCP_COOPERATION" resultType="java.lang.Integer">
        SELECT count(1) as value FROM CP_COOPERATION
        <include refid="Example_Where_Clause2" />
    </select>
    <!-- 根据各字段条件带排序  协同表 -->
    <select id="FreeFindCP_COOPERATIONOrdered" resultMap="result_map_CP_COOPERATION" parameterType="Object">
        SELECT <include refid="Base_Column_List" /> FROM CP_COOPERATION
        <include refid="Example_Where_Clause2" />
        ORDER BY ${_orderBy}
    </select>

    <!-- 根据各字段查询协同表 -->
    <select id="FindCP_COOPERATION_DTO_BY_CONDITION" resultMap="result_map_CP_COOPERATION_DTO" parameterType="Object">
        select co.id as id, co.sp_id as sp_id, se.sp_name as sp_name, area.area_id as area_id, area.name as area_name,
        co.partner_sp_id as partner_sp_id, co.type as type, co.person as person, co.mobile as mobile, co.bill_day as bill_day,
        co.bill as bill, co.partner_person as partner_person, co.partner_mobile as partner_mobile, co.partner_bill_day as partner_bill_day,
        co.partner_bill as partner_bill,co.agreement as agreement, co.sign_dt as sign_dt, co.state as state, co.reason as reason, co.create_by as create_by,
        co.create_dt as create_dt,co.modify_by as modify_by, co.modify_dt as modify_dt, co.dr as dr, co.relation as relation
        from sp_service se, bs_area area, cp_cooperation co where se.area_id = area.area_id and se.sp_id = co.partner_sp_id
        <if test="spId != null">AND co.sp_id = #{spId}</if>
        <if test="spName != null">AND se.sp_name like '%${spName}%'</if>
        <if test="type != null">AND co.type = #{type}</if>
        <if test="areaId != null">AND area.area_id = #{areaId}</if>
        <if test="state != null">AND co.state = #{state}</if>
        ORDER BY co.create_dt desc
    </select>


    <!-- 根据各字段条件带模糊查询  协同表 记录数 -->
    <select id="CountCP_COOPERATION_DTO_BY_CONDITION" resultType="java.lang.Integer">
        select count(1) from
        sp_service se, bs_area area, cp_cooperation co where se.area_id = area.area_id and se.sp_id = co.partner_sp_id
        <if test="spId != null">AND co.sp_id = #{spId}</if>
        <if test="spName != null">AND  se.sp_name like  '%${spName}%'</if>
        <if test="type != null">AND co.type = #{type}</if>
        <if test="areaId != null">AND area.area_id = #{areaId}</if>
        <if test="state != null">AND co.state = #{state}</if>
    </select>
    <!-- 根据各字段查询协同表 -->
    <select id="Find_AREA_BY_CONDITION" resultMap="result_map_CP_COOPERATION_DTO" parameterType="Object">
        select DISTINCT   area.area_id as area_id, area.name as area_name,a.`name`,a.area_id as p_id
        from sp_service se, bs_area area, cp_cooperation co,bs_area a where se.area_id = area.area_id and se.sp_id = co.partner_sp_id and a.area_id = area.belong_city
        <if test="spId != null">AND co.sp_id = #{spId}</if>
        <if test="spName != null">AND se.sp_name like '%${spName}%'</if>
        <if test="type != null">AND co.type = #{type}</if>
        <if test="areaId != null">AND area.area_id = #{areaId}</if>
        <if test="state != null">AND co.state = #{state}</if>
    </select>
    <!-- 根据各字段查询协同表 -->
    <select id="Find_ITEM_BY_CONDITION" resultMap="result_map_ITEM_DTO" parameterType="Object">
        select item.item_id as item_id, item.item_name as item_name from cp_cooperation co, cp_cooperation_rel re, bs_mall_item item where co.id = re.cp_cooperation_id  and item.item_id = re.item_id
        <if test="id != null">AND co.id = #{id}</if>
        <if test="itemType != null">AND re.type = #{itemType}</if>
    </select>

    <select id="find_AllSpServiceName" resultType="java.lang.String"
            parameterType="Object">
       	 select se.sp_name as sp_name from  sp_service se
       	  where  not exists(
       	    select * from  (
       	      select sse.sp_name as sp_name from sp_service sse, cp_cooperation coop
       	        where sse.sp_id = coop.partner_sp_id and coop.sp_id =#{spId} and coop.relation != "ENTRUSTED") as cc
       	        where se.sp_name=cc.sp_name) and se.sp_id != #{spId}
     </select>

    <!-- *****************************  温馨提示：  ***************************** -->
    <!-- **                                                                    ** -->
    <!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
    <!-- **                                             ** 2016/07/22 14:24:01 ** -->
    <!-- ************************************************************************ -->
    <resultMap id="mapType" type="java.util.Map">
	</resultMap>
    <!--  查询 可以分包的 服务商 -->
    <select id="findPackageSp" resultMap="mapType" parameterType="Object">
        SELECT sp.sp_id,sp.sp_name,spa.area_id,cp.type,cp.state,cp.relation FROM cp_cooperation cp
        LEFT JOIN sps_servicearea spa
        ON cp.partner_sp_id = spa.sp_id AND spa.rel_type = 'INNER'
		left JOIN sp_service sp on spa.sp_id=sp.sp_id
		INNER JOIN bs_area barea ON spa.area_id = barea.area_id
 		WHERE cp.sp_id = #{sp_id} AND barea.belong_city = #{area_id} and cp.relation = 'DEPUTE' and cp.state = 'SIGNED'
    </select>

</mapper>   
