<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BL_PAY_CHANNEL" > 
<!-- Result Map-->
<resultMap id="result_map_BL_PAY_CHANNEL" type="com.xfs.settlement.model.BlPayChannel" >
	<result column="pay_id" property="payId"/>
	<result column="ownert_type" property="ownertType"/>
	<result column="owner" property="owner"/>
	<result column="name" property="name"/>
	<result column="show_name" property="showName"/>
	<result column="pay_type" property="payType"/>
	<result column="partner_id" property="partnerId"/>
	<result column="payee_name" property="payeeName"/>
	<result column="account_bank" property="accountBank"/>
	<result column="account_branch_bank" property="accountBranchBank"/>
	<result column="account_no" property="accountNo"/>
	<result column="rsa_private" property="rsaPrivate"/>
	<result column="rsa_public" property="rsaPublic"/>
	<result column="channel_fee" property="channelFee"/>
	<result column="state" property="state"/>
	<result column="create_by" property="createBy"/>
	<result column="create_dt" property="createDt"/>
	<result column="modify_by" property="modifyBy"/>
	<result column="modify_dt" property="modifyDt"/>
	<result column="dr" property="dr"/>
</resultMap>

	<!-- bl_pay_channel table all fields -->
	<sql id="Base_Column_List" >
		pay_id,ownert_type,owner,name,show_name,pay_type,partner_id,payee_name,account_bank,account_branch_bank,account_no,rsa_private,rsa_public,channel_fee,state,create_by,create_dt,modify_by,modify_dt,dr
	</sql>

	<!-- 查询条件 -->
	<sql id="Example_Where_Clause">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="payId != null" >and pay_id = #{payId}</if>
			<if test="ownertType != null" >and ownert_type = #{ownertType}</if>
			<if test="owner != null" >and owner = #{owner}</if>
			<if test="name != null" >and name = #{name}</if>
			<if test="showName != null" >and show_name = #{showName}</if>
			<if test="payType != null" >and pay_type = #{payType}</if>
			<if test="partnerId != null" >and partner_id = #{partnerId}</if>
			<if test="payeeName != null" >and payee_name = #{payeeName}</if>
			<if test="accountBank != null" >and account_bank = #{accountBank}</if>
			<if test="accountBranchBank != null" >and account_branch_bank = #{accountBranchBank}</if>
			<if test="accountNo != null" >and account_no = #{accountNo}</if>
			<if test="rsaPrivate != null" >and rsa_private = #{rsaPrivate}</if>
			<if test="rsaPublic != null" >and rsa_public = #{rsaPublic}</if>
			<if test="channelFee != null" >and channel_fee = #{channelFee}</if>
			<if test="state != null" >and state = #{state}</if>
			<if test="createBy != null" >and create_by = #{createBy}</if>
			<if test="createDt != null" >and create_dt = #{createDt}</if>
			<if test="modifyBy != null" >and modify_by = #{modifyBy}</if>
			<if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
			<if test="dr != null" >and dr = #{dr}</if>
		</trim>
	</sql>

	<!-- 查询条件 带模糊查询 以及 时间起始查询 -->
	<sql id="Example_Where_Clause2">
		<trim prefix=" WHERE " prefixOverrides="AND ">
			<if test="payId != null">AND pay_id = #{payId}</if>
			<if test="ownertType != null">AND ownert_type like '%${ownertType}%'</if>
			<if test="ownertTypeEq != null">AND ownert_type = #{ownertTypeEq}</if>
			<if test="owner != null">AND owner = #{owner}</if>
			<if test="name != null">AND name like '%${name}%'</if>
			<if test="nameEq != null">AND name = #{nameEq}</if>
			<if test="showName != null">AND show_name like '%${showName}%'</if>
			<if test="showNameEq != null">AND show_name = #{showNameEq}</if>
			<if test="payType != null">AND pay_type like '%${payType}%'</if>
			<if test="payTypeEq != null">AND pay_type = #{payTypeEq}</if>
			<if test="partnerId != null">AND partner_id like '%${partnerId}%'</if>
			<if test="partnerIdEq != null">AND partner_id = #{partnerIdEq}</if>
			<if test="payeeName != null">AND payee_name like '%${payeeName}%'</if>
			<if test="payeeNameEq != null">AND payee_name = #{payeeNameEq}</if>
			<if test="accountBank != null">AND account_bank like '%${accountBank}%'</if>
			<if test="accountBankEq != null">AND account_bank = #{accountBankEq}</if>
			<if test="accountBranchBank != null">AND account_branch_bank like '%${accountBranchBank}%'</if>
			<if test="accountBranchBankEq != null">AND account_branch_bank = #{accountBranchBankEq}</if>
			<if test="accountNo != null">AND account_no like '%${accountNo}%'</if>
			<if test="accountNoEq != null">AND account_no = #{accountNoEq}</if>
			<if test="rsaPrivate != null">AND rsa_private like '%${rsaPrivate}%'</if>
			<if test="rsaPrivateEq != null">AND rsa_private = #{rsaPrivateEq}</if>
			<if test="rsaPublic != null">AND rsa_public like '%${rsaPublic}%'</if>
			<if test="rsaPublicEq != null">AND rsa_public = #{rsaPublicEq}</if>
			<if test="channelFee != null">AND channel_fee like '%${channelFee}%'</if>
			<if test="state != null">AND state like '%${state}%'</if>
			<if test="stateEq != null">AND state = #{stateEq}</if>
			<if test="createBy != null">AND create_by = #{createBy}</if>
			<if test="createDt != null">AND create_dt = #{createDt}</if>
			<if test="createDtFrom != null">AND create_dt&gt;=#{createDtFrom}</if>
			<if test="createDtTo != null">AND create_dt&lt;=#{createDtTo}</if>
			<if test="modifyBy != null">AND modify_by = #{modifyBy}</if>
			<if test="modifyDt != null">AND modify_dt = #{modifyDt}</if>
			<if test="modifyDtFrom != null">AND modify_dt&gt;=#{modifyDtFrom}</if>
			<if test="modifyDtTo != null">AND modify_dt&lt;=#{modifyDtTo}</if>
			<if test="dr != null">AND dr = #{dr}</if>
		</trim>
	</sql>

	<!-- 插入记录 -->
	<insert id="InsertBL_PAY_CHANNEL" parameterType="Object" >
		INSERT INTO BL_PAY_CHANNEL (
		<trim prefix=" " prefixOverrides=",">
			<if test="payId != null ">,pay_id</if>
			<if test="ownertType != null ">,ownert_type</if>
			<if test="owner != null ">,owner</if>
			<if test="name != null ">,name</if>
			<if test="showName != null ">,show_name</if>
			<if test="payType != null ">,pay_type</if>
			<if test="partnerId != null ">,partner_id</if>
			<if test="payeeName != null ">,payee_name</if>
			<if test="accountBank != null ">,account_bank</if>
			<if test="accountBranchBank != null ">,account_branch_bank</if>
			<if test="accountNo != null ">,account_no</if>
			<if test="rsaPrivate != null ">,rsa_private</if>
			<if test="rsaPublic != null ">,rsa_public</if>
			<if test="channelFee != null ">,channel_fee</if>
			<if test="state != null ">,state</if>
			<if test="createBy != null ">,create_by</if>
			<if test="createDt != null ">,create_dt</if>
			<if test="modifyBy != null ">,modify_by</if>
			<if test="modifyDt != null ">,modify_dt</if>
			<if test="dr != null ">,dr</if>
		</trim>
		)  VALUES (
		<trim prefix=" " prefixOverrides=",">
			<if test="payId != null ">,#{payId}</if>
			<if test="ownertType != null ">,#{ownertType}</if>
			<if test="owner != null ">,#{owner}</if>
			<if test="name != null ">,#{name}</if>
			<if test="showName != null ">,#{showName}</if>
			<if test="payType != null ">,#{payType}</if>
			<if test="partnerId != null ">,#{partnerId}</if>
			<if test="payeeName != null ">,#{payeeName}</if>
			<if test="accountBank != null ">,#{accountBank}</if>
			<if test="accountBranchBank != null ">,#{accountBranchBank}</if>
			<if test="accountNo != null ">,#{accountNo}</if>
			<if test="rsaPrivate != null ">,#{rsaPrivate}</if>
			<if test="rsaPublic != null ">,#{rsaPublic}</if>
			<if test="channelFee != null ">,#{channelFee}</if>
			<if test="state != null ">,#{state}</if>
			<if test="createBy != null ">,#{createBy}</if>
			<if test="createDt != null ">,#{createDt}</if>
			<if test="modifyBy != null ">,#{modifyBy}</if>
			<if test="modifyDt != null ">,#{modifyDt}</if>
			<if test="dr != null ">,#{dr}</if>
		</trim>
		)
		<selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="payId">
			SELECT LAST_INSERT_ID() AS PAY_ID
		</selectKey>
	</insert>

	<!-- 根据id，修改记录-->
	<update id="UpdateBL_PAY_CHANNEL" parameterType="Object" >
		UPDATE BL_PAY_CHANNEL
		<trim prefix=" SET " prefixOverrides=",">
			<if test="payId != null ">,pay_id=#{payId}</if>
			<if test="ownertType != null ">,ownert_type=#{ownertType}</if>
			<if test="owner != null ">,owner=#{owner}</if>
			<if test="name != null ">,name=#{name}</if>
			<if test="showName != null ">,show_name=#{showName}</if>
			<if test="payType != null ">,pay_type=#{payType}</if>
			<if test="partnerId != null ">,partner_id=#{partnerId}</if>
			<if test="payeeName != null ">,payee_name=#{payeeName}</if>
			<if test="accountBank != null ">,account_bank=#{accountBank}</if>
			<if test="accountBranchBank != null ">,account_branch_bank=#{accountBranchBank}</if>
			<if test="accountNo != null ">,account_no=#{accountNo}</if>
			<if test="rsaPrivate != null ">,rsa_private=#{rsaPrivate}</if>
			<if test="rsaPublic != null ">,rsa_public=#{rsaPublic}</if>
			<if test="channelFee != null ">,channel_fee=#{channelFee}</if>
			<if test="state != null ">,state=#{state}</if>
			<if test="createBy != null ">,create_by=#{createBy}</if>
			<if test="createDt != null ">,create_dt=#{createDt}</if>
			<if test="modifyBy != null ">,modify_by=#{modifyBy}</if>
			<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
			<if test="dr != null ">,dr=#{dr}</if>
		</trim>
		WHERE PAY_ID=#{payId}
	</update>

	<!-- 删除记录 -->
	<delete id="DeleteBL_PAY_CHANNEL">DELETE FROM BL_PAY_CHANNEL WHERE PAY_ID=#{payId}</delete>
	<!-- 任务单历史 列表总数-->
	<select id="CountFindAllBL_PAY_CHANNEL" resultType="java.lang.Integer">SELECT count(1) as value FROM BL_PAY_CHANNEL</select>
	<select id="CountBL_PAY_CHANNEL" resultType="java.lang.Integer">SELECT count(1) as value FROM BL_PAY_CHANNEL WHERE PAY_ID=#{payId}</select>
	<!-- 根据id查询 任务单历史 -->
	<select id="FindByPK" resultMap="result_map_BL_PAY_CHANNEL" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM BL_PAY_CHANNEL WHERE PAY_ID=#{payId}</select>

	<!-- 根据各字段条件带模糊查询  任务单历史 -->
	<select id="FreeFindBL_PAY_CHANNEL" resultMap="result_map_BL_PAY_CHANNEL" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM BL_PAY_CHANNEL
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带模糊查询  任务单历史 记录数 -->
	<select id="CountFreeFindBL_PAY_CHANNEL" resultType="java.lang.Integer">
		SELECT count(1) as value FROM BL_PAY_CHANNEL
		<include refid="Example_Where_Clause2" />
	</select>
	<!-- 根据各字段条件带排序  任务单历史 -->
	<select id="FreeFindBL_PAY_CHANNELOrdered" resultMap="result_map_BL_PAY_CHANNEL" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM BL_PAY_CHANNEL
		<include refid="Example_Where_Clause2" />
		ORDER BY ${_orderBy}
	</select>

	<!-- *****************************  温馨提示：  ***************************** -->
	<!-- **                                                                    ** -->
	<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
	<!-- **                                             ** 2016/11/17 16:32:48 ** -->
	<!-- ************************************************************************ -->

	<resultMap id="result_map_BUSIN_PAY_CHANNELS" type="com.xfs.settlement.dto.RespPayChannel" >
		<result column="pay_id" property="payId"/>
		<result column="name" property="name"/>
		<result column="show_name" property="showName"/>
		<result column="pay_type" property="payType"/>
		<result column="partner_id" property="partnerId"/>
		<result column="payee_name" property="payeeName"/>
		<result column="account_bank" property="accountBank"/>
		<result column="account_branch_bank" property="accountBranchBank"/>
		<result column="account_no" property="accountNo"/>
		<result column="channel_fee_type" property="channelFeeType"/>
		<result column="channel_fee_formula" property="channelFeeFormula"/>
		<result column="is_balance" property="isBalance"/>
		<result column="is_offline" property="isOffline"/>
		<result column="is_pc" property="isPc"/>
		<result column="is_wap" property="isWap"/>
		<result column="is_app" property="isApp"/>
	</resultMap>

	<!-- 获取业务支付渠道列表 -->
	<select id="QUERY_BUSIN_PAY_CHANNELS" resultMap="result_map_BUSIN_PAY_CHANNELS" parameterType="Object">
		SELECT ch.pay_id,ch.`name`,ch.show_name,ch.pay_type,ch.payee_name,ch.account_bank,ch.account_branch_bank,ch.account_no,rel.channel_fee_type,rel.channel_fee_formula,bus.is_balance,bus.is_offline,rel.is_pc,rel.is_wap,rel.is_app FROM bl_pay_business bus INNER JOIN bl_pay_businessrel rel ON bus.bus_id = rel.bus_id AND bus.app_id = #{appId}
		AND bus.state = 'USE' AND bus.dr = 0 AND rel.state = 'USE' AND rel.dr = 0
		INNER JOIN bl_pay_channel ch ON rel.pay_id = ch.pay_id AND rel.bus_id AND ch.state = 'USE' AND ch.dr = 0
		<if test="payeeId == null and payeeType != null">
			AND ch.ownert_type = #{payeeType}
		</if>
		<if test="payeeId != null and payeeType != null">
			AND ch.`owner` = #{payeeId} AND ch.ownert_type = #{payeeType}
		</if>
	</select>

	<!-- 获取业务支付渠道 -->
	<select id="QUERY_BUSIN_PAY_CHANNEL" resultMap="result_map_BUSIN_PAY_CHANNELS" parameterType="Object">
		SELECT ch.pay_id,ch.`name`,ch.show_name,ch.pay_type,ch.payee_name,ch.account_bank,ch.account_branch_bank,ch.account_no,rel.channel_fee_type,rel.channel_fee_formula,bus.is_balance,bus.is_offline,rel.is_pc,rel.is_wap,rel.is_app FROM bl_pay_business bus INNER JOIN bl_pay_businessrel rel ON bus.bus_id = rel.bus_id AND bus.app_id = #{appId}
		AND bus.state = 'USE' AND bus.dr = 0 AND rel.state = 'USE' AND rel.dr = 0
		INNER JOIN bl_pay_channel ch ON rel.pay_id = ch.pay_id AND rel.bus_id AND ch.state = 'USE' AND ch.dr = 0  AND ch.pay_id = #{payId};
	</select>


	<resultMap id="result_map_BUSIN_PAY_INFO" type="com.xfs.settlement.dto.RespOthPay" >
		<result column="partner_id" property="partnerId"/>
		<result column="payee_name" property="payeeName"/>
		<result column="account_no" property="accountNo"/>
		<result column="rsa_private" property="rsaPrivate"/>
		<result column="rsa_public" property="rsaPublic"/>
		<result column="member_id" property="memberId"/>
		<result column="cpartner_id" property="cpartnerId"/>
		<result column="bus_id" property="busId"/>
		<result column="pay_url" property="payUrl"/>
		<result column="service_url" property="serviceUrl"/>
	</resultMap>

	<!-- 获取第三方支付参数信息 -->
	<select id="QUERY_BUSIN_PAY_INFO" resultMap="result_map_BUSIN_PAY_INFO" parameterType="Object">
		SELECT cha.partner_id,cha.payee_name,cha.account_no,cha.rsa_public,cha.rsa_private,ent.member_id,ent.member_id as cpartner_id,cha.pay_url,cha.service_url,bus.bus_id FROM bl_pay_channel cha
		INNER JOIN bl_pay_businessrel rel ON cha.pay_id = rel.pay_id AND cha.state = 'USE' AND cha.dr = 0 AND rel.state = 'USE' AND rel.dr = 0 AND cha.pay_type = #{payType}
		INNER JOIN bl_pay_business bus ON bus.state = 'USE' AND bus.dr = 0 AND bus.app_id = #{appId} AND bus.bus_id = rel.bus_id AND bus.bus_id = #{busId}
		LEFT JOIN bl_pay_enterprise ent ON ent.state = 'USE' AND ent.dr = 0 AND ent.owner = #{payeeId} AND ent.owner_type = #{payeeType}
	</select>

	<!-- 根据订单号查询第三方支付参数信息 -->
	<select id="QUERY_BUSIN_PAY_INFO_BY_ORDERID" resultMap="result_map_BUSIN_PAY_INFO" parameterType="Object">
		SELECT cha.partner_id,cha.payee_name,cha.account_no,cha.rsa_public,cha.rsa_private,bus.bus_id,cha.pay_url,cha.service_url FROM bl_pay_voucher vou INNER JOIN
		bl_pay_channel cha ON cha.pay_id = vou.pay_id AND vou.order_id = #{order_id}
		INNER JOIN bl_pay_businessrel rel ON cha.pay_id = rel.pay_id AND cha.state = 'USE' AND cha.dr = 0 AND rel.state = 'USE' AND rel.dr = 0 AND cha.pay_type = vou.pay_type
		INNER JOIN bl_pay_business bus ON bus.state = 'USE' AND bus.dr = 0 AND bus.bus_id = vou.bus_id AND bus.bus_id = rel.bus_id
	</select>

	<!-- 查询畅捷通支付参数 -->
    <select id="QUERY_BUSIN_PAY_CHAN_PAY_INFO" resultMap="result_map_BUSIN_PAY_INFO" parameterType="Object">
        SELECT cha.partner_id,cha.payee_name,cha.account_no,cha.rsa_public,cha.rsa_private,cha.pay_url,cha.service_url FROM bl_pay_channel cha
        INNER JOIN bl_pay_businessrel rel ON cha.pay_id = rel.pay_id AND cha.state = 'USE' AND cha.dr = 0 AND rel.state = 'USE' AND rel.dr = 0 AND cha.pay_type = 'CHANPAY'
        INNER JOIN bl_pay_business bus ON bus.state = 'USE' AND bus.dr = 0 AND bus.app_id =  #{appId} AND bus.bus_id = rel.bus_id
    </select>

</mapper>   
