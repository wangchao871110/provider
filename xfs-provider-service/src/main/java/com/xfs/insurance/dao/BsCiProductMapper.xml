<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BS_CI_PRODUCT" > 
<!-- Result Map-->
<resultMap id="result_map_BS_CI_PRODUCT" type="com.xfs.insurance.model.BsCiProduct" >
	<result column="id" property="id"/>
	<result column="mall_item_id" property="mallItemId"/>
	<result column="insurer_id" property="insurerId"/>
	<result column="contact_number" property="contactNumber"/>
	<result column="suit_crowd" property="suitCrowd"/>
	<result column="charge_way" property="chargeWay"/>
	<result column="ins_time" property="insTime"/>
	<result column="policy_name" property="policyName"/>
	<result column="policy_file" property="policyFile"/>
	<result column="claims_process" property="claimsProcess"/>
	<result column="ins_notice" property="insNotice"/>
	<result column="state" property="state"/>
	<result column="suit_occupation" property="suitOccupation"/>
	<result column="occupation_file" property="occupationFile"/>
	<result column="occupation_explain" property="occupationExplain"/>
	<result column="special_remind" property="specialRemind"/>
	<result column="service_scope" property="serviceScope"/>
	<result column="service_scope_file" property="serviceScopeFile"/>
	<result column="insure_template_file" property="insureTemplateFile"/>
	<result column="insure_template_name" property="insureTemplateName"/>
	<result column="can_agent" property="canAgent"/>
	<result column="ins_notice_file" property="insNoticeFile"/>
	<result column="ins_notice_name" property="insNoticeName"/>
</resultMap>
       
<!-- bs_ci_product table all fields -->
<sql id="Base_Column_List" >
	 id,mall_item_id,insurer_id,contact_number,suit_crowd,charge_way,ins_time,policy_name,policy_file,claims_process,ins_notice,state,suit_occupation,occupation_file,occupation_explain,special_remind,service_scope,service_scope_file,insure_template_file,insure_template_name,can_agent,ins_notice_file,ins_notice_name
</sql>

<!-- 查询条件 -->
<sql id="Example_Where_Clause">
  <trim prefix=" WHERE " prefixOverrides="AND ">
	<if test="id != null" >and id = #{id}</if>
	<if test="mallItemId != null" >and mall_item_id = #{mallItemId}</if>
	<if test="insurerId != null" >and insurer_id = #{insurerId}</if>
	<if test="contactNumber != null" >and contact_number = #{contactNumber}</if>
	<if test="suitCrowd != null" >and suit_crowd = #{suitCrowd}</if>
	<if test="chargeWay != null" >and charge_way = #{chargeWay}</if>
	<if test="insTime != null" >and ins_time = #{insTime}</if>
	<if test="policyName != null" >and policy_name = #{policyName}</if>
	<if test="policyFile != null" >and policy_file = #{policyFile}</if>
	<if test="claimsProcess != null" >and claims_process = #{claimsProcess}</if>
	<if test="insNotice != null" >and ins_notice = #{insNotice}</if>
	<if test="state != null" >and state = #{state}</if>
	<if test="suitOccupation != null" >and suit_occupation = #{suitOccupation}</if>
	<if test="occupationFile != null" >and occupation_file = #{occupationFile}</if>
	<if test="occupationExplain != null" >and occupation_explain = #{occupationExplain}</if>
	<if test="specialRemind != null" >and special_remind = #{specialRemind}</if>
	<if test="serviceScope != null" >and service_scope = #{serviceScope}</if>
	<if test="serviceScopeFile != null" >and service_scope_file = #{serviceScopeFile}</if>
	<if test="insureTemplateFile != null" >and insure_template_file = #{insureTemplateFile}</if>
	<if test="insureTemplateName != null" >and insure_template_name = #{insureTemplateName}</if>
	<if test="canAgent != null" >and can_agent = #{canAgent}</if>
	<if test="insNoticeFile != null" >and ins_notice_file = #{insNoticeFile}</if>
	<if test="insNoticeName != null" >and ins_notice_name = #{insNoticeName}</if>
</trim>
</sql>

<!-- 查询条件 带模糊查询 以及 时间起始查询 -->
<sql id="Example_Where_Clause2">
  <trim prefix=" WHERE " prefixOverrides="AND ">
    <if test="id != null">AND id = #{id}</if>
    <if test="mallItemId != null">AND mall_item_id = #{mallItemId}</if>
    <if test="insurerId != null">AND insurer_id = #{insurerId}</if>
    <if test="contactNumber != null">AND contact_number like '%${contactNumber}%'</if>
    <if test="contactNumberEq != null">AND contact_number = #{contactNumberEq}</if>
    <if test="suitCrowd != null">AND suit_crowd like '%${suitCrowd}%'</if>
    <if test="suitCrowdEq != null">AND suit_crowd = #{suitCrowdEq}</if>
    <if test="chargeWay != null">AND charge_way like '%${chargeWay}%'</if>
    <if test="chargeWayEq != null">AND charge_way = #{chargeWayEq}</if>
    <if test="insTime != null">AND ins_time like '%${insTime}%'</if>
    <if test="insTimeEq != null">AND ins_time = #{insTimeEq}</if>
    <if test="policyName != null">AND policy_name like '%${policyName}%'</if>
    <if test="policyNameEq != null">AND policy_name = #{policyNameEq}</if>
    <if test="policyFile != null">AND policy_file like '%${policyFile}%'</if>
    <if test="policyFileEq != null">AND policy_file = #{policyFileEq}</if>
    <if test="claimsProcess != null">AND claims_process like '%${claimsProcess}%'</if>
    <if test="claimsProcessEq != null">AND claims_process = #{claimsProcessEq}</if>
    <if test="insNotice != null">AND ins_notice like '%${insNotice}%'</if>
    <if test="insNoticeEq != null">AND ins_notice = #{insNoticeEq}</if>
    <if test="state != null">AND state like '%${state}%'</if>
    <if test="stateEq != null">AND state = #{stateEq}</if>
    <if test="suitOccupation != null">AND suit_occupation like '%${suitOccupation}%'</if>
    <if test="suitOccupationEq != null">AND suit_occupation = #{suitOccupationEq}</if>
    <if test="occupationFile != null">AND occupation_file like '%${occupationFile}%'</if>
    <if test="occupationFileEq != null">AND occupation_file = #{occupationFileEq}</if>
    <if test="occupationExplain != null">AND occupation_explain like '%${occupationExplain}%'</if>
    <if test="occupationExplainEq != null">AND occupation_explain = #{occupationExplainEq}</if>
    <if test="specialRemind != null">AND special_remind like '%${specialRemind}%'</if>
    <if test="specialRemindEq != null">AND special_remind = #{specialRemindEq}</if>
    <if test="serviceScope != null">AND service_scope like '%${serviceScope}%'</if>
    <if test="serviceScopeEq != null">AND service_scope = #{serviceScopeEq}</if>
    <if test="serviceScopeFile != null">AND service_scope_file like '%${serviceScopeFile}%'</if>
    <if test="serviceScopeFileEq != null">AND service_scope_file = #{serviceScopeFileEq}</if>
    <if test="insureTemplateFile != null">AND insure_template_file like '%${insureTemplateFile}%'</if>
    <if test="insureTemplateFileEq != null">AND insure_template_file = #{insureTemplateFileEq}</if>
    <if test="insureTemplateName != null">AND insure_template_name like '%${insureTemplateName}%'</if>
    <if test="insureTemplateNameEq != null">AND insure_template_name = #{insureTemplateNameEq}</if>
    <if test="canAgent != null">AND can_agent = #{canAgent}</if>
    <if test="insNoticeFile != null">AND ins_notice_file like '%${insNoticeFile}%'</if>
    <if test="insNoticeFileEq != null">AND ins_notice_file = #{insNoticeFileEq}</if>
    <if test="insNoticeName != null">AND ins_notice_name like '%${insNoticeName}%'</if>
    <if test="insNoticeNameEq != null">AND ins_notice_name = #{insNoticeNameEq}</if>
  </trim>
</sql>

<!-- 插入记录 -->
<insert id="InsertBS_CI_PRODUCT" parameterType="Object" >
  INSERT INTO BS_CI_PRODUCT (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,id</if>
	<if test="mallItemId != null ">,mall_item_id</if>
	<if test="insurerId != null ">,insurer_id</if>
	<if test="contactNumber != null ">,contact_number</if>
	<if test="suitCrowd != null ">,suit_crowd</if>
	<if test="chargeWay != null ">,charge_way</if>
	<if test="insTime != null ">,ins_time</if>
	<if test="policyName != null ">,policy_name</if>
	<if test="policyFile != null ">,policy_file</if>
	<if test="claimsProcess != null ">,claims_process</if>
	<if test="insNotice != null ">,ins_notice</if>
	<if test="state != null ">,state</if>
	<if test="suitOccupation != null ">,suit_occupation</if>
	<if test="occupationFile != null ">,occupation_file</if>
	<if test="occupationExplain != null ">,occupation_explain</if>
	<if test="specialRemind != null ">,special_remind</if>
	<if test="serviceScope != null ">,service_scope</if>
	<if test="serviceScopeFile != null ">,service_scope_file</if>
	<if test="insureTemplateFile != null ">,insure_template_file</if>
	<if test="insureTemplateName != null ">,insure_template_name</if>
	<if test="canAgent != null ">,can_agent</if>
	<if test="insNoticeFile != null ">,ins_notice_file</if>
	<if test="insNoticeName != null ">,ins_notice_name</if>
  </trim>
  )  VALUES (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,#{id}</if>
	<if test="mallItemId != null ">,#{mallItemId}</if>
	<if test="insurerId != null ">,#{insurerId}</if>
	<if test="contactNumber != null ">,#{contactNumber}</if>
	<if test="suitCrowd != null ">,#{suitCrowd}</if>
	<if test="chargeWay != null ">,#{chargeWay}</if>
	<if test="insTime != null ">,#{insTime}</if>
	<if test="policyName != null ">,#{policyName}</if>
	<if test="policyFile != null ">,#{policyFile}</if>
	<if test="claimsProcess != null ">,#{claimsProcess}</if>
	<if test="insNotice != null ">,#{insNotice}</if>
	<if test="state != null ">,#{state}</if>
	<if test="suitOccupation != null ">,#{suitOccupation}</if>
	<if test="occupationFile != null ">,#{occupationFile}</if>
	<if test="occupationExplain != null ">,#{occupationExplain}</if>
	<if test="specialRemind != null ">,#{specialRemind}</if>
	<if test="serviceScope != null ">,#{serviceScope}</if>
	<if test="serviceScopeFile != null ">,#{serviceScopeFile}</if>
	<if test="insureTemplateFile != null ">,#{insureTemplateFile}</if>
	<if test="insureTemplateName != null ">,#{insureTemplateName}</if>
	<if test="canAgent != null ">,#{canAgent}</if>
	<if test="insNoticeFile != null ">,#{insNoticeFile}</if>
	<if test="insNoticeName != null ">,#{insNoticeName}</if>
  </trim>
  )
  <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
	SELECT LAST_INSERT_ID() AS ID
  </selectKey>
</insert>

<!-- 根据id，修改记录-->  
<update id="UpdateBS_CI_PRODUCT" parameterType="Object" >
UPDATE BS_CI_PRODUCT 
  <trim prefix=" SET " prefixOverrides=",">
	<if test="id != null ">,id=#{id}</if>
	<if test="mallItemId != null ">,mall_item_id=#{mallItemId}</if>
	<if test="insurerId != null ">,insurer_id=#{insurerId}</if>
	<if test="contactNumber != null ">,contact_number=#{contactNumber}</if>
	<if test="suitCrowd != null ">,suit_crowd=#{suitCrowd}</if>
	<if test="chargeWay != null ">,charge_way=#{chargeWay}</if>
	<if test="insTime != null ">,ins_time=#{insTime}</if>
	<if test="policyName != null ">,policy_name=#{policyName}</if>
	<if test="policyFile != null ">,policy_file=#{policyFile}</if>
	<if test="claimsProcess != null ">,claims_process=#{claimsProcess}</if>
	<if test="insNotice != null ">,ins_notice=#{insNotice}</if>
	<if test="state != null ">,state=#{state}</if>
	<if test="suitOccupation != null ">,suit_occupation=#{suitOccupation}</if>
	<if test="occupationFile != null ">,occupation_file=#{occupationFile}</if>
	<if test="occupationExplain != null ">,occupation_explain=#{occupationExplain}</if>
	<if test="specialRemind != null ">,special_remind=#{specialRemind}</if>
	<if test="serviceScope != null ">,service_scope=#{serviceScope}</if>
	<if test="serviceScopeFile != null ">,service_scope_file=#{serviceScopeFile}</if>
	<if test="insureTemplateFile != null ">,insure_template_file=#{insureTemplateFile}</if>
	<if test="insureTemplateName != null ">,insure_template_name=#{insureTemplateName}</if>
	<if test="canAgent != null ">,can_agent=#{canAgent}</if>
	<if test="insNoticeFile != null ">,ins_notice_file=#{insNoticeFile}</if>
	<if test="insNoticeName != null ">,ins_notice_name=#{insNoticeName}</if>
  </trim>
WHERE ID=#{id}
</update>
 
<!-- 删除记录 -->
<delete id="DeleteBS_CI_PRODUCT">DELETE FROM BS_CI_PRODUCT WHERE ID=#{id}</delete>
<!-- 商保产品信息表 列表总数-->
<select id="CountFindAllBS_CI_PRODUCT" resultType="java.lang.Integer">SELECT count(1) as value FROM BS_CI_PRODUCT</select>
<select id="CountBS_CI_PRODUCT" resultType="java.lang.Integer">SELECT count(1) as value FROM BS_CI_PRODUCT WHERE ID=#{id}</select>
<!-- 根据id查询 商保产品信息表 -->
<select id="FindByPK" resultMap="result_map_BS_CI_PRODUCT" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM BS_CI_PRODUCT WHERE ID=#{id}</select>

<!-- 根据各字段条件带模糊查询  商保产品信息表 -->
<select id="FreeFindBS_CI_PRODUCT" resultMap="result_map_BS_CI_PRODUCT" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM BS_CI_PRODUCT 
	 <include refid="Example_Where_Clause2" />
</select>
<!-- 根据各字段条件带模糊查询  商保产品信息表 记录数 -->
<select id="CountFreeFindBS_CI_PRODUCT" resultType="java.lang.Integer">
SELECT count(1) as value FROM BS_CI_PRODUCT 
 <include refid="Example_Where_Clause2" />
</select>
<!-- 根据各字段条件带排序  商保产品信息表 -->
<select id="FreeFindBS_CI_PRODUCTOrdered" resultMap="result_map_BS_CI_PRODUCT" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM BS_CI_PRODUCT 
	 <include refid="Example_Where_Clause2" />
	 ORDER BY ${_orderBy}
</select>

<!-- *****************************  温馨提示：  ***************************** -->
<!-- **                                                                    ** -->
<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
<!-- **                                             ** 2016/09/01 20:36:57 ** -->
<!-- ************************************************************************ -->

	<select id="countCiProduct" parameterType="Object" resultType="java.lang.Integer">
		select count(1)
		from bs_mall_item mi
		inner join bs_mall_item_category mic on (mi.category_id = mic.category_id and mic.category_type ='CI' and mic.pid != 0)
		left join bs_ci_product cp on (mi.item_id = cp.mall_item_id)
		left join bs_ci_insurer ci on (cp.insurer_id = ci.id)
		where 1=1
		<if test="itemName != null and itemName != ''">and mi.item_name like '%${itemName}%'</if>
		<if test="itemId != null">and mi.item_id = #{itemId}</if>
		<if test="categoryId != null">and mi.category_id = #{categoryId}</if>
		<if test="insurerId != null">and cp.insurer_id = #{insurerId}</if>
		<if test="categoryType != null and categoryType != ''">and mic.category_type = #{categoryType}</if>
		<if test="dr != null ">and mi.dr = #{dr}</if>
	</select>

	<select id="findCiProduct" parameterType="Object" resultType="com.xfs.insurance.dto.CiProduct">
		select mi.item_id, mi.item_name, mi.content, mi.category_id, mi.dr, mic.category_name, mic.category_type, cp.*,
		ci.name as insurer_name, ci.show_name as insurer_show_name, ifnull(ccp.dr, 1) is_sale
		from bs_mall_item mi
		inner join bs_mall_item_category mic on (mi.category_id = mic.category_id and mic.category_type = 'CI' and mic.pid != 0)
		left join bs_ci_product cp on (mi.item_id = cp.mall_item_id)
		left join bs_ci_insurer ci on (cp.insurer_id = ci.id)
		left join cp_ci_prod ccp on ccp.ci_code = mi.item_id
		where 1=1
		<if test="itemName != null and itemName != ''">and mi.item_name like '%${itemName}%'</if>
		<if test="itemId != null">and mi.item_id = #{itemId}</if>
		<if test="categoryId != null">and mi.category_id = #{categoryId}</if>
		<if test="insurerId != null">and cp.insurer_id = #{insurerId}</if>
		<if test="categoryType != null and categoryType != ''">and mic.category_type = #{categoryType}</if>
		<if test="dr != null ">and mi.dr = #{dr}</if>
	</select>

	<select id="findCiProductForGroup" parameterType="Object" resultType="com.xfs.insurance.dto.CiProduct">
        select mi.item_id, mi.item_name, mi.content, mi.category_id, mi.dr, mic.category_name, mic.category_type, cp.*,
          ci.name as insurer_name, ci.show_name as insurer_show_name
        from bs_mall_item mi
          inner join bs_mall_item_category mic
            on (mi.category_id = mic.category_id and mic.category_type = 'CI' and mic.pid != 0)
          inner join (select count(1) as total, mall_item_id
                      from bs_ci_scheme
                      group by mall_item_id
                      having (total = 1)) cs on cs.mall_item_id = mi.item_id
		inner join bs_ci_product cp on (mi.item_id = cp.mall_item_id)
          left join bs_ci_insurer ci on (cp.insurer_id = ci.id)
        where cp.charge_way = '1'
		<if test="itemName != null and itemName != ''">and mi.item_name like '%${itemName}%'</if>
		<if test="itemId != null">and mi.item_id = #{itemId}</if>
		<if test="categoryId != null">and mi.category_id = #{categoryId}</if>
		<if test="insurerId != null">and cp.insurer_id = #{insurerId}</if>
		<if test="categoryType != null and categoryType != ''">and mic.category_type = #{categoryType}</if>
		<if test="dr != null ">and mi.dr = #{dr}</if>
	</select>

    <select id="FreeFindCI_PRODUCT" parameterType="Object" resultType="com.xfs.insurance.dto.CiProduct">
		select mi.item_id, mi.item_name, mi.content, mi.category_id, mic.category_name, mic.category_type, cp.mall_item_id,
		cp.insurer_id, cp.contact_number, cp.suit_crowd, cp.charge_way, cp.ins_time, cp.policy_name, cp.policy_file,
		cp.claims_process, cp.ins_notice, cp.state, cp.suit_occupation, cp.occupation_file, cp.occupation_explain,
		cp.special_remind, cp.service_scope, cp.service_scope_file, ci.name as insurer_name, ci.show_name as insurer_show_name,
		mp.product_id, mp.per_month_price
		from bs_mall_item mi
		inner join bs_mall_item_category mic
		on (mi.category_id = mic.category_id and mic.category_type ='CI' and mic.dr = 0 and mic.pid != 0)
		inner join bs_ci_product cp on (mi.item_id = cp.mall_item_id and cp.can_agent = 0)
		left join bs_ci_insurer ci on (cp.insurer_id = ci.id)
		left join sps_mall_product mp on (mi.item_id = mp.agent_ci_id and mp.sp_id = #{spId} and mp.dr=0 )
		where mi.dr = 0
        <if test="itemName != null and itemName != '' ">and mi.item_name like '%${itemName}%'</if>
        <if test="categoryId != null">and mi.category_id = #{categoryId}</if>
        <if test="insurerId != null">and cp.insurer_id = #{insurerId}</if>
        <if test="itemId != null">and mi.item_id = #{itemId}</if>
    </select>
	<select id="findCiGroupItemDetail" parameterType="Object" resultType="com.xfs.insurance.dto.CiScheme">
		select cs.id, cs.mall_item_id, cs.scheme_name, mpi.price, scheme_desc, scheme_insure
          from bs_ci_scheme cs
         inner join sps_mall_product_item mpi on mpi.item_id = cs.mall_item_id and mpi.product_id = #{prodId}
         where mall_item_id = #{itemId}
         group by mall_item_id
	</select>
</mapper>   
