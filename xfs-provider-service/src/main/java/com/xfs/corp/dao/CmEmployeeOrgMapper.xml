<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CM_EMPLOYEE_ORG" > 
<!-- Result Map-->
<resultMap id="result_map_CM_EMPLOYEE_ORG" type="com.xfs.corp.model.CmEmployeeOrg" >
	<result column="id" property="id"/>
	<result column="cp_id" property="cpId"/>
	<result column="emp_id" property="empId"/>
	<result column="scheme_id" property="schemeId"/>
	<result column="name" property="name"/>
	<result column="identity_type" property="identityType"/>
	<result column="identity_code" property="identityCode"/>
	<result column="area_id" property="areaId"/>
	<result column="fund_state" property="fundState"/>
	<result column="insurance_fund_type" property="insuranceFundType"/>
	<result column="insurance_state" property="insuranceState"/>
	<result column="insurance_salary" property="insuranceSalary"/>
	<result column="fund_salary" property="fundSalary"/>
	<result column="insurance_period" property="insurancePeriod"/>
	<result column="fund_period" property="fundPeriod"/>
	<result column="insurance_living_type" property="insuranceLivingType"/>
	<result column="mobile" property="mobile"/>
	<result column="head_photo" property="headPhoto"/>
	<result column="sync_mark" property="syncMark"/>
	<result column="sign_mark" property="signMark"/>
	<result column="change_mark" property="changeMark"/>
	<result column="json" property="json"/>
	<result column="dr" property="dr"/>
	<result column="modify_dt" property="modifyDt"/>
	<result column="create_dt" property="createDt"/>
	<result column="areaName" property="areaName"/>
	<result column="ids" property="ids"/>
	<result column="sysEmpName" property="sysEmpName"/>
	<result column="repeat" property="repeat"/>
	<result column="analysis_num" property="analysisNum"/>
</resultMap>
       
<!-- cm_employee_org table all fields -->
<sql id="Base_Column_List" >
	 id,cp_id,emp_id,scheme_id,name,identity_type,identity_code,area_id,fund_state,insurance_fund_type,insurance_state,insurance_salary,fund_salary,insurance_period,fund_period,insurance_living_type,mobile,head_photo,sync_mark,sign_mark,change_mark,json,dr,modify_dt,create_dt,`repeat`,analysis_num
</sql>

<!-- 查询条件 -->
<sql id="Example_Where_Clause">
  <trim prefix=" WHERE " prefixOverrides="AND ">
	<if test="id != null" >and id = #{id}</if>
	<if test="cpId != null" >and cp_id = #{cpId}</if>
	<if test="empId != null" >and emp_id = #{empId}</if>
	<if test="schemeId != null" >and scheme_id = #{schemeId}</if>
	<if test="name != null" >and name = #{name}</if>
	<if test="identityType != null" >and identity_type = #{identityType}</if>
	<if test="identityCode != null" >and identity_code = #{identityCode}</if>
	<if test="areaId != null" >and area_id = #{areaId}</if>
	<if test="fundState != null" >and fund_state = #{fundState}</if>
	<if test="insuranceFundType != null" >and insurance_fund_type = #{insuranceFundType}</if>
	<if test="insuranceState != null" >and insurance_state = #{insuranceState}</if>
	<if test="insuranceSalary != null" >and insurance_salary = #{insuranceSalary}</if>
	<if test="fundSalary != null" >and fund_salary = #{fundSalary}</if>
	<if test="insurancePeriod != null" >and insurance_period = #{insurancePeriod}</if>
	<if test="fundPeriod != null" >and fund_period = #{fundPeriod}</if>
	<if test="insuranceLivingType != null" >and insurance_living_type = #{insuranceLivingType}</if>
	<if test="mobile != null" >and mobile = #{mobile}</if>
	<if test="headPhoto != null" >and head_photo = #{headPhoto}</if>
	<if test="syncMark != null" >and sync_mark = #{syncMark}</if>
	<if test="signMark != null" >and sign_mark = #{signMark}</if>
	<if test="changeMark != null" >and change_mark = #{changeMark}</if>
	<if test="json != null" >and json = #{json}</if>
	<if test="dr != null" >and dr = #{dr}</if>
	<if test="modifyDt != null" >and modify_dt = #{modifyDt}</if>
	<if test="createDt != null" >and create_dt = #{createDt}</if>
	<if test="analysisNum != null" >and analysis_num = #{analysisNum}</if>
</trim>
</sql>

<!-- 插入记录 -->
<insert id="InsertCM_EMPLOYEE_ORG" parameterType="Object" >
  INSERT INTO CM_EMPLOYEE_ORG (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,id</if>
	<if test="cpId != null ">,cp_id</if>
	<if test="empId != null ">,emp_id</if>
	<if test="schemeId != null ">,scheme_id</if>
	<if test="name != null ">,name</if>
	<if test="identityType != null ">,identity_type</if>
	<if test="identityCode != null ">,identity_code</if>
	<if test="areaId != null ">,area_id</if>
	<if test="fundState != null ">,fund_state</if>
	<if test="insuranceFundType != null ">,insurance_fund_type</if>
	<if test="insuranceState != null ">,insurance_state</if>
	<if test="insuranceSalary != null ">,insurance_salary</if>
	<if test="fundSalary != null ">,fund_salary</if>
	<if test="insurancePeriod != null ">,insurance_period</if>
	<if test="fundPeriod != null ">,fund_period</if>
	<if test="insuranceLivingType != null ">,insurance_living_type</if>
	<if test="mobile != null ">,mobile</if>
	<if test="headPhoto != null ">,head_photo</if>
	<if test="syncMark != null ">,sync_mark</if>
	<if test="signMark != null ">,sign_mark</if>
	<if test="changeMark != null ">,change_mark</if>
	<if test="json != null ">,json</if>
	<if test="dr != null ">,dr</if>
	<if test="modifyDt != null ">,modify_dt</if>
	<if test="createDt != null ">,create_dt</if>
	<if test="repeat != null ">,`repeat`</if>
	<if test="analysisNum != null ">,analysis_num</if>
  </trim>
  )  VALUES (
  <trim prefix=" " prefixOverrides=",">
	<if test="id != null ">,#{id}</if>
	<if test="cpId != null ">,#{cpId}</if>
	<if test="empId != null ">,#{empId}</if>
	<if test="schemeId != null ">,#{schemeId}</if>
	<if test="name != null ">,#{name}</if>
	<if test="identityType != null ">,#{identityType}</if>
	<if test="identityCode != null ">,#{identityCode}</if>
	<if test="areaId != null ">,#{areaId}</if>
	<if test="fundState != null ">,#{fundState}</if>
	<if test="insuranceFundType != null ">,#{insuranceFundType}</if>
	<if test="insuranceState != null ">,#{insuranceState}</if>
	<if test="insuranceSalary != null ">,#{insuranceSalary}</if>
	<if test="fundSalary != null ">,#{fundSalary}</if>
	<if test="insurancePeriod != null ">,#{insurancePeriod}</if>
	<if test="fundPeriod != null ">,#{fundPeriod}</if>
	<if test="insuranceLivingType != null ">,#{insuranceLivingType}</if>
	<if test="mobile != null ">,#{mobile}</if>
	<if test="headPhoto != null ">,#{headPhoto}</if>
	<if test="syncMark != null ">,#{syncMark}</if>
	<if test="signMark != null ">,#{signMark}</if>
	<if test="changeMark != null ">,#{changeMark}</if>
	<if test="json != null ">,#{json}</if>
	<if test="dr != null ">,#{dr}</if>
	<if test="modifyDt != null ">,#{modifyDt}</if>
	<if test="createDt != null ">,#{createDt}</if>
	<if test="repeat != null ">,#{repeat}</if>
	<if test="analysisNum != null ">,#{analysisNum}</if>
  </trim>
  )
  <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
	SELECT LAST_INSERT_ID() AS ID
  </selectKey>
</insert>

<!-- 根据id，修改记录-->  
<update id="UpdateCM_EMPLOYEE_ORG" parameterType="Object" >
UPDATE CM_EMPLOYEE_ORG 
  <trim prefix=" SET " prefixOverrides=",">
	<if test="id != null ">,id=#{id}</if>
	<if test="cpId != null ">,cp_id=#{cpId}</if>
	<if test="empId != null ">,emp_id=#{empId}</if>
	<if test="schemeId != null ">,scheme_id=#{schemeId}</if>
	<if test="name != null ">,name=#{name}</if>
	<if test="identityType != null ">,identity_type=#{identityType}</if>
	<if test="identityCode != null ">,identity_code=#{identityCode}</if>
	<if test="areaId != null ">,area_id=#{areaId}</if>
	<if test="fundState != null ">,fund_state=#{fundState}</if>
	<if test="insuranceFundType != null ">,insurance_fund_type=#{insuranceFundType}</if>
	<if test="insuranceState != null ">,insurance_state=#{insuranceState}</if>
	<if test="insuranceSalary != null ">,insurance_salary=#{insuranceSalary}</if>
	<if test="fundSalary != null ">,fund_salary=#{fundSalary}</if>
	<if test="insurancePeriod != null ">,insurance_period=#{insurancePeriod}</if>
	<if test="fundPeriod != null ">,fund_period=#{fundPeriod}</if>
	<if test="insuranceLivingType != null ">,insurance_living_type=#{insuranceLivingType}</if>
	<if test="mobile != null ">,mobile=#{mobile}</if>
	<if test="headPhoto != null ">,head_photo=#{headPhoto}</if>
	<if test="syncMark != null ">,sync_mark=#{syncMark}</if>
	<if test="signMark != null ">,sign_mark=#{signMark}</if>
	<if test="changeMark != null ">,change_mark=#{changeMark}</if>
	<if test="json != null ">,json=#{json}</if>
	<if test="dr != null ">,dr=#{dr}</if>
	<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
	<if test="createDt != null ">,create_dt=#{createDt}</if>
	<if test="repeat != null ">,`repeat`=#{repeat}</if>
	<if test="analysisNum != null ">,analysis_num=#{analysisNum}</if>
  </trim>
WHERE ID=#{id}
</update>
 
<!-- 删除记录 -->
<delete id="DeleteCM_EMPLOYEE_ORG">DELETE FROM CM_EMPLOYEE_ORG WHERE ID=#{id}</delete>
<!-- 爬取规则 列表总数-->
<select id="CountFindAllCM_EMPLOYEE_ORG" resultType="java.lang.Integer">SELECT count(1) as value FROM CM_EMPLOYEE_ORG</select>
<select id="CountCM_EMPLOYEE_ORG" resultType="java.lang.Integer">SELECT count(1) as value FROM CM_EMPLOYEE_ORG WHERE ID=#{id}</select>
<!-- 根据id查询 爬取规则 -->
<select id="FindByPK" resultMap="result_map_CM_EMPLOYEE_ORG" parameterType="Object">SELECT <include refid="Base_Column_List" /> FROM CM_EMPLOYEE_ORG WHERE ID=#{pk}</select>

<!-- 根据各字段条件带查询  爬取规则 -->
<select id="FreeFindCM_EMPLOYEE_ORG" resultMap="result_map_CM_EMPLOYEE_ORG" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM CM_EMPLOYEE_ORG 
	 <include refid="Example_Where_Clause" />
</select>
<!-- 根据各字段条件带查询  爬取规则 记录数 -->
<select id="CountFreeFindCM_EMPLOYEE_ORG" resultType="java.lang.Integer">
SELECT count(1) as value FROM CM_EMPLOYEE_ORG 
 <include refid="Example_Where_Clause" />
</select>
<!-- 根据各字段条件带排序  爬取规则 -->
<select id="FreeFindCM_EMPLOYEE_ORGOrdered" resultMap="result_map_CM_EMPLOYEE_ORG" parameterType="Object">
	SELECT <include refid="Base_Column_List" /> FROM CM_EMPLOYEE_ORG 
	 <include refid="Example_Where_Clause" />
	 ORDER BY ${_orderBy}
</select>

<!-- *****************************  温馨提示：  ***************************** -->
<!-- **                                                                    ** -->
<!-- ** 以上为自动生成代码，请勿改动或删除。如有新sql添加请在下方区域内填写** -->
<!-- **                                             ** 2017/09/20 16:10:56 ** -->
<!-- ************************************************************************ -->

	<resultMap id="result_map_CM_EMPLOYEE_SYNDATA" type="com.xfs.corp.model.CmEmployee" >
		<result column="id" property="id"/>
		<result column="emp_id" property="empId"/>
		<result column="cp_id" property="cpId"/>
		<result column="name" property="name"/>
		<result column="identity_type" property="identityType"/>
		<result column="identity_code" property="identityCode"/>
		<result column="job" property="job"/>
		<result column="social_insurance_num" property="socialInsuranceNum"/>
		<result column="reserve_fund_num" property="reserveFundNum"/>
		<result column="mobile" property="mobile"/>
		<result column="create_by" property="createBy"/>
		<result column="create_dt" property="createDt"/>
		<result column="modify_by" property="modifyBy"/>
		<result column="modify_dt" property="modifyDt"/>
		<result column="insurance_period" property="insurancePeriod"/>
		<result column="fund_period" property="fundPeriod"/>
		<result column="dr" property="dr"/>
		<result column="insurance_living_type" property="insuranceLivingType"/>
		<result column="insurance_state" property="insuranceState"/>
		<result column="is_quit" property="isQuit"/>
		<result column="scheme_id" property="schemeId"/>
		<result column="dep_id" property="depId"/>
		<result column="email" property="email"/>
		<result column="openid" property="openid"/>
		<result column="fund_state" property="fundState"/>
		<result column="entry_time" property="entryTime"/>
		<result column="leave_time" property="leaveTime"/>
		<result column="insurance_salary" property="insuranceSalary"/>
		<result column="fund_salary" property="fundSalary"/>
		<result column="living_type_name" property="livingTypeName"/>
		<result column="fund_state_name" property="fundStateName"/>
		<result column="insurance_state_name" property="insuranceStateName"/>
		<result column="insurance_type" property="insuranceTypeName"/>
		<result column="fund_type" property="fundTypeName"/>
		<result column="corp_name" property="corpName"/>
		<result column="head_photo" property="headPhoto"/>
		<result column="three_id" property="threeId"/>
		<result column="ss_user_id" property="ssUserId"/>
		<result column="hf_user_id" property="hfUserId"/>
		<result column="json" property="json"/>
		<result column="salary" property="salary"/>
		<result column="branch" property="branch"/>
		<result column="dep_name" property="depName"/>
		<result column="insurance_fund_type" property="insuranceFundType"/>
	</resultMap>


	<select id="querySaveSynOrgData" resultMap="result_map_CM_EMPLOYEE_SYNDATA" parameterType="Object">
		SELECT <include refid="Base_Column_List" /> FROM CM_EMPLOYEE_ORG
		WHERE 1=1
		<if test="id != null" >and id = #{id}</if>
		<if test="cpId != null" >and cp_id = #{cpId}</if>
		<if test="empId != null" >and emp_id = #{empId}</if>
		<if test="schemeId != null" >and scheme_id = #{schemeId}</if>
		<if test="name != null" >and name = #{name}</if>
		<if test="identityType != null" >and identity_type = #{identityType}</if>
		<if test="identityCode != null" >and identity_code = #{identityCode}</if>
		<if test="areaId != null" >and area_id = #{areaId}</if>
		<if test="fundState != null" >and fund_state = #{fundState}</if>
		<if test="insuranceFundType != null" >and insurance_fund_type = #{insuranceFundType}</if>
		<if test="insuranceState != null" >and insurance_state = #{insuranceState}</if>
		<if test="insurancePeriod != null" >and insurance_period = #{insurancePeriod}</if>
		<if test="fundPeriod != null" >and fund_period = #{fundPeriod}</if>
		<if test="insuranceLivingType != null" >and insurance_living_type = #{insuranceLivingType}</if>
		<if test="mobile != null" >and mobile = #{mobile}</if>
		<if test="syncMark != null" >and sync_mark = #{syncMark}</if>
		<if test="signMark != null and signMark == 'THREEPART'" >and emp_id is not null </if>
		<if test="changeMark != null" >and change_mark = #{changeMark}</if>
		<if test="analysisNum != null" >and analysis_num = #{analysisNum}</if>
		AND (`repeat` != 0 or emp_id is NOT NULL)
	</select>


	<select id="querySynDataSystemListCount" resultType="java.lang.Integer">
		SELECT COUNT(1) as value FROM (
		SELECT
		t.`name`
		FROM
		cm_employee_org t
		LEFT JOIN cm_employee emp ON t.emp_id = emp.emp_id AND emp.cp_id = #{cpId} AND t.cp_id = #{cpId}  AND emp.dr = 0
		left JOIN sys_dictitem item ON item.area_id = t.area_id AND item.dictionary = 93 AND item.`code` = t.insurance_living_type
		left JOIN bs_area ba on ba.area_id = t.area_id
		WHERE emp.emp_id is not null AND t.cp_id = #{cpId} AND t.change_mark = 'Y' AND t.sync_mark = 'N' AND t.`repeat` = 1 AND t.analysis_num = #{analysisNum}
		GROUP BY
		t.NAME,
		t.identity_code
		) e
	</select>

	<select id="querySynDataListCount" resultType="java.lang.Integer">
		SELECT COUNT(1) as value FROM (
			SELECT
			  t.`name`
			FROM
				cm_employee_org t
			  LEFT JOIN cm_employee emp ON t.emp_id = emp.emp_id AND emp.cp_id = #{cpId} AND t.cp_id = #{cpId}  AND emp.dr = 0
				left JOIN sys_dictitem item ON item.area_id = t.area_id AND item.dictionary = 93 AND item.`code` = t.insurance_living_type
				left JOIN bs_area ba on ba.area_id = t.area_id
			WHERE t.cp_id = #{cpId} AND t.change_mark = 'Y' AND t.sync_mark = 'N' AND t.`repeat` = 1 AND t.analysis_num = #{analysisNum}
			GROUP BY
				t.NAME,
				t.identity_code
		) e
	</select>

	<select id="querySynDataList" resultMap="result_map_CM_EMPLOYEE_ORG" parameterType="Object">
		SELECT
		  GROUP_CONCAT(t.id) as ids,
			emp.emp_id AS emp_id,
			t.`name` AS `name`,
			t.identity_code as identity_code,
			MAX(IFNULL(t.fund_salary,0)) as fund_salary,
			MAX(IFNULL(t.insurance_salary,0)) as insurance_salary,
		  t.area_id,
		  ba.`name` as areaName,
		  MIN(item.`name`) as insurance_living_type,
		  emp.`name` as sysEmpName
		FROM
			cm_employee_org t
		  LEFT JOIN cm_employee emp ON t.emp_id = emp.emp_id  AND emp.cp_id = #{cpId}  AND emp.dr = 0
			left JOIN sys_dictitem item ON item.area_id = t.area_id AND item.dictionary = 93 AND item.`code` = t.insurance_living_type
			left JOIN bs_area ba on ba.area_id = t.area_id
		WHERE t.cp_id = #{cpId} AND t.change_mark = 'Y' AND t.sync_mark = 'N' AND t.`repeat` = 1 AND t.analysis_num = #{analysisNum}
		GROUP BY
			t.NAME,
			t.identity_code
		ORDER BY emp.emp_id DESC
	</select>

	<!-- 重名人员列表 -->
	<select id="queryUnEmpIdSynDataList" resultMap="result_map_CM_EMPLOYEE_ORG" parameterType="Object">
		SELECT
		  GROUP_CONCAT(t.id) as ids,
			emp.emp_id AS emp_id,
			t.`name` AS `name`,
			t.identity_code as identity_code,
			MAX(IFNULL(t.fund_salary,0)) as fund_salary,
			MAX(IFNULL(t.insurance_salary,0)) as insurance_salary,
		  t.area_id,
		  ba.`name` as areaName,
		  MIN(item.`name`) as insurance_living_type,
		  emp.`name` as sysEmpName,
          t.`repeat`,
          MAX(t.head_photo) as head_photo
		FROM
			cm_employee_org t
		  LEFT JOIN cm_employee emp ON t.emp_id = emp.emp_id  AND emp.cp_id = #{cpId} AND emp.dr = 0
			left JOIN sys_dictitem item ON item.area_id = t.area_id AND item.dictionary = 93 AND item.`code` = t.insurance_living_type
			left JOIN bs_area ba on ba.area_id = t.area_id
		WHERE t.emp_id is null AND t.cp_id = #{cpId} AND t.change_mark = 'Y' AND t.sync_mark = 'N' AND t.`repeat` = 0 AND t.analysis_num = #{analysisNum}
		GROUP BY
			t.NAME,
			t.identity_code
		ORDER BY t.emp_id asc,t.`repeat` ASC
	</select>


	<!-- 根据id，修改记录-->
	<update id="UpdateCM_EMPLOYEE_ORG_EXP" parameterType="Object" >
		UPDATE CM_EMPLOYEE_ORG
		<trim prefix=" SET " prefixOverrides=",">
			<if test="id != null ">,id=#{id}</if>
			<if test="cpId != null ">,cp_id=#{cpId}</if>
			<if test="empId != null ">,emp_id=#{empId}</if>
			<if test="empId == null ">,emp_id=NULL </if>
			<if test="schemeId != null ">,scheme_id=#{schemeId}</if>
			<if test="name != null ">,name=#{name}</if>
			<if test="identityType != null ">,identity_type=#{identityType}</if>
			<if test="identityCode != null ">,identity_code=#{identityCode}</if>
			<if test="areaId != null ">,area_id=#{areaId}</if>
			<if test="fundState != null ">,fund_state=#{fundState}</if>
			<if test="insuranceFundType != null ">,insurance_fund_type=#{insuranceFundType}</if>
			<if test="insuranceState != null ">,insurance_state=#{insuranceState}</if>
			<if test="insuranceSalary != null ">,insurance_salary=#{insuranceSalary}</if>
			<if test="fundSalary != null ">,fund_salary=#{fundSalary}</if>
			<if test="insurancePeriod != null ">,insurance_period=#{insurancePeriod}</if>
			<if test="fundPeriod != null ">,fund_period=#{fundPeriod}</if>
			<if test="insuranceLivingType != null ">,insurance_living_type=#{insuranceLivingType}</if>
			<if test="mobile != null ">,mobile=#{mobile}</if>
			<if test="headPhoto != null ">,head_photo=#{headPhoto}</if>
			<if test="syncMark != null ">,sync_mark=#{syncMark}</if>
			<if test="signMark != null ">,sign_mark=#{signMark}</if>
			<if test="changeMark != null ">,change_mark=#{changeMark}</if>
			<if test="json != null ">,json=#{json}</if>
			<if test="dr != null ">,dr=#{dr}</if>
			<if test="modifyDt != null ">,modify_dt=#{modifyDt}</if>
			<if test="createDt != null ">,create_dt=#{createDt}</if>
			<if test="repeat != null ">,`repeat`=#{repeat}</if>
			<if test="analysisNum != null ">,analysis_num=#{analysisNum}</if>
		</trim>
		WHERE ID=#{id}
	</update>

	<update id="UpdateCM_EMPLOYEE_ORG_MARK" parameterType="Object" >
		UPDATE CM_EMPLOYEE_ORG
		<trim prefix=" SET " prefixOverrides=",">
			<if test="syncMark != null ">,sync_mark=#{syncMark}</if>
			<if test="changeMark != null ">,change_mark=#{changeMark}</if>
		</trim>
		WHERE cp_id=#{cpId} AND analysis_num = #{analysisNum}
	</update>

</mapper>   
